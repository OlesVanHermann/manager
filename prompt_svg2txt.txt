# PROMPT SVG2TXT v2 - Generation de Cahier des Charges depuis Old Manager

================================================================================
Version: v2.0 (2026-01-02)
Parent: prompt_target.txt v5, prompt_split.txt v3
Changelog:
- v2.0: Alignement terminologie NAV1-NAV4, conventions nommage revisees,
        8 sections cahier, references croisees, mapping old->target
- v1.0: Version initiale
================================================================================

## Fichiers et chemins

| Element | Valeur |
|---------|--------|
| **Prompt** | /home/ubuntu/prompt_svg2txt.txt |
| **Destination finale utilisateur** | /home/ubuntu/old_manager_svg/{NAV1}/{NAV2}/ |
| **Destination Claude (outputs)** | /mnt/user-data/outputs/old_manager_svg/{NAV1}/{NAV2}/ |
| **Script verification APIs** | /home/ubuntu/old_manager/check_api_coverage.py |

---

## PROMPTS COMPLEMENTAIRES (references croisees)

| Prompt | Usage | Quand l'utiliser |
|--------|-------|------------------|
| prompt_target.txt | Design system SVG (couleurs, typo, composants) | Generer les target_.*.svg |
| prompt_split.txt | Architecture React defactorisee | Comprendre la structure cible |
| prompt_split_layout_method.txt | Specs CSS layout (dimensions) | Verifier padding, gap, sidebar |
| prompt_target_sidecar_left.txt | LEFT PANEL / useLeftPanel hook | Architecture sidebar |

---

##############################################################################
# 0. TERMINOLOGIE OFFICIELLE NAV1-NAV4
##############################################################################

### Definitions et positions

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Niveau  â”‚ Nom          â”‚ Position     â”‚ Description                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NAV1    â”‚ Univers      â”‚ Header       â”‚ Header OVH (Web Cloud, Public Cloud...) â”‚
â”‚ NAV2    â”‚ Produit      â”‚ Sous-header  â”‚ Section (Domaines, Hebergement...)      â”‚
â”‚ NAV3    â”‚ Groupement   â”‚ LEFT PANEL   â”‚ Toggle TOUJOURS en sidebar,             â”‚
â”‚         â”‚              â”‚ (au-dessus   â”‚ AU-DESSUS de [Rechercher]               â”‚
â”‚         â”‚              â”‚ de search)   â”‚ ([General][Sites][Expert]...)           â”‚
â”‚ NAV4    â”‚ Fonction     â”‚ RIGHT PANEL  â”‚ Onglets TOUJOURS dans le panel          â”‚
â”‚         â”‚              â”‚ (tabs)       â”‚ principal (FTP, SSL, BDD...)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

### Structure visuelle

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ NAV1 - Univers (Header bleu OVH)                                            â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ NAV2 - Produit (Sous-header blanc)                                          â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ LEFT PANEL (280px)    â”‚ RIGHT PANEL (flex: 1)                               â”‚
  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚ â”‚ NAV3 - Groupement â”‚ â”‚ â”‚ Titre service                                   â”‚ â”‚
  â”‚ â”‚ [General][Sites]  â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ NAV4 - Fonction                                 â”‚ â”‚
  â”‚ â”‚ ðŸ” Rechercher...  â”‚ â”‚ â”‚ [FTP] [SSL] [BDD] [CDN] [Cron]                  â”‚ â”‚
  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
  â”‚ â”‚ Liste services    â”‚ â”‚ â”‚ Contenu de l'onglet selectionne                 â”‚ â”‚
  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

### Regles de position CRITIQUES

- **NAV3 (Groupement)** est TOUJOURS dans le **LEFT PANEL**, AU-DESSUS de la recherche
- **NAV4 (Fonction)** est TOUJOURS dans le **RIGHT PANEL** (tabs principaux)
- NE JAMAIS confondre NAV3 et NAV4

### Modele de navigation hierarchique

```
NAV1 â”€â”€â–º Univers (Header OVH: Web Cloud, Public Cloud, Network, etc.)
  â”‚
  â””â”€â–º NAV2 â”€â”€â–º Produit (Domaines, Hebergement, Emails, VoIP, Acces, etc.)
        â”‚
        â””â”€â–º NAV3 â”€â”€â–º Groupement dans LEFT PANEL ([General][Sites][Expert])
              â”‚
              â””â”€â–º NAV4 â”€â”€â–º Fonction dans RIGHT PANEL (FTP, SSL, BDD...)
```

### Dimensions de reference

| Niveau | Position | Height | Exemple |
|--------|----------|--------|---------|
| **NAV1** Univers | y=0 | 50px | Web Cloud, Public Cloud, Network |
| **NAV2** Produit | y=50 | 40px | Domaines, Hebergement, Emails |
| **NAV3** Groupement | LEFT PANEL (top) | ~44px | [General] [Sites] [Expert] |
| **NAV4** Fonction | RIGHT PANEL y=38 | ~26px | FTP, SSL, BDD, CDN, Cron |

### Specs CSS layout (prompt_split_layout_method.txt)

| Propriete | Valeur | Usage |
|-----------|--------|-------|
| NAV1 height | 50px | Header bleu OVH |
| NAV2 height | 40px | Sous-header blanc |
| Gap NAV2â†’Content | 15px | padding-top du split |
| Margins laterales | 24px | padding left/right |
| Sidebar width | 280px | LEFT PANEL (min/max) |
| Gap panels | 16px | entre sidebar et main |

---

##############################################################################
# 1. ARBORESCENCE NAV1 EXISTANTE
##############################################################################

| NAV1 | Description | Exemples NAV2 |
|------|-------------|---------------|
| `home` | Espace client, compte, facturation | account, billing, support, carbon, catalog, hub, iam, procedures, changelog, restricted |
| `web-cloud` | Hebergement web, bases de donnees | domain, domains, dns-zone, email, email-exchange, email-mxplan, hebergement, hosting, managed-wordpress, ongoing-operations, private-database |
| `bare-metal` | Serveurs dedies, Private Cloud | cda, cdn, dedicated, dedicated-cloud, housing, ip, license, load-balancer, nas-ha, nasha, netapp, network-security, nutanix, vps, vrack |
| `public-cloud` | Infrastructure cloud | ai-*, billing, block-storage, cold-archive, databases, gateway, instances, kubernetes, load-balancer, network, object-storage, private-network, private-registry, project, public-ip, qpu, quantum, quota, rancher, registry, ssh-keys, users, volume-backup, volume-snapshot, vouchers |
| `network` | Reseau et connectivite | cdn, cloud-connect, ip, load-balancer, security, vrack, vrack-services |
| `telecom` | Telephonie et internet | alias, fax, line, modem, orders, pack, telephony, xdsl |
| `iam` | Identite et acces | api-keys, conditions, dashboard, groups, identities, kms, logs, policies, secret-manager, service-accounts, sso, tag-manager, users, components |
| `billing` | Facturation standalone | invoices, services, orders, payment-methods, auto-renew, history, credits |
| `dedicated` | Serveurs dedies legacy | dashboard, backup, network, ipmi, secondary-dns, intervention, firewall, monitoring |
| `vps` | VPS legacy | dashboard, backups, snapshots, monitoring, secondary-dns |
| `support` | Support client | tickets, guides, create-ticket, ticket-detail, status |
| `signup` | Inscription | account-type, account-details, settings, company-search |

---

##############################################################################
# 2. REGLES CRITIQUES - LIRE EN PREMIER
##############################################################################

### REGLE 0 : ZERO HALLUCINATION
**INTERDIT ABSOLU** d'inventer des elements absents du code source.
- Pas dans le code -> PAS dans le TXT
- Pas dans les traductions -> PAS de label invente
- En cas de doute -> `grep` pour verifier
- **Chaque element doit etre justifiable par une ligne de code**

### REGLE 1 : GENERATION DIRECTE OBLIGATOIRE
**INTERDICTION** d'afficher le contenu dans la conversation.

| INTERDIT | OBLIGATOIRE |
|----------|-------------|
| Afficher le TXT brut | Ecrire avec `tee` dans `/mnt/user-data/outputs/` |
| "Voici le cahier, copiez-le..." | Appeler `present_files` apres generation |
| Attendre copier-coller | Fournir lien de telechargement |

**Raison** : L'utilisateur ne peut PAS copier-coller. Afficher = PERTE DE TEMPS.

### REGLE 2 : PARALLELISME SVG <-> TXT
**OBLIGATOIRE** : Pour chaque SVG, un TXT correspondant avec le MEME nom.

```
old_manager.{NAV1}.{NAV2}.svg               -> old_manager.{NAV1}.{NAV2}.txt
old_manager.{NAV1}.{NAV2}.nav3-xxx.svg      -> old_manager.{NAV1}.{NAV2}.nav3-xxx.txt
old_manager.{NAV1}.{NAV2}.nav4-xxx.svg      -> old_manager.{NAV1}.{NAV2}.nav4-xxx.txt
old_manager.{NAV1}.{NAV2}.modal-xxx.svg     -> old_manager.{NAV1}.{NAV2}.modal-xxx.txt
```

### REGLE 3 : MEME REPERTOIRE QUE LES SVG
Les TXT doivent etre dans le MEME dossier que les SVG correspondants.

### REGLE 4 : CLASSIFICATION NAV3/NAV4 OBLIGATOIRE
**OBLIGATOIRE** : Identifier si un onglet est NAV3 (Groupement) ou NAV4 (Fonction).

| Critere | NAV3 (Groupement) | NAV4 (Fonction) |
|---------|-------------------|-----------------|
| Position | LEFT PANEL | RIGHT PANEL |
| Role | Filtre les NAV4 affiches | Action/vue specifique |
| Exemples | [General], [Sites], [Expert] | FTP, SSL, BDD, CDN |
| Nombre | 2-4 max par NAV2 | 5-20+ par NAV3 |

---

##############################################################################
# 3. CONVENTION DE NOMMAGE (REVISEE v2)
##############################################################################

### Patterns de fichiers TXT/SVG

| Pattern | Type | Usage | Exemple |
|---------|------|-------|---------|
| `{PREFIX}.{NAV1}.{NAV2}.txt` | Dashboard | Page principale sans service selectionne | `old_manager.web-cloud.hosting.txt` |
| `{PREFIX}.{NAV1}.{NAV2}.general.txt` | NAV4 | Page generale (1er onglet) avec service | `old_manager.web-cloud.hosting.general.txt` |
| `{PREFIX}.{NAV1}.{NAV2}.nav3-{groupe}.txt` | NAV3 | Groupement (LEFT PANEL) | `old_manager.web-cloud.hosting.nav3-expert.txt` |
| `{PREFIX}.{NAV1}.{NAV2}.nav4-{fonction}.txt` | NAV4 | Fonction/onglet (RIGHT PANEL) | `old_manager.web-cloud.hosting.nav4-ssl.txt` |
| `{PREFIX}.{NAV1}.{NAV2}.modal-{nav4}-{action}.txt` | Modal | Dialog lie a une fonction | `old_manager.web-cloud.hosting.modal-ssl-order.txt` |
| `{PREFIX}.{NAV1}.{NAV2}.modal-{action}.txt` | Modal | Dialog global | `old_manager.home.billing.modal-terminate.txt` |
| `{PREFIX}.{NAV1}.{NAV2}.onboarding.txt` | Onboarding | Page empty state | `old_manager.web-cloud.hosting.onboarding.txt` |
| `{PREFIX}.{NAV1}.{NAV2}.state-{etat}.txt` | State | Etat specifique (empty, error, loading) | `old_manager.web-cloud.hosting.state-empty.txt` |
| `{PREFIX}.{NAV1}.{NAV2}.create.txt` | Create | Page de creation | `old_manager.public-cloud.kubernetes.create.txt` |
| `{PREFIX}.{NAV1}.{NAV2}.{nom}-detail.txt` | Detail | Page de detail | `old_manager.home.support.ticket-detail.txt` |
| `{PREFIX}.{NAV1}.{NAV2}.list-{nom}.txt` | List | Liste d'elements | `old_manager.web-cloud.hosting.list-hostings.txt` |

### IMPORTANT : Migration tab-xxx -> nav4-xxx

| Ancien (v1) | Nouveau (v2) | Raison |
|-------------|--------------|--------|
| `tab-ssl` | `nav4-ssl` | SSL est une FONCTION dans le RIGHT PANEL |
| `tab-ftp` | `nav4-ftp` | FTP est une FONCTION dans le RIGHT PANEL |
| `tab-general` | `general` | General est le 1er NAV4 (pas de prefixe) |
| (nouveau) | `nav3-expert` | Expert est un GROUPEMENT dans le LEFT PANEL |

### Arborescence complete (exemple)

```
/mnt/user-data/outputs/old_manager_svg/
  â”œâ”€â”€ web-cloud/
  â”‚   â””â”€â”€ hosting/
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.svg              # Dashboard
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.txt
  â”‚       â”‚
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.onboarding.svg   # Onboarding
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.onboarding.txt
  â”‚       â”‚
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.general.svg      # NAV4: General (1er onglet)
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.general.txt
  â”‚       â”‚
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.nav3-general.svg # NAV3: Groupement [General]
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.nav3-general.txt
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.nav3-sites.svg   # NAV3: Groupement [Sites]
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.nav3-sites.txt
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.nav3-expert.svg  # NAV3: Groupement [Expert]
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.nav3-expert.txt
  â”‚       â”‚
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.nav4-ssl.svg     # NAV4: SSL (RIGHT PANEL)
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.nav4-ssl.txt
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.nav4-ftp.svg     # NAV4: FTP (RIGHT PANEL)
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.nav4-ftp.txt
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.nav4-database.svg
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.nav4-database.txt
  â”‚       â”‚
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.modal-ssl-order.svg    # Modal SSL
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.modal-ssl-order.txt
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.modal-ftp-create.svg   # Modal FTP
  â”‚       â”œâ”€â”€ old_manager.web-cloud.hosting.modal-ftp-create.txt
  â”‚       â””â”€â”€ ...
  â”‚
  â””â”€â”€ home/
      â””â”€â”€ billing/
          â”œâ”€â”€ old_manager.home.billing.svg
          â”œâ”€â”€ old_manager.home.billing.txt
          â”œâ”€â”€ old_manager.home.billing.modal-terminate.svg
          â”œâ”€â”€ old_manager.home.billing.modal-terminate.txt
          â””â”€â”€ ...
```

---

##############################################################################
# 4. MAPPING OLD MANAGER -> TARGET MANAGER
##############################################################################

### Correspondance fichiers old -> target

| old_manager (analyse) | target_ (generation) | Type |
|-----------------------|---------------------|------|
| `old_manager.web-cloud.hosting.txt` | `target_.web-cloud.hosting.dashboard.svg` | Dashboard |
| `old_manager.web-cloud.hosting.general.txt` | `target_.web-cloud.hosting.general.svg` | NAV4 |
| `old_manager.web-cloud.hosting.nav3-expert.txt` | (integre dans LeftPanel) | NAV3 |
| `old_manager.web-cloud.hosting.nav4-ssl.txt` | `target_.web-cloud.hosting.ssl.svg` | NAV4 |
| `old_manager.web-cloud.hosting.modal-ssl-order.txt` | (modale dans sites/ssl/) | Modal |

### Correspondance architecture

| old_manager | prompt_split.txt (architecture cible) |
|-------------|--------------------------------------|
| NAV1: web-cloud | `src/pages/web-cloud/` |
| NAV2: hosting | `src/pages/web-cloud/hosting/` |
| NAV3: expert | `src/pages/web-cloud/hosting/expert/` (dossier groupement) |
| NAV4: ssl | `src/pages/web-cloud/hosting/sites/ssl/SslTab.tsx` |
| modal-ssl-order | `src/pages/web-cloud/hosting/sites/ssl/OrderSslModal.tsx` |

### Tableau de mapping NAV3 -> NAV4 (exemple Hosting)

| NAV3 Groupement | NAV4 Fonctions (RIGHT PANEL) |
|-----------------|------------------------------|
| **[General]** | general, statistics, indy, offer, modules, logs, seo |
| **[Sites]** | multisite, ssl |
| **[Expert]** | ftp, database, clouddb, cdn, boost, emails, envvars, runtimes, cron, tasks |

---

##############################################################################
# 5. WORKFLOW OBLIGATOIRE
##############################################################################

### Phase 1 : Detection du contexte
```
Input : old_manager.web-cloud.hosting.tar

PREFIX = old_manager
NAV1 = web-cloud
NAV2 = hosting
```

### Phase 2 : Analyse du code
| Priorite | Fichier | Information |
|----------|---------|-------------|
| 1 | layout.tsx | Structure, breadcrumb, NAV3/NAV4 tabs |
| 2 | *.page.tsx | Contenu principal |
| 3 | components/*.tsx | Elements UI |
| 4 | useDatagridColumn.tsx | Colonnes + ActionMenu |
| 5 | Messages_fr_FR.json | Traductions FR |
| 6 | styles.css | Styles specifiques |
| 7 | *.service.js | Vrais endpoints API |
| 8 | api/*.ts | Hooks et appels API |

### Phase 3 : Classification NAV3/NAV4 (NOUVEAU)
```bash
# Identifier les groupements (NAV3) dans le LEFT PANEL
grep -rn "groupement\|toggle\|selector" --include="*.tsx" /tmp/extract/

# Identifier les fonctions (NAV4) dans le RIGHT PANEL
grep -rn "tabs\|TabPanel\|activeTab" --include="*.tsx" /tmp/extract/
```

### Phase 4 : Verification APIs (OBLIGATOIRE)
```bash
# Lancer le script sur le repertoire extrait
python3 /home/ubuntu/old_manager/check_api_coverage.py /tmp/old_manager_analysis
```

### Phase 5 : Generation TXT
```bash
# 1. Creer arborescence dans outputs (meme que SVG)
mkdir -p /mnt/user-data/outputs/old_manager_svg/{NAV1}/{NAV2}

# 2. Ecrire le TXT
tee /mnt/user-data/outputs/old_manager_svg/{NAV1}/{NAV2}/{PREFIX}.{NAV1}.{NAV2}.txt > /dev/null << 'CDC_EOF'
# Contenu du cahier des charges
CDC_EOF

# 3. Appeler present_files avec le chemin du fichier
```

### Phase 6 : Confirmation
```
CONTEXTE :
  PREFIX : old_manager
  NAV1 : web-cloud
  NAV2 : hosting

NAV3 IDENTIFIES (LEFT PANEL) :
  - [General] : 7 NAV4
  - [Sites] : 2 NAV4
  - [Expert] : 10 NAV4

NAV4 IDENTIFIES (RIGHT PANEL) :
  [General] : general, statistics, indy, offer, modules, logs, seo
  [Sites] : multisite, ssl
  [Expert] : ftp, database, clouddb, cdn, boost, emails, envvars, runtimes, cron, tasks

TXT GENERES :
  1. old_manager.web-cloud.hosting.txt (XX Ko) - 8 sections, YY APIs
  2. old_manager.web-cloud.hosting.nav4-ssl.txt (XX Ko)
  3. old_manager.web-cloud.hosting.nav4-ftp.txt (XX Ko)
  ...
```

---

##############################################################################
# 6. METHODOLOGIE D'ANALYSE
##############################################################################

### 1) FRONTEND

**Look & Feel :**
- Layout general (grilles, colonnes, espacements)
- Hierarchie visuelle (titres, sections, cartes)
- Etats visuels (loading, error, empty, success)

**UX :**
- Parcours utilisateur (navigation entre pages)
- Flux modaux (ouverture, etapes, fermeture)
- Feedback utilisateur (notifications, messages, spinners)

**Design System (ref: prompt_target.txt) :**
- Composants ODS utilises (@ovhcloud/ods-react)
- Composants manager-react-components utilises
- Classes Tailwind recurrentes
- Tokens CSS (couleurs, espacements)

**Ergonomie :**
- Actions disponibles par contexte (menus, boutons)
- Tri, filtres, recherche, pagination
- Responsive / breakpoints

---

### 2) BACKEND (APIs)

**Endpoints utilises :**
- Liste exhaustive des routes API (GET, POST, PUT, DELETE)
- Version API (v6, v2, 2API, Engine)
- Parametres requis et optionnels

**Sequencement :**
- Ordre des appels (sequentiel vs parallele)
- Dependances entre appels (ex: recuperer serviceId avant update)
- Batch / Promise.all patterns

**Types de donnees :**
- Interfaces TypeScript (request/response)
- Enums et constantes metier
- Structures imbriquees

**Patterns de detection API dans le code :**

| Pattern | Framework | Exemple |
|---------|-----------|---------|
| OvhHttp.get/post/put/delete | AngularJS | OvhHttp.get('/domain/{serviceName}') |
| $http.get/post/put/delete | AngularJS | $http.get('/me/contact') |
| v2.get/post/put/delete | React | v2.get('/domain/alldom/{serviceName}') |
| v6.get/post/put/delete | React | v6.get('/services/{serviceId}') |
| useResourcesIcebergV2 | React | Pagination Iceberg |
| rootPath: 'apiv6' | AngularJS | API v6 standard |
| rootPath: '2api' | AngularJS | API 2API/AAPI |

---

### 3) FRONTEND - BACKEND

**Hooks de donnees :**
- useQuery / useQueries (lecture)
- useMutation (ecriture)
- Cache keys et invalidation

**Declencheurs :**
- Au montage (useEffect, queryFn)
- Sur action utilisateur (onClick, onSubmit)
- Sur navigation (route params)

**Gestion d'etats :**
- Loading states
- Error handling (401 - redirect auth, autres - affichage)
- Optimistic updates

---

##############################################################################
# 7. STRUCTURE DU CAHIER DES CHARGES (8 sections)
##############################################################################

| # | Section | Contenu |
|---|---------|---------|
| 1 | **RESUME EXECUTIF** | Perimetre, objectif fonctionnel, users cibles |
| 2 | **ARCHITECTURE NAV** | **NOUVEAU** : Classification NAV1â†’NAV4, positions, mapping |
| 3 | **ARCHITECTURE FICHIERS** | Arborescence fichiers, patterns, dependances |
| 4 | **PAGES & NAVIGATION** | Routes, params, breadcrumb, flux |
| 5 | **COMPOSANTS UI** | Liste avec props, comportement, ODS mapping |
| 6 | **APIs & DONNEES** | Endpoints, sequences, types complets |
| 7 | **TRADUCTIONS** | Cles i18n avec valeurs FR (et EN si dispo) |
| 8 | **REGLES METIER** | Validations, conditions, etats, permissions |

### Section 2 - ARCHITECTURE NAV (template)

```markdown
## 2. ARCHITECTURE NAV

### 2.1 Classification

| Niveau | Valeur | Position |
|--------|--------|----------|
| NAV1 | web-cloud | Header OVH |
| NAV2 | hosting | Sous-header |
| NAV3 | [General], [Sites], [Expert] | LEFT PANEL |
| NAV4 | ftp, ssl, database, ... | RIGHT PANEL |

### 2.2 Mapping NAV3 -> NAV4

| NAV3 Groupement | NAV4 Fonctions |
|-----------------|----------------|
| [General] | general, statistics, indy, offer, modules, logs, seo |
| [Sites] | multisite, ssl |
| [Expert] | ftp, database, clouddb, cdn, boost, emails, envvars, runtimes, cron, tasks |

### 2.3 Correspondance architecture cible (prompt_split.txt)

| Element | Chemin cible |
|---------|--------------|
| NAV2 Layout | src/pages/web-cloud/hosting/index.tsx |
| NAV2 Types | src/pages/web-cloud/hosting/hosting.types.ts |
| NAV3 [Expert] | src/pages/web-cloud/hosting/expert/ |
| NAV4 FTP | src/pages/web-cloud/hosting/expert/ftp/FtpTab.tsx |
| Modal FTP | src/pages/web-cloud/hosting/expert/ftp/CreateFtpUserModal.tsx |
```

---

##############################################################################
# 8. VERIFICATION DES APIs (OBLIGATOIRE)
##############################################################################

### Script check_api_coverage.py

**Emplacement :** /home/ubuntu/old_manager/check_api_coverage.py

**Usage :**
```bash
# Un seul repertoire
python3 /home/ubuntu/old_manager/check_api_coverage.py /tmp/old_manager_analysis

# Plusieurs repertoires
python3 /home/ubuntu/old_manager/check_api_coverage.py /tmp/dir1 /tmp/dir2

# Sortie Markdown
python3 /home/ubuntu/old_manager/check_api_coverage.py /tmp/dir --markdown
```

**Sortie :**
- Rapport texte avec endpoints par categorie
- JSON detaille dans /tmp/api_coverage.json
- Total endpoints et fichiers analyses

**Categories automatiques :**
- Domain : /domain/*
- Zone DNS : /domain/zone/*
- AllDom : /allDom/*, /alldom/*
- Services (2API) : /services/*
- Me (Compte) : /me/*
- 2API (SWS) : /sws/*

### Checklist de verification API

- [ ] Script check_api_coverage.py lance
- [ ] Toutes les APIs trouvees sont documentees
- [ ] Aucune API documentee absente du code
- [ ] Methodes HTTP correctes (GET/POST/PUT/DELETE)
- [ ] Version API correcte (apiv6/2api/apiv2)
- [ ] Sequencement documente pour les appels dependants

---

##############################################################################
# 9. FORMAT DE SORTIE
##############################################################################

**Nom du fichier :** Identique au SVG correspondant, extension .txt

```
old_manager.<NAV1>.<NAV2>.svg                    ->  old_manager.<NAV1>.<NAV2>.txt
old_manager.<NAV1>.<NAV2>.nav3-xxx.svg           ->  old_manager.<NAV1>.<NAV2>.nav3-xxx.txt
old_manager.<NAV1>.<NAV2>.nav4-xxx.svg           ->  old_manager.<NAV1>.<NAV2>.nav4-xxx.txt
old_manager.<NAV1>.<NAV2>.modal-{nav4}-{action}.svg ->  old_manager.<NAV1>.<NAV2>.modal-{nav4}-{action}.txt
```

**Destination :**
```
/mnt/user-data/outputs/old_manager_svg/{NAV1}/{NAV2}/
```
(Meme repertoire que les SVG)

---

##############################################################################
# 10. GENERATION ET MODIFICATION DE FICHIERS
##############################################################################

### Choix de methode

| Situation | Methode |
|-----------|---------|
| Nouveau fichier | cp+tee |
| Fichier existant, petite modif | super-patch |
| Fichier existant, gros changements | cp+tee (reecriture complete) |

---

### Creer un nouveau fichier avec cp+tee

```bash
mkdir -p /mnt/user-data/outputs/old_manager_svg/{NAV1}/{NAV2}
cp --backup=numbered /mnt/user-data/outputs/old_manager_svg/{NAV1}/{NAV2}/<nom>.txt /home/ubuntu/action-target/tmp/ 2>/dev/null || true
tee /mnt/user-data/outputs/old_manager_svg/{NAV1}/{NAV2}/<nom>.txt > /dev/null << 'CDC_EOF'
# Contenu COMPLET du cahier des charges
# JAMAIS de "... comme avant"
# JAMAIS de sections tronquees
CDC_EOF
```

**Regle CRITIQUE :** Le `cp` est OBLIGATOIRE meme si le fichier n'existe pas. La commande peut echouer (`|| true`), ce n'est pas grave. Cela garantit une sauvegarde systematique si le fichier existe.

**Rappels anti-casse cp+tee :**
- Delimiteur final (CDC_EOF, EOF, etc.) en debut de ligne, colonne 0, sans espace
- Pas de guillemets intelligents - utiliser 'CDC_EOF' avec apostrophes simples ASCII
- Pas d'indentation avant tee ... << 'CDC_EOF' ni avant le delimiteur final
- Si le fichier n'existe pas, tee le cree ; s'il existe, il est ecrase
- **ATTENTION aux delimiteurs doubles** : si le contenu genere contient lui-meme un heredoc (ex: un script bash avec `<< 'EOF'`), utiliser un delimiteur DIFFERENT pour l'enveloppe externe (ex: `CDC_EOF`, `MODULE_END`, `OUTER_DELIM`)

---

### Modifier un fichier existant avec super-patch

```bash
super-patch << 'PATCH_EOF'
--- /mnt/user-data/outputs/old_manager_svg/{NAV1}/{NAV2}/<nom>.txt
+++ /mnt/user-data/outputs/old_manager_svg/{NAV1}/{NAV2}/<nom>.txt
@@
 ligne de contexte avant (sans +/-)
-ancienne ligne a supprimer
+nouvelle ligne a ajouter
 ligne de contexte apres (sans +/-)
PATCH_EOF
```

---

##############################################################################
# 11. CRITERES DE QUALITE
##############################################################################

Le cahier des charges est **complet** si un developpeur peut :
- [ ] Recreer toutes les pages sans voir l'original
- [ ] Identifier clairement NAV3 (Groupement) vs NAV4 (Fonction)
- [ ] Implementer tous les appels API correctement
- [ ] Reproduire le comportement UX identique
- [ ] Utiliser les bons composants ODS
- [ ] Appliquer les traductions exactes
- [ ] Comprendre le sequencement des appels API
- [ ] Gerer tous les etats (loading, error, empty, success)
- [ ] Mapper vers l'architecture cible (prompt_split.txt)

**Criteres specifiques APIs :**
- [ ] Script check_api_coverage.py lance sur le tar
- [ ] 100% des APIs trouvees sont dans le cahier
- [ ] Methodes HTTP verifiees (GET vs POST vs PUT vs DELETE)
- [ ] Version API verifiee (apiv6 vs 2api vs apiv2)

---

##############################################################################
# 12. RAPPORT DE GENERATION
##############################################################################

```
=== CONTEXTE ===
PREFIX : old_manager
NAV1 : web-cloud
NAV2 : hosting

=== ARCHITECTURE NAV ===
NAV3 (LEFT PANEL) :
  [General] -> 7 fonctions
  [Sites] -> 2 fonctions
  [Expert] -> 10 fonctions

NAV4 (RIGHT PANEL) :
  [General] : general, statistics, indy, offer, modules, logs, seo
  [Sites] : multisite, ssl
  [Expert] : ftp, database, clouddb, cdn, boost, emails, envvars, runtimes, cron, tasks

=== SVG EXISTANTS ===
1. old_manager.web-cloud.hosting.svg
2. old_manager.web-cloud.hosting.onboarding.svg
3. old_manager.web-cloud.hosting.nav4-ssl.svg
4. old_manager.web-cloud.hosting.nav4-ftp.svg
5. old_manager.web-cloud.hosting.modal-ssl-order.svg
...

=== TXT GENERES ===
1. old_manager.web-cloud.hosting.txt (XX Ko) - 8 sections, YY APIs
2. old_manager.web-cloud.hosting.onboarding.txt (XX Ko)
3. old_manager.web-cloud.hosting.nav4-ssl.txt (XX Ko)
4. old_manager.web-cloud.hosting.nav4-ftp.txt (XX Ko)
5. old_manager.web-cloud.hosting.modal-ssl-order.txt (XX Ko)
...

=== VERIFICATION APIs ===
- APIs trouvees par script : ZZ
- APIs documentees dans TXT : ZZ
- Manquantes : 0
- Orphelines : 0

=== MAPPING TARGET ===
- old_manager.web-cloud.hosting.nav4-ssl.txt -> target_.web-cloud.hosting.ssl.svg
- old_manager.web-cloud.hosting.nav4-ftp.txt -> target_.web-cloud.hosting.ftp.svg
...
```

---

##############################################################################
# 13. CHECKLIST FINALE
##############################################################################

### Contexte
- [ ] PREFIX detecte (old_manager / new_manager)
- [ ] NAV1 identifie
- [ ] NAV2 identifie
- [ ] NAV3 identifies et documentes (Groupements dans LEFT PANEL)
- [ ] NAV4 identifies et documentes (Fonctions dans RIGHT PANEL)

### Fichiers
- [ ] SVG existants listes dans old_manager_svg/{NAV1}/{NAV2}/
- [ ] Arborescence creee dans `/mnt/user-data/outputs/old_manager_svg/{NAV1}/{NAV2}/`
- [ ] TXT ecrits avec `tee` (pas affiches)
- [ ] TXT dans le MEME repertoire que les SVG
- [ ] Nommage TXT avec prefixes nav3-/nav4-/modal- corrects

### Contenu
- [ ] 8 sections presentes dans chaque TXT principal
- [ ] Section ARCHITECTURE NAV remplie (mapping NAV3->NAV4)
- [ ] ZERO hallucination
- [ ] check_api_coverage.py lance
- [ ] Textes en francais

### Qualite
- [ ] `present_files` appele
- [ ] Mapping old->target documente
- [ ] Variantes .~1~ .~2~ traitees si necessaire

---

##############################################################################
# 14. REGLES ABSOLUES
##############################################################################

- **NE JAMAIS** generer de code sans validation prealable
- **NE JAMAIS** tronquer le contenu avec "..." ou "comme avant"
- **NE JAMAIS** confondre NAV3 (LEFT PANEL) et NAV4 (RIGHT PANEL)
- **TOUJOURS** utiliser des chemins absolus
- **TOUJOURS** proposer avant de pousser
- **TOUJOURS** verifier les delimiteurs pour eviter les conflits
- **TOUJOURS** lancer check_api_coverage.py avant de finaliser
- **TOUJOURS** placer les TXT dans le MEME repertoire que les SVG
- **TOUJOURS** classifier les onglets en NAV3 ou NAV4
- **TOUJOURS** documenter le mapping vers l'architecture cible

---

##############################################################################
# 15. SCRIPT check_api_coverage.py (code complet)
##############################################################################

```python
#!/usr/bin/env python3
"""
OVHcloud API Coverage Checker
Extrait tous les appels API des fichiers source et verifie la couverture.

Usage:
    python check_api_coverage.py <tar_extract_dir> [--cahier <cahier_file>]
    python check_api_coverage.py /tmp/old_manager_domains /tmp/old_manager_alldom
"""

import os
import re
import sys
import json
from pathlib import Path
from collections import defaultdict
from typing import Dict, List, Set, Tuple

# Patterns pour detecter les appels API
API_PATTERNS = {
    # AngularJS patterns
    'ovhhttp_get': re.compile(r"OvhHttp\.get\s*\(\s*[`'\"]([^`'\"]+)[`'\"]"),
    'ovhhttp_post': re.compile(r"OvhHttp\.post\s*\(\s*[`'\"]([^`'\"]+)[`'\"]"),
    'ovhhttp_put': re.compile(r"OvhHttp\.put\s*\(\s*[`'\"]([^`'\"]+)[`'\"]"),
    'ovhhttp_delete': re.compile(r"OvhHttp\.delete\s*\(\s*[`'\"]([^`'\"]+)[`'\"]"),

    # AngularJS $http
    'http_get': re.compile(r"\$http\.get\s*\(\s*[`'\"]([^`'\"]+)[`'\"]"),
    'http_post': re.compile(r"\$http\.post\s*\(\s*[`'\"]([^`'\"]+)[`'\"]"),
    'http_put': re.compile(r"\$http\.put\s*\(\s*[`'\"]([^`'\"]+)[`'\"]"),
    'http_delete': re.compile(r"\$http\.delete\s*\(\s*[`'\"]([^`'\"]+)[`'\"]"),

    # Template literals avec $http
    'http_template': re.compile(r"\$http\.(get|post|put|delete)\s*\(\s*`([^`]+)`"),

    # React/TypeScript patterns (manager-core-api)
    'v2_get': re.compile(r"v2\.get\s*[<\(]\s*[`'\"]?([^`'\"<>\)]+)"),
    'v2_post': re.compile(r"v2\.post\s*[<\(]\s*[`'\"]?([^`'\"<>\)]+)"),
    'v2_put': re.compile(r"v2\.put\s*[<\(]\s*[`'\"]?([^`'\"<>\)]+)"),
    'v2_delete': re.compile(r"v2\.delete\s*[<\(]\s*[`'\"]?([^`'\"<>\)]+)"),
    'v6_get': re.compile(r"v6\.get\s*[<\(]\s*[`'\"]?([^`'\"<>\)]+)"),
    'v6_post': re.compile(r"v6\.post\s*[<\(]\s*[`'\"]?([^`'\"<>\)]+)"),
    'v6_put': re.compile(r"v6\.put\s*[<\(]\s*[`'\"]?([^`'\"<>\)]+)"),
    'v6_delete': re.compile(r"v6\.delete\s*[<\(]\s*[`'\"]?([^`'\"<>\)]+)"),

    # Iceberg pattern
    'iceberg': re.compile(r"useResourcesIcebergV2[^{]*route:\s*[`'\"]([^`'\"]+)[`'\"]"),

    # Generic fetch patterns
    'fetch_api': re.compile(r"fetch\s*\(\s*[`'\"]([^`'\"]*(?:api|engine)[^`'\"]*)[`'\"]"),

    # rootPath indicators
    'rootpath_apiv6': re.compile(r"rootPath:\s*['\"]apiv6['\"]"),
    'rootpath_2api': re.compile(r"rootPath:\s*['\"]2api['\"]"),

    # URL patterns in strings (backup)
    'url_domain': re.compile(r"[`'\"]/(domain|allDom|alldom)[^`'\"]*[`'\"]"),
    'url_services': re.compile(r"[`'\"]/services[^`'\"]*[`'\"]"),
    'url_me': re.compile(r"[`'\"]/me[^`'\"]*[`'\"]"),
    'url_sws': re.compile(r"[`'\"]/sws[^`'\"]*[`'\"]"),
}

# Extensions a scanner
SCAN_EXTENSIONS = {'.js', '.ts', '.tsx', '.jsx'}


def extract_apis_from_file(filepath: Path) -> Dict[str, List[Tuple[str, int]]]:
    """Extrait tous les appels API d un fichier."""
    results = defaultdict(list)

    try:
        content = filepath.read_text(encoding='utf-8', errors='ignore')
    except Exception as e:
        print(f"  [WARN] Cannot read {filepath}: {e}", file=sys.stderr)
        return results

    lines = content.split('\n')

    for pattern_name, pattern in API_PATTERNS.items():
        for i, line in enumerate(lines, 1):
            matches = pattern.findall(line)
            for match in matches:
                if isinstance(match, tuple):
                    endpoint = match[1] if len(match) > 1 else match[0]
                else:
                    endpoint = match

                endpoint = endpoint.strip()
                if endpoint and not endpoint.startswith('$') and len(endpoint) > 1:
                    results[pattern_name].append((endpoint, i))

    return results


def normalize_endpoint(endpoint: str) -> str:
    """Normalise un endpoint pour comparaison."""
    endpoint = re.sub(r'\$\{[^}]+\}', '{param}', endpoint)
    endpoint = re.sub(r'\$[a-zA-Z_][a-zA-Z0-9_]*', '{param}', endpoint)
    endpoint = re.sub(r':[a-zA-Z_][a-zA-Z0-9_]*', '{param}', endpoint)
    endpoint = endpoint.split('?')[0]
    endpoint = '/' + endpoint.strip('/') if endpoint else '/'
    return endpoint


def categorize_endpoint(endpoint: str) -> str:
    """Categorise un endpoint par domaine fonctionnel."""
    normalized = endpoint.lower()

    if '/domain/zone' in normalized:
        return 'Zone DNS'
    elif '/domain/alldom' in normalized or '/alldom' in normalized:
        return 'AllDom'
    elif '/domain' in normalized:
        return 'Domain'
    elif '/services' in normalized:
        return 'Services (2API)'
    elif '/me/' in normalized or normalized == '/me':
        return 'Me (Compte)'
    elif '/sws/' in normalized:
        return '2API (SWS)'
    elif '/hosting' in normalized:
        return 'Hosting'
    elif '/email' in normalized:
        return 'Email'
    else:
        return 'Autre'


def scan_directory(base_path: Path) -> Dict[str, Dict]:
    """Scan recursif d un repertoire."""
    all_apis = defaultdict(lambda: {'endpoints': set(), 'files': [], 'methods': set()})

    for filepath in base_path.rglob('*'):
        if filepath.suffix not in SCAN_EXTENSIONS:
            continue
        if 'node_modules' in str(filepath) or '__mocks__' in str(filepath):
            continue

        file_apis = extract_apis_from_file(filepath)

        for pattern_name, matches in file_apis.items():
            method = 'GET'
            if 'post' in pattern_name:
                method = 'POST'
            elif 'put' in pattern_name:
                method = 'PUT'
            elif 'delete' in pattern_name:
                method = 'DELETE'

            for endpoint, line_num in matches:
                normalized = normalize_endpoint(endpoint)
                category = categorize_endpoint(normalized)

                all_apis[category]['endpoints'].add(normalized)
                all_apis[category]['methods'].add(method)
                all_apis[category]['files'].append({
                    'file': str(filepath.relative_to(base_path)),
                    'line': line_num,
                    'endpoint': endpoint,
                    'normalized': normalized,
                    'method': method,
                    'pattern': pattern_name
                })

    return all_apis


def generate_report(apis: Dict[str, Dict], output_format: str = 'text') -> str:
    """Genere un rapport des APIs trouvees."""
    lines = []

    lines.append("=" * 70)
    lines.append("RAPPORT D EXTRACTION DES APIS")
    lines.append("=" * 70)
    lines.append("")

    total_endpoints = 0
    total_files = 0

    for category in sorted(apis.keys()):
        data = apis[category]
        endpoints = sorted(data['endpoints'])
        files = data['files']
        methods = sorted(data['methods'])

        total_endpoints += len(endpoints)
        total_files += len(set(f['file'] for f in files))

        lines.append(f"\n## {category} ({len(endpoints)} endpoints)")
        lines.append("-" * 50)
        lines.append(f"Methodes: {', '.join(methods)}")
        lines.append("")

        endpoint_details = defaultdict(list)
        for f in files:
            endpoint_details[f['normalized']].append(f)

        for endpoint in endpoints:
            details = endpoint_details.get(endpoint, [])
            methods_used = sorted(set(d['method'] for d in details))
            files_using = sorted(set(d['file'] for d in details))

            lines.append(f"  {' '.join(methods_used):12} {endpoint}")
            for file in files_using[:3]:
                lines.append(f"               -> {file}")
            if len(files_using) > 3:
                lines.append(f"               -> ... (+{len(files_using)-3} autres)")

    lines.append("")
    lines.append("=" * 70)
    lines.append(f"TOTAL: {total_endpoints} endpoints uniques dans {total_files} fichiers")
    lines.append("=" * 70)

    return '\n'.join(lines)


def main():
    if len(sys.argv) < 2:
        print("Usage: python check_api_coverage.py <dir1> [dir2] ... [--markdown]")
        print("Example: python check_api_coverage.py /tmp/old_manager_domains")
        sys.exit(1)

    dirs = []
    markdown_output = False

    for arg in sys.argv[1:]:
        if arg == '--markdown':
            markdown_output = True
        elif os.path.isdir(arg):
            dirs.append(Path(arg))
        else:
            print(f"[WARN] Not a directory: {arg}", file=sys.stderr)

    if not dirs:
        print("Error: No valid directories provided")
        sys.exit(1)

    all_apis = defaultdict(lambda: {'endpoints': set(), 'files': [], 'methods': set()})

    for dir_path in dirs:
        print(f"Scanning: {dir_path}", file=sys.stderr)
        dir_apis = scan_directory(dir_path)

        for category, data in dir_apis.items():
            all_apis[category]['endpoints'].update(data['endpoints'])
            all_apis[category]['files'].extend(data['files'])
            all_apis[category]['methods'].update(data['methods'])

    print(generate_report(all_apis))

    json_output = {}
    for category, data in all_apis.items():
        json_output[category] = {
            'endpoints': sorted(data['endpoints']),
            'methods': sorted(data['methods']),
            'file_count': len(set(f['file'] for f in data['files']))
        }

    json_path = Path('/tmp/api_coverage.json')
    json_path.write_text(json.dumps(json_output, indent=2))
    print(f"\nJSON output: {json_path}", file=sys.stderr)


if __name__ == '__main__':
    main()
```

Pour installer le script :
```bash
mkdir -p /home/ubuntu/old_manager
cat > /home/ubuntu/old_manager/check_api_coverage.py << 'SCRIPT_END'
# Coller le code ci-dessus
SCRIPT_END
chmod +x /home/ubuntu/old_manager/check_api_coverage.py
```

================================================================================
FIN PROMPT SVG2TXT v2.0
================================================================================
