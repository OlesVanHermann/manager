# CAHIER DES CHARGES - old_manager.telecom.telephony.billingAccount.billing
# Page facturation d'un groupe de facturation

## 1. RESUME EXECUTIF

### Perimetre
Section facturation et consommation d'un groupe de facturation VoIP.

### Objectif fonctionnel
Consulter les consommations, factures, gerer les depots de garantie et seuils.

### Users cibles
- Responsables financiers
- Administrateurs VoIP

---

## 2. ARCHITECTURE

### Arborescence fichiers source
```
telecom/telephony/billingAccount/billing/
├── billing.module.js
├── billing.routing.js
├── summary/
├── deposit/
├── creditThreshold/
├── bill/
├── calledFees/
├── tollfreeHistory/
└── translations/Messages_fr_FR.json
```

### Sous-modules
| Module | Description |
|--------|-------------|
| summary | Resume consommation |
| deposit | Depot de garantie |
| creditThreshold | Seuil de credit |
| bill | Releves de consommation |
| calledFees | Couts SVA |
| tollfreeHistory | Historique numeros verts |

---

## 3. PAGES & NAVIGATION

### Route
- State: `telecom.telephony.billingAccount.billing`
- URL: `/telephony/{billingAccount}/billing`

### Breadcrumb
VoIP > {billingAccount} > Facturation

### Actions disponibles
| Action | Cle traduction | Description |
|--------|----------------|-------------|
| Depot garantie | telephony_group_billing_actions_group_billing_deposit | Augmenter le plafond |
| Transfert depot | telephony_group_billing_actions_group_billing_deposit_movement | Transfert entre groupes |
| Seuil credit | telephony_group_billing_actions_group_billing_credit_threshold | Modifier limite |
| Releves | telephony_group_billing_actions_group_billing_bill | Consulter releves |
| Consommation | telephony_group_billing_actions_group_call_list_summary | Vue generale |
| Couts SVA | telephony_group_billing_actions_group_group_called_fees | Couts numeros speciaux |
| Historique SVA | telephony_group_billing_actions_group_called_fees_history | Historique couts |
| Coordonnees bancaires | telephony_group_billing_actions_group_banking_management | Modifier IBAN |
| Virement | telephony_group_billing_actions_group_delayed_account_transfert | Vers compte bancaire |

---

## 4. COMPOSANTS UI

### Menu Actions
- Liste des actions disponibles (voir tableau ci-dessus)
- Icones associees

### Tiles Resume
- Hors forfait actuel
- Depot de garantie
- Seuil credit

### Datagrid Consommations
| Colonne | Description |
|---------|-------------|
| Date | Date consommation |
| Type | Appel/SMS/Fax |
| Destination | Numero appele |
| Duree | En secondes |
| Montant | En euros |

---

## 5. APIs & DONNEES

### Endpoints

#### Consommation globale
```
GET /telephony/{billingAccount}/consumption
Response: {
  outplanSum: { value: number, text: string }
}
```

#### Historique consommation
```
GET /telephony/{billingAccount}/historyConsumption
Response: Array<string> (dates YYYY-MM)
```

#### Detail consommation par date
```
GET /telephony/{billingAccount}/historyConsumption/{date}
Response: HistoryConsumption
```

#### Fichier consommation
```
GET /telephony/{billingAccount}/historyConsumption/{date}/file
Response: { url: string, filename: string }
```

#### Depot de garantie
```
GET /telephony/{billingAccount}/amountSecurityDeposit
Response: Array<number> (montants possibles)
```

#### Seuils credit autorises
```
GET /telephony/{billingAccount}/allowedCreditThreshold
Response: Array<number>
```

#### Possibilite transfert depot
```
GET /telephony/{billingAccount}/canTransferSecurityDeposit
Response: { value: boolean }
```

#### Transfert depot
```
POST /telephony/{billingAccount}/transferSecurityDeposit
Body: { billingAccountDestination: string, amount: number }
```

---

## 6. TRADUCTIONS

### Cles i18n (FR)
| Cle | Valeur FR |
|-----|-----------|
| telephony_group_billing_breadcrumb | Facturation |
| telephony_group_billing_actions_group_billing_back_link | Retour a la facturation |
| telephony_group_billing_actions_group_billing_deposit | Augmenter le plafond de depot de garantie |
| telephony_group_billing_actions_group_billing_deposit_movement | Transfert de vos depots de garantie entre groupes |
| telephony_group_billing_actions_group_billing_credit_threshold | Modifier votre limite de depot de garantie |
| telephony_group_billing_actions_group_billing_bill | Releve de consommation |
| telephony_group_billing_actions_group_call_list_summary | Consommation generale |
| telephony_group_billing_actions_group_group_called_fees | Couts SVA du groupe |
| telephony_group_billing_actions_group_called_fees_history | Historique des couts SVA |
| telephony_group_billing_actions_group_banking_management | Changer mes coordonnees bancaires |
| telephony_group_billing_actions_group_delayed_account_transfert | Virement vers un compte bancaire |

---

## 7. REGLES METIER

### Depot de garantie
- Montants fixes proposes par l'API
- Transfert possible si canTransferSecurityDeposit = true
- Minimum depot selon offre

### Seuil credit
- Seuils autorises fournis par l'API
- Alerte si hors forfait proche du seuil

### Releves
- Archives par mois
- Telechargement PDF/CSV
