# CONSIGNES STATIC - Site Navigable depuis SVG Target

## 1. Contexte et objectif

GÃ©nÃ©rer un **site HTML statique navigable** Ã  partir des SVG target_ du New Manager OVHcloud.

**Input :** Archives `target_*.tar` contenant :
- Fichiers `.svg` : mockups visuels complets (1440x900px)
- Fichiers `.txt` : spÃ©cifications (design tokens, actions, APIs)

**Output :** Site HTML statique dans `/home/ubuntu/aiapp/static/`

**DÃ©ploiement :** `https://manager.di2amp.com/static/`

---

## 2. WORKFLOW EN 2 PHASES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SVG Source    â”‚â”€â”€â”€â”€â–¶â”‚   JSON Config   â”‚â”€â”€â”€â”€â–¶â”‚   HTML Final    â”‚
â”‚  (target_.svg)  â”‚ P1  â”‚  (zones, liens) â”‚ P2  â”‚  (cliquable)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     VISUEL              CONFIGURATION           NAVIGABLE
   (inchangÃ©)          (vÃ©rifiable/Ã©ditable)   (site final)
```

### PHASE 1 : DISCOVER (SVG â†’ JSON)

**But :** Analyser le SVG et crÃ©er un fichier JSON de configuration des liens.

**Actions :**
1. Lire le SVG source
2. Identifier TOUTES les zones cliquables :
   - NAV1 (header bleu, yâ‰ˆ32)
   - NAV2 (sous-header, yâ‰ˆ75)
   - NAV3 (tabs contextuels)
   - **ACTIONS** (boutons, liens texte dans le contenu)
3. Extraire les coordonnÃ©es X/Y de chaque Ã©lÃ©ment
4. CrÃ©er le fichier JSON avec URLs cibles

**Le JSON est vÃ©rifiable et Ã©ditable manuellement avant gÃ©nÃ©ration.**

### PHASE 2 : GENERATE (SVG + JSON â†’ HTML)

**But :** Combiner le SVG et le JSON pour crÃ©er le HTML avec liens cliquables.

**Actions :**
1. Lire le SVG source
2. Lire le JSON de configuration
3. Pour chaque zone du JSON, envelopper le `<text>` avec `<a href>`
4. Utiliser les coordonnÃ©es X/Y pour un matching prÃ©cis
5. GÃ©nÃ©rer le fichier HTML final

---

## 3. Triplet de fichiers

**Chaque page a 3 fichiers dans le mÃªme rÃ©pertoire :**

```
target_.web-cloud.domain.general.svg   # Visuel (source)
target_.web-cloud.domain.general.txt   # Description textuelle
target_.web-cloud.domain.general.json  # Configuration des liens (crÃ©Ã© par DISCOVER)
```

| Fichier | RÃ´le | CrÃ©Ã© par |
|---------|------|----------|
| `.svg` | Visuel de la page | Designer/Outil |
| `.txt` | Description textuelle | Designer/Outil |
| `.json` | Configuration des liens | **PHASE DISCOVER** |

---

## 4. FORMAT JSON - Configuration des liens

### 4.1 Structure complÃ¨te

```json
{
  "meta": {
    "svg_source": "target_.web-cloud.domain.general.svg",
    "html_target": "/static/web-cloud/domain/general.html",
    "section": "web-cloud",
    "subsection": "domain",
    "page": "general",
    "title": "Infos gÃ©nÃ©rales",
    "last_updated": "2025-12-29T14:00:00"
  },
  "nav1": {
    "active": "Web Cloud",
    "items": [
      {"label": "Accueil", "url": "/static/index.html", "x": 40, "y": 32},
      {"label": "Public Cloud", "url": "/static/public-cloud/index.html", "x": 110, "y": 32},
      {"label": "Web Cloud", "url": "/static/web-cloud/index.html", "x": 510, "y": 32}
    ]
  },
  "nav2": {
    "active": "Domaines et DNS",
    "items": [
      {"label": "Accueil", "url": "/static/web-cloud/index.html", "x": 40, "y": 75},
      {"label": "Domaines et DNS", "url": "/static/web-cloud/domain/index.html", "x": 110, "y": 75},
      {"label": "Hebergement", "url": "/static/web-cloud/hosting/general.html", "x": 240, "y": 75}
    ]
  },
  "nav3": {
    "active": "Infos generales",
    "items": [
      {"label": "Infos generales", "url": "/static/web-cloud/domain/general.html"},
      {"label": "Zone DNS", "url": "/static/web-cloud/domain/zone.html"},
      {"label": "Serveurs DNS", "url": "/static/web-cloud/domain/dns-servers.html"}
    ]
  },
  "actions": [
    {"label": "Modifier â†’", "type": "link", "x": 180, "y": 185, "url": "/static/web-cloud/domain/dns-servers.html"},
    {"label": "â†» Renouveler", "type": "refresh", "x": 795, "y": 170, "url": "/static/web-cloud/domain/modal-renew.html"},
    {"label": "+ Commander hÃ©bergement", "type": "add", "x": 805, "y": 339, "url": "/static/web-cloud/hosting/general.html"},
    {"label": "DÃ©sactiver", "type": "deactivate", "x": 505, "y": 96, "url": "#"}
  ],
  "sidebar": {
    "type": "domain-list",
    "clickable": false
  }
}
```

### 4.2 CoordonnÃ©es X/Y obligatoires

**IMPORTANT :** Les coordonnÃ©es X/Y sont **obligatoires** pour NAV1, NAV2 et ACTIONS.

Elles permettent un matching prÃ©cis et Ã©vitent les erreurs de liens dupliquÃ©s.

```json
{"label": "Web Cloud", "url": "/static/web-cloud/index.html", "x": 510, "y": 32}
```

### 4.3 Types d'actions

| Type | Pattern texte | Exemple |
|------|---------------|---------|
| `link` | `... â†’` | `Modifier â†’`, `Zone DNS â†’`, `Commander â†’` |
| `add` | `+ ...` | `+ Ajouter une entrÃ©e`, `+ Commander hÃ©bergement` |
| `refresh` | `â†» ...` | `â†» Renouveler` |
| `edit` | `Modifier ...` | `Modifier TTL` |
| `delete` | `Supprimer ...` | `Supprimer l'enregistrement` |
| `activate` | `Activer ...` | `Activer DNSSEC` |
| `deactivate` | `DÃ©sactiver ...` | `DÃ©sactiver` |
| `export` | `Exporter ...` | `Exporter en CSV` |
| `import` | `Importer ...` | `Importer zone` |
| `button` | Autre | `GÃ©rer les contacts` |

---

## 5. DÃ‰TECTION DES ACTIONS (Phase DISCOVER)

### 5.1 Patterns de dÃ©tection

Les actions sont dÃ©tectÃ©es par leur texte dans le SVG :

```python
action_patterns = [
    (r'.*â†’$', 'link'),           # Modifier â†’, Zone DNS â†’, Commander â†’
    (r'^\+\s+.*', 'add'),        # + Ajouter une entrÃ©e
    (r'^â†»\s+.*', 'refresh'),     # â†» Renouveler
    (r'^Modifier\b', 'edit'),    # Modifier, Modifier TTL
    (r'^Supprimer\b', 'delete'),
    (r'^Activer\b', 'activate'),
    (r'^DÃ©sactiver\b', 'deactivate'),
    (r'^Desactiver\b', 'deactivate'),  # Sans accent
    (r'^Commander\b', 'order'),
    (r'^Exporter\b', 'export'),
    (r'^Importer\b', 'import'),
    (r'^Configurer\b', 'config'),
    (r'^GÃ©rer\b', 'button'),
    (r'^Gerer\b', 'button'),      # Sans accent
    (r'^Voir\b', 'view'),
]
```

### 5.2 Extraction des coordonnÃ©es

Pour chaque `<text>` dÃ©tectÃ© comme action, extraire X et Y :

```xml
<text x="180" y="185" class="text-primary" font-size="11">Modifier â†’</text>
```

â†’ RÃ©sultat JSON :
```json
{"label": "Modifier â†’", "type": "link", "x": 180, "y": 185, "url": "..."}
```

### 5.3 Mapping des URLs

| Label | URL cible |
|-------|-----------|
| `Modifier â†’` (DNS) | `/static/web-cloud/domain/dns-servers.html` |
| `Zone DNS â†’` | `/static/web-cloud/domain/zone.html` |
| `Commander â†’` | `/static/web-cloud/hosting/general.html` |
| `â†» Renouveler` | `/static/web-cloud/domain/modal-renew.html` |
| `+ Ajouter une entrÃ©e` | `/static/web-cloud/domain/modal-zone-record-add.html` |
| `+ Ajouter une entree` | `/static/web-cloud/domain/modal-zone-record-add.html` |
| `Modifier TTL` | `/static/web-cloud/domain/modal-zone-ttl.html` |
| `+ Commander hÃ©bergement` | `/static/web-cloud/hosting/general.html` |
| `+ Commander emails` | `/static/web-cloud/emails/index.html` |
| `DÃ©sactiver` | `#` (pas de lien, action locale) |

### 5.4 Actions sans URL

Certaines actions n'ont pas de page cible (actions API) :

```json
{"label": "DÃ©sactiver", "type": "deactivate", "x": 505, "y": 96, "url": "#"}
```

Ces actions sont ignorÃ©es lors de la gÃ©nÃ©ration HTML.

---

## 6. GÃ‰NÃ‰RATION HTML (Phase GENERATE)

### 6.1 Matching par coordonnÃ©es

Utiliser les coordonnÃ©es X/Y du JSON pour trouver le bon `<text>` :

```python
def find_and_wrap_text(svg_content, label, url, x, y, tolerance=5):
    """
    Trouve le <text> avec le label aux coordonnÃ©es X,Y (Â±tolÃ©rance)
    et l'enveloppe avec <a href>
    """
    # Pattern avec coordonnÃ©es exactes
    pattern = rf'(<text[^>]*x="{x}"[^>]*y="{y}"[^>]*>){label}(</text>)'

    # Si pas trouvÃ©, essayer avec tolÃ©rance Â±5 pixels
    for dx in range(-tolerance, tolerance+1):
        for dy in range(-tolerance, tolerance+1):
            pattern = rf'(<text[^>]*x="{x+dx}"[^>]*y="{y+dy}"[^>]*>){label}(</text>)'
            if re.search(pattern, svg_content):
                replacement = rf'<a href="{url}" style="cursor:pointer">\1{label}\2</a>'
                return re.sub(pattern, replacement, svg_content, count=1)
```

### 6.2 Ordre de traitement

1. NAV1 (avec coordonnÃ©es)
2. NAV2 (avec coordonnÃ©es)
3. NAV3 (avec text-anchor="middle")
4. ACTIONS (avec coordonnÃ©es)
5. Conseils (optionnel)

### 6.3 Template HTML final

```html
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{TITLE} - OVHcloud Manager</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="svg-container">
    <!-- SVG avec liens <a href> injectÃ©s -->
  </div>
</body>
</html>
```

---

## 7. Convention de nommage

### 7.1 Mapping SVG â†’ HTML

| Pattern SVG | Chemin HTML |
|-------------|-------------|
| `target_.{univers}.{section}.{tab}.svg` | `/{univers}/{section}/{tab}.html` |
| `target_.{univers}.{section}.index.svg` | `/{univers}/{section}/index.html` |
| `target_.{univers}.index.svg` | `/{univers}/index.html` |

### 7.2 Exemples concrets

| Fichier SVG | Fichier HTML |
|-------------|--------------|
| `target_.web-cloud.domain.general.svg` | `/web-cloud/domain/general.html` |
| `target_.web-cloud.domain.zone.svg` | `/web-cloud/domain/zone.html` |
| `target_.web-cloud.hosting.ftp.svg` | `/web-cloud/hosting/ftp.html` |
| `target_.web-cloud.voip.line.general.svg` | `/web-cloud/voip/line/general.html` |

---

## 8. Navigation (NAV1, NAV2, NAV3)

### 8.1 NAV1 - Header bleu (y â‰ˆ 32)

| Label | URL | X |
|-------|-----|---|
| Accueil | `/static/index.html` | 40 |
| Public Cloud | `/static/public-cloud/index.html` | 110 |
| Hosted Private Cloud | `/static/private-cloud/index.html` | 210 |
| Bare Metal Cloud | `/static/bare-metal/index.html` | 370 |
| Web Cloud | `/static/web-cloud/index.html` | 510 |
| Network | `/static/network/index.html` | 620 |
| IAM / Securite | `/static/iam/index.html` | 700 |
| Licences | `/static/license/index.html` | 810 |

### 8.2 NAV2 - Sous-header (y â‰ˆ 75)

**Web Cloud :**

| Label | URL | X |
|-------|-----|---|
| Accueil | `/static/web-cloud/index.html` | 40 |
| Domaines et DNS | `/static/web-cloud/domain/index.html` | 110 |
| Hebergement | `/static/web-cloud/hosting/general.html` | 240 |
| Wordpress | `/static/web-cloud/wordpress/index.html` | 345 |
| Emails | `/static/web-cloud/emails/index.html` | 430 |
| VoIP | `/static/web-cloud/voip/lines/general.html` | 500 |
| Acces | `/static/web-cloud/access/pack-xdsl/list.html` | 550 |

### 8.3 NAV3 - Tabs contextuels

Les tabs NAV3 utilisent `text-anchor="middle"`, pas besoin de coordonnÃ©es X.

**Domain tabs :**
`general`, `zone`, `dns-servers`, `redirections`, `dynhost`, `glue`, `dnssec`, `contacts`, `tasks`, `alldom`

**Hosting tabs :**
`general`, `multisite`, `ftp`, `database`, `cron`, `modules`, `ssl`, `cdn`, `tasks`

**VoIP Line tabs :**
`general`, `phone`, `calls`, `forward`, `voicemail`, `consumption`, `options`

---

## 9. Scripts Python

### 9.1 discover_json_v2.py

Phase 1 : Analyse SVG â†’ CrÃ©e JSON

```bash
python3 /home/ubuntu/action-static/discover_json_v2.py web-cloud/domain
```

### 9.2 generate_batch_html_v2.py

Phase 2 : SVG + JSON â†’ HTML

```bash
python3 /home/ubuntu/action-static/generate_batch_html_v2.py web-cloud/domain
```

---

## 10. Workflow complet

```
1. DISCOVER   â†’ python3 discover_json_v2.py <section>
               Analyse SVG, crÃ©e les fichiers JSON

2. VÃ‰RIFIER   â†’ Inspecter les JSON gÃ©nÃ©rÃ©s
               Corriger manuellement si nÃ©cessaire

3. GENERATE   â†’ python3 generate_batch_html_v2.py <section>
               Combine SVG + JSON â†’ HTML avec liens

4. DÃ‰PLOYER   â†’ /home/ubuntu/aiapp/scripts/D3-deploy_static.sh
               Synchronise vers /var/www/aiapp/static/

5. TESTER     â†’ https://manager.di2amp.com/static/
```

---

## 11. Chemins importants

| Ã‰lÃ©ment | Chemin |
|---------|--------|
| SVG Source | `/home/ubuntu/target_manager_svg/` |
| JSON Config | `/home/ubuntu/target_manager_svg/` (Ã  cÃ´tÃ© du SVG) |
| HTML Dest | `/home/ubuntu/aiapp/static/` |
| Scripts | `/home/ubuntu/action-static/` |
| DÃ©ploiement | `/home/ubuntu/aiapp/scripts/D3-deploy_static.sh` |
| URL Prod | `https://manager.di2amp.com/static/` |

---

## 12. RÃ¨gles critiques

### 12.1 Toujours utiliser le workflow en 2 phases

```
SVG â†’ JSON (DISCOVER) â†’ HTML (GENERATE)
```

**Ne jamais sauter la phase JSON.** Le JSON permet :
- VÃ©rification manuelle avant gÃ©nÃ©ration
- Debugging plus facile
- RÃ©utilisation si le SVG change lÃ©gÃ¨rement

### 12.2 CoordonnÃ©es X/Y obligatoires

Toujours extraire les coordonnÃ©es pour :
- NAV1 (x, y=32)
- NAV2 (x, y=75)
- ACTIONS (x, y variables)

### 12.3 DÃ©tecter TOUTES les actions

Ne pas oublier les patterns :
- `â†’` (flÃ¨che droite)
- `+` (ajout)
- `â†»` (refresh)
- Verbes : Modifier, Supprimer, Activer, DÃ©sactiver, Commander, Exporter, Importer

### 12.4 GÃ©rer les accents

Supporter les variantes avec/sans accents :
- `entrÃ©e` / `entree`
- `DÃ©sactiver` / `Desactiver`
- `GÃ©rer` / `Gerer`

---

## 13. Debugging

### 13.1 VÃ©rifier le JSON gÃ©nÃ©rÃ©

```bash
cat /home/ubuntu/target_manager_svg/web-cloud/domain/target_.web-cloud.domain.general.json | jq '.actions'
```

### 13.2 Compter les liens dans le HTML

```bash
grep -c '<a href=' /home/ubuntu/aiapp/static/web-cloud/domain/general.html
```

### 13.3 VÃ©rifier une action spÃ©cifique

```bash
grep -E 'Modifier|Renouveler|Commander' /home/ubuntu/aiapp/static/web-cloud/domain/general.html
```

---

## 14. RÃ©sumÃ© des commandes

| Commande | Phase | Description |
|----------|-------|-------------|
| `discover <section>` | 1 | Analyse SVG â†’ crÃ©e JSON |
| `generate <section>` | 2 | SVG + JSON â†’ HTML |
| `deploy` | - | DÃ©ploie vers prod |
| `status` | - | Ã‰tat actuel (SVG/JSON/HTML) |
| `diff` | - | Liste les fichiers obsolÃ¨tes |

---

## 15. VALIDATION POST-DISCOVER

### 15.1 Checklist de validation

AprÃ¨s chaque DISCOVER, vÃ©rifier :

```bash
# 1. VÃ©rifier que toutes les URLs pointent vers des pages existantes
for json in /home/ubuntu/target_manager_svg/web-cloud/<section>/*/*.json; do
  grep -oP '"url": "/static/[^"]+\.html"' "$json" | \
  while read url; do
    target=$(echo "$url" | sed 's/"url": "\/static\///' | tr -d '"')
    if [ ! -f "/home/ubuntu/aiapp/static/$target" ]; then
      echo "âŒ MANQUANT: $target (rÃ©fÃ©rencÃ© dans $json)"
    fi
  done
done
```

### 15.2 Erreurs courantes

| Erreur | Cause | Solution |
|--------|-------|----------|
| URL vers `optin.html` | Ancien naming | Corriger vers `modal-xxx.html` |
| URL vers `#` pour action | Action sans page | OK, comportement attendu |
| URL vers page inexistante | SVG modal manquant | CrÃ©er le SVG ou corriger l'URL |
| Doublon de coordonnÃ©es | MÃªme X/Y pour 2 liens | VÃ©rifier le SVG source |

### 15.3 Correction manuelle du JSON

Si une URL est incorrecte dans le JSON :

```bash
# Ã‰diter directement le JSON
nano /home/ubuntu/target_manager_svg/web-cloud/<section>/<page>/target_.<page>.json

# Ou via sed
sed -i 's|/static/web-cloud/wordpress/optin.html|/static/web-cloud/wordpress/modal-cdn.html|g' fichier.json
```

---

## 16. PAGES REDONDANTES

### 16.1 Cas identifiÃ© : index.svg vs general.svg

Certaines sections ont deux pages avec le mÃªme contenu NAV3 :
- `index.svg` : point d'entrÃ©e (landing page)
- `general.svg` : onglet "GÃ©nÃ©ral" (info dÃ©taillÃ©e)

**Exemple WordPress :**
```
target_.web-cloud.wordpress.index.svg      â†’ /static/web-cloud/wordpress/index.html
target_.web-cloud.wordpress.general.svg    â†’ /static/web-cloud/wordpress/general.html
```

Ces deux pages ont le mÃªme NAV3 (6 onglets) mais des contenus diffÃ©rents.

### 16.2 RÃ¨gle de gestion

| Situation | Action |
|-----------|--------|
| `index.svg` = landing page vide | Rediriger vers `general.html` |
| `index.svg` = contenu diffÃ©rent | Garder les deux |
| `index.svg` = doublon exact | Supprimer `index.svg` |

### 16.3 Comment dÃ©tecter les doublons

```bash
# Comparer le NAV3 de index vs general
diff <(grep 'nav3' index.json) <(grep 'nav3' general.json)

# Si identique, comparer le contenu principal
diff -y <(sed -n '/<g transform="translate(0, 95)">/,/<\/g>/p' index.svg) \
        <(sed -n '/<g transform="translate(0, 95)">/,/<\/g>/p' general.svg)
```

---

## 17. MAPPINGS SPÃ‰CIFIQUES PAR SECTION

### 17.1 Pourquoi des mappings spÃ©cifiques ?

Chaque section a ses propres conventions d'actions et URLs cibles.
Le script `discover_json_v2.py` utilise un dictionnaire `subsection_mapping`.

### 17.2 Mapping WordPress

```python
"wordpress": {
    "configurer cdn": "/static/web-cloud/wordpress/modal-cdn.html",
    "creer un site": "/static/web-cloud/wordpress/modal-create.html",
    "crÃ©er un site": "/static/web-cloud/wordpress/modal-create.html",
    "importer un site": "/static/web-cloud/wordpress/modal-import.html",
    "supprimer le site": "/static/web-cloud/wordpress/modal-delete.html",
    "+ ajouter domaine": "/static/web-cloud/wordpress/modal-domain-add.html",
    "restaurer": "/static/web-cloud/wordpress/modal-backup-restore.html",
    "configurer ssl": "/static/web-cloud/wordpress/modal-ssl.html",
    "+ creer une sauvegarde": "/static/web-cloud/wordpress/modal-backup-restore.html",
    "acceder a l'admin": None,  # Lien externe, pas de page
}
```

### 17.3 Mapping Domain

```python
"domain": {
    "modifier â†’": "/static/web-cloud/domain/dns-servers.html",
    "zone dns â†’": "/static/web-cloud/domain/zone.html",
    "â†» renouveler": "/static/web-cloud/domain/modal-renew.html",
    "+ ajouter une entrÃ©e": "/static/web-cloud/domain/modal-zone-record-add.html",
    "modifier ttl": "/static/web-cloud/domain/modal-zone-ttl.html",
    "activer dnssec": "/static/web-cloud/domain/modal-dnssec.html",
}
```

### 17.4 Mapping VoIP

```python
"voip": {
    "configurer renvoi": "/static/web-cloud/voip/lines/forward.html",
    "modifier mot de passe": "/static/web-cloud/voip/lines/modal-password.html",
    "commander telephone": "/static/web-cloud/voip/lines/modal-phone-order.html",
    "renouveler": "/static/web-cloud/voip/groups/modal-renew.html",
}
```

### 17.5 Comment ajouter un nouveau mapping

1. Identifier les actions uniques de la section
2. Ajouter au dictionnaire `subsection_mapping` dans `discover_json_v2.py`
3. Re-exÃ©cuter DISCOVER sur la section
4. Valider les JSON gÃ©nÃ©rÃ©s

```python
# Dans discover_json_v2.py, fonction determine_action_url()
subsection_mapping = {
    "nouvelle_section": {
        "action label": "/static/path/to/target.html",
    }
}
```

---

## 18. RÃ©sumÃ© des bonnes pratiques

### 18.1 Avant DISCOVER
- VÃ©rifier que tous les SVG source existent
- S'assurer que les modals ont leur SVG

### 18.2 AprÃ¨s DISCOVER
- Valider les JSON gÃ©nÃ©rÃ©s
- VÃ©rifier les URLs (pas de `optin.html` ou URLs cassÃ©es)
- Corriger manuellement si nÃ©cessaire

### 18.3 AprÃ¨s GENERATE
- Tester les liens en local
- VÃ©rifier le nombre de `<a href>` dans les HTML
- DÃ©ployer et tester en prod

---

## 19. RÃ‰PERTOIRES DE SUIVI

### 19.1 Structure

```
/home/ubuntu/action-static/
â”œâ”€â”€ todo/                    # SVG Ã  crÃ©er (pages manquantes)
â”‚   â”œâ”€â”€ wordpress-missing.txt
â”‚   â”œâ”€â”€ domain-missing.txt
â”‚   â””â”€â”€ voip-missing.txt
â”œâ”€â”€ toremove/                # SVG Ã  supprimer (doublons)
â”‚   â”œâ”€â”€ wordpress-duplicates.txt
â”‚   â””â”€â”€ hosting-duplicates.txt
â””â”€â”€ tmp/                     # Backups temporaires
```

### 19.2 RÃ©pertoire todo/ - Pages manquantes

Contient les fichiers listant les SVG Ã  crÃ©er :

```bash
# Format du fichier <section>-missing.txt
=== Analyse <Section> - SVG manquants ===

MANQUANT: modal-xxx.html (SVG: target_.web-cloud.xxx.modal-xxx.svg)
  RÃ©fÃ©rencÃ© dans: page.json
```

**Quand ajouter :**
- Action dans un JSON pointe vers une page sans SVG
- Nouveau bouton ajoutÃ© dans un SVG existant

**Script de dÃ©tection :**
```bash
# Trouver les pages rÃ©fÃ©rencÃ©es sans SVG
for json in /home/ubuntu/target_manager_svg/web-cloud/<section>/*/*.json; do
  grep -oP '"url": "/static/[^"]+\.html"' "$json" | while read url; do
    page=$(echo "$url" | sed 's|.*/||' | tr -d '"')
    svg_name="target_.web-cloud.<section>.${page%.html}.svg"
    if ! find /home/ubuntu/target_manager_svg -name "$svg_name" | grep -q .; then
      echo "MANQUANT: $page"
    fi
  done
done
```

### 19.3 RÃ©pertoire toremove/ - Doublons

Contient les fichiers listant les SVG redondants :

```bash
# Format du fichier <section>-duplicates.txt
=== <Section> - Doublons potentiels ===

Fichiers comparÃ©s:
  - index.svg: 238 lignes
  - general.svg: 196 lignes

NAV3 identiques? OUI

RECOMMANDATION:
  index.svg peut Ãªtre supprimÃ© ou redirigÃ© vers general.html
  Fichier: /path/to/index.svg
```

**Cas typiques de doublons :**

| Doublon | Original | Action |
|---------|----------|--------|
| `index.svg` | `general.svg` | Supprimer index, rediriger |
| `dashboard.svg` | `general.svg` | Garder si contenu diffÃ©rent |
| `list.svg` | `index.svg` | VÃ©rifier le contenu |

### 19.4 Workflow de nettoyage

```bash
# 1. Analyser une section
python3 discover_json_v2.py web-cloud/<section>

# 2. VÃ©rifier les manquants
cat /home/ubuntu/action-static/todo/<section>-missing.txt

# 3. VÃ©rifier les doublons
cat /home/ubuntu/action-static/toremove/<section>-duplicates.txt

# 4. CrÃ©er les SVG manquants ou corriger les JSON
# 5. Supprimer les doublons aprÃ¨s validation

# 6. RÃ©gÃ©nÃ©rer
python3 generate_batch_html_v2.py web-cloud/<section>
```

### 19.5 Ne jamais supprimer sans vÃ©rification

Avant de supprimer un fichier listÃ© dans `toremove/` :

1. VÃ©rifier qu'aucun lien ne pointe vers cette page
2. VÃ©rifier que le contenu est vraiment dupliquÃ©
3. Mettre en place une redirection si nÃ©cessaire
4. Faire un backup dans `tmp/`

```bash
# Backup avant suppression
cp --backup=numbered fichier.svg /home/ubuntu/action-static/tmp/
```

---

## 20. NAV4 - SUB-TABS

### 20.1 DÃ©finition

NAV4 = sous-onglets Ã  l'intÃ©rieur d'un NAV3. Exemple : Extensions â†’ ThÃ¨mes / Plugins

### 20.2 DÃ©tection

- Position : sous NAV3 (y â‰ˆ 14 dans le groupe translate)
- PAS de `text-anchor="middle"`
- Classe `text-primary` ou `text-dark`

```xml
<g transform="translate(0, 95)">
  <text x="16" y="14" class="text-primary" font-size="12" font-weight="600">ThÃ¨mes</text>
  <text x="80" y="14" class="text-muted" font-size="12">Plugins</text>
</g>
```

### 20.3 JSON

```json
"nav4": {
  "active": "ThÃ¨mes",
  "items": [
    {"label": "ThÃ¨mes", "url": "/static/web-cloud/wordpress/extensions-themes.html"},
    {"label": "Plugins", "url": "/static/web-cloud/wordpress/extensions-plugins.html"}
  ]
}
```

### 20.4 Sections avec NAV4

| Section | NAV3 parent | NAV4 items |
|---------|-------------|------------|
| WordPress | Extensions | ThÃ¨mes, Plugins |
| VoIP | Consommation | Appels entrants, Appels sortants |

---

## 21. LIENS EXTERNES

### 21.1 DÃ©finition

Liens qui pointent vers des ressources externes (pas de page HTML interne).

**RÃˆGLE :** Tous les liens externes pointent vers `/static/lien_externe.html` (mÃªme onglet)

### 21.2 Types de liens externes

| Label | Type | Comportement |
|-------|------|--------------|
| `ğŸ“ Admin WP` | Lien externe | Ouvre l'admin WordPress du client |
| `ğŸŒ Visiter` | Lien externe | Ouvre le site du client |
| `Guides` | Lien externe | Ouvre la documentation OVH |
| `https://...` | URL affichÃ©e | Lien vers le site |

### 21.3 JSON

```json
{
  "label": "ğŸ“ Admin WP",
  "type": "external",
  "x": 50,
  "y": 19,
  "url": "/static/lien_externe.html"
}
```

### 21.4 GÃ©nÃ©ration HTML

- Tous les liens externes â†’ `/static/lien_externe.html` (mÃªme onglet)
- Une seule page pour tous les liens externes (standardisÃ©)

```html
<a href="/static/lien_externe.html" style="cursor:pointer" title="Lien externe">
  <text>ğŸ“ Admin WP</text>
</a>
```

### 21.5 Page lien_externe.html

Fichier : `/home/ubuntu/aiapp/static/lien_externe.html`

Cette page informe l'utilisateur qu'il s'agit d'un prototype et que le lien externe n'est pas disponible.

---

## 22. BOUTONS MODAUX

### 22.1 DÃ©finition

Boutons dans les modales (Annuler, CrÃ©er, Supprimer, etc.).

### 22.2 Types de boutons

| Label | Type | URL cible |
|-------|------|-----------|
| `Annuler` | cancel | Page parent |
| `Fermer` | close | Page parent |
| `CrÃ©er le site` | submit | `#` (action API) |
| `Enregistrer` | submit | `#` |
| `Supprimer` | danger | `#` |
| `RÃ©initialiser` | submit | `#` |

### 22.3 DÃ©tection

- Position : bas de la modale (y > 300 gÃ©nÃ©ralement)
- Dans un footer aprÃ¨s `<line>` de sÃ©paration
- `text-anchor="middle"` souvent

### 22.4 JSON

```json
"modal_buttons": [
  {"label": "Annuler", "type": "cancel", "url": "/static/web-cloud/wordpress/general.html"},
  {"label": "CrÃ©er le site", "type": "submit", "url": "#"}
]
```

### 22.5 DÃ©termination de l'URL parent

Pour les boutons `cancel` et `close`, l'URL parent est dÃ©duite du nom de fichier :

```
modal-create.html â†’ parent = general.html ou index.html
modal-delete.html â†’ parent = general.html
modal-domain-add.html â†’ parent = domains.html
```

---

## 23. EMOJIS DANS LES LABELS

### 23.1 Emojis courants

| Emoji | Signification | Type d'action |
|-------|---------------|---------------|
| ğŸ“ | Admin/Ã‰dition | Lien externe |
| ğŸŒ | Web/Visiter | Lien externe |
| ğŸ—‘ | Supprimer/Vider | Action dangereuse |
| â†© | Restaurer | Action de backup |
| ğŸ”’ | SSL/SÃ©curitÃ© | Action modale |
| ğŸ”‘ | Mot de passe | Action modale |
| â¬† | Mise Ã  jour | Action API |
| ğŸ’¡ | Conseil | Informatif (non cliquable) |
| âš ï¸ | Avertissement | Informatif (non cliquable) |

### 23.2 DÃ©tection

Les emojis peuvent Ãªtre au dÃ©but ou Ã  la fin du label :
- `ğŸ“ Admin WP` â†’ Emoji prÃ©fixe
- `Vider le cache ğŸ—‘` â†’ Emoji suffixe

### 23.3 Normalisation pour matching

```python
# Retirer les emojis pour le matching si nÃ©cessaire
import re
label_clean = re.sub(r'[\U0001F300-\U0001F9FF]', '', label).strip()
```

---

## 24. CATÃ‰GORIES D'Ã‰LÃ‰MENTS NON CLIQUABLES

### 24.1 Classification

| CatÃ©gorie | Exemples | Raison | Action |
|-----------|----------|--------|--------|
| **Externe** | Admin WP, Visiter, Guides | Pointe hors du manager | `href="#"` avec title |
| **JS** | GÃ©nÃ©rer, Copier config, VÃ©rifier | Action JavaScript locale | `href="#"` |
| **Modal** | Restaurer, SSL, Supprimer | Devrait ouvrir une modale | Corriger vers `modal-xxx.html` |
| **Informatif** | URLs affichÃ©es, badges | Pas une action | Ne pas wrapper |

### 24.2 Analyse automatique

```bash
# Trouver les <text class="text-primary"> sans <a href>
grep -E '<text[^>]*class="text-primary"[^>]*>[^<]+</text>' page.html | grep -v '<a href'
```

### 24.3 RÃ©solution

| Si catÃ©gorie | Alors |
|--------------|-------|
| Externe | Ajouter `<a href="/static/lien_externe.html">` |
| JS | Ajouter `<a href="#">` |
| Modal | Corriger JSON avec URL de la modale |
| Informatif | Laisser tel quel |

---

## 25. FORMAT FICHIERS TODO

### 25.1 Nouveau format de nommage

**Ancien :** `<section>-missing.txt`
**Nouveau :** `NAV1.NAV2.NAV3.txt`

Exemples :
- `web-cloud.wordpress.txt` (toutes les pages WordPress)
- `web-cloud.domain.general.txt` (une page spÃ©cifique)
- `bare-metal.dedicated.txt`

### 25.2 Contenu du fichier

```
=== SVG manquants pour web-cloud.wordpress ===
Date: 2025-12-29

Pages HTML crÃ©Ã©es manuellement (sans SVG source):
- modal-password.html (crÃ©Ã© le 2025-12-29)

SVG existants (16 fichiers):
âœ… target_.web-cloud.wordpress.index.svg
âœ… target_.web-cloud.wordpress.general.svg
...

SVG Ã  crÃ©er:
âŒ target_.web-cloud.wordpress.modal-password.svg
```

### 25.3 Quand crÃ©er un fichier todo

1. AprÃ¨s DISCOVER d'une section
2. Quand une page HTML est crÃ©Ã©e manuellement
3. Quand un lien pointe vers une page sans SVG source

---

## 26. MODES D'EXÃ‰CUTION

### 26.1 Deux environnements

| Mode | Interface | Prompt chargÃ© via | Actions disponibles |
|------|-----------|-------------------|---------------------|
| **Web** | claude.ai/chat | Copier-coller ou upload fichier | Toutes |
| **Shell** | `claude` CLI | CLAUDE.md automatique | Toutes + filesystem direct |

### 26.2 DiffÃ©rences clÃ©s

| Aspect | Web | Shell |
|--------|-----|-------|
| AccÃ¨s filesystem | Via upload/download | Direct |
| ExÃ©cution bash | Non | Oui |
| CLAUDE.md | Ã€ coller manuellement | Auto-chargÃ© |
| Persistence | Session chat | Session terminal |
| Interruption | Fermer onglet | Ctrl+C |

### 26.3 Format homogÃ¨ne des commandes

Pour garantir l'interopÃ©rabilitÃ©, les commandes suivent ce format :

```
<action> [<cible>] [--options]
```

**Exemples :**
- `menu` â†’ Affiche les actions disponibles
- `status` â†’ Ã‰tat actuel
- `discover wordpress` â†’ Analyse la section wordpress
- `generate wordpress --force` â†’ RÃ©gÃ©nÃ¨re mÃªme si Ã  jour

### 26.4 Adaptation automatique

Le prompt dÃ©tecte le mode et adapte son comportement :

| Si mode | Alors |
|---------|-------|
| Web | Proposer les commandes textuelles, afficher les rÃ©sultats |
| Shell | ExÃ©cuter directement, Ã©crire les fichiers |

### 26.5 Comment dÃ©marrer

**Mode Web :**
```
1. Ouvrir claude.ai
2. Coller le contenu de prompt_static.txt
3. Ou uploader le fichier
4. Taper: menu
```

**Mode Shell :**
```bash
cd /home/ubuntu/action-static
claude
# CLAUDE.md est chargÃ© automatiquement
# Taper: menu
```

---

## 27. ACTIONS STANDARD

### 27.1 Action `menu`

Affiche toutes les actions disponibles avec leur description.

**Commande :** `menu`

**Output attendu :**
```
----------------*--------------------------*--------------------------------------------------------------------------------
                              STATIC SITE GENERATOR - SVG â†’ JSON â†’ HTML
----------------*--------------------------*--------------------------------------------------------------------------------
action          | parametres               | explication
----------------*--------------------------*--------------------------------------------------------------------------------
                |                          |
    NAVIGATION  |                          |
----------------*--------------------------*--------------------------------------------------------------------------------
init            |                          | reload les prompts: CLAUDE.md + prompt_static.txt
menu            |                          | afficher ce menu
help            | <action>                 | aide dÃ©taillÃ©e sur une action
context         | NAV1                     | changer le contexte de travail (ex: context web-cloud)
context         | NAV1/NAV2                | changer le contexte (ex: context wordpress)
----------------*--------------------------*--------------------------------------------------------------------------------
                |                          |
    ANALYSE     |                          |
----------------*--------------------------*--------------------------------------------------------------------------------
status          |                          | Ã©tat global: compter SVG/JSON/HTML
status          | NAV1                     | Ã©tat d'un univers (ex: status web-cloud)
status          | NAV1/NAV2                | Ã©tat d'une section (ex: status wordpress)
diff            |                          | comparer dates SVG/JSON/HTML, lister obsolÃ¨tes
diff            | NAV1/NAV2                | comparer une section spÃ©cifique
list            | svg                      | lister tous les SVG
list            | svg NAV1/NAV2            | lister SVG d'une section (ex: list svg wordpress)
list            | json NAV1/NAV2           | lister JSON d'une section
list            | html NAV1/NAV2           | lister HTML d'une section
check           | NAV1/NAV2                | vÃ©rifier liens 404, Ã©lÃ©ments non cliquables d'une section
check           | NAV1/NAV2/NAV3           | vÃ©rifier une page spÃ©cifique (ex: check wordpress/general)
analyze         | NAV1/NAV2/NAV3           | analyse dÃ©taillÃ©e d'une page (liens, NAV, actions)
todo            |                          | afficher tous les SVG manquants (dossier todo/)
todo            | NAV1/NAV2                | SVG manquants d'une section
----------------*--------------------------*--------------------------------------------------------------------------------
                |                          |
    GÃ‰NÃ‰RATION  |                          |
----------------*--------------------------*--------------------------------------------------------------------------------
discover        | NAV1/NAV2                | Phase 1: analyser SVG â†’ crÃ©er JSON pour une section
discover        | NAV1/NAV2/NAV3           | Phase 1: analyser un SVG spÃ©cifique â†’ crÃ©er JSON
generate        | NAV1/NAV2                | Phase 2: SVG + JSON â†’ HTML pour une section
generate        | NAV1/NAV2/NAV3           | Phase 2: gÃ©nÃ©rer un HTML spÃ©cifique
generate        | NAV1/NAV2 --force        | rÃ©gÃ©nÃ©rer mÃªme si Ã  jour
fix             | NAV1/NAV2                | corriger automatiquement les problÃ¨mes d'une section
fix             | NAV1/NAV2/NAV3           | corriger une page spÃ©cifique
fix             | NAV1/NAV2 --dry-run      | simuler sans Ã©crire
----------------*--------------------------*--------------------------------------------------------------------------------
                |                          |
    DÃ‰PLOIEMENT |                          |
----------------*--------------------------*--------------------------------------------------------------------------------
deploy          |                          | dÃ©ployer tout vers prod (https://manager.di2amp.com/static/)
----------------*--------------------------*--------------------------------------------------------------------------------

ğŸ“ Contexte actuel: {CONTEXT}
ğŸ’¡ Raccourcis: si contexte=wordpress, "discover general" = "discover wordpress/general"

Exemples:
  discover wordpress              â†’ analyse tous les SVG wordpress, crÃ©e les JSON
  generate wordpress --force      â†’ rÃ©gÃ©nÃ¨re tous les HTML wordpress
  check wordpress/general         â†’ vÃ©rifie liens et Ã©lÃ©ments de general.html
  analyze wordpress/backups       â†’ analyse dÃ©taillÃ©e de backups.html
  fix wordpress                   â†’ corrige automatiquement les problÃ¨mes

----------------*--------------------------*--------------------------------------------------------------------------------
```

### 27.2 Liste des actions

| Action | Syntaxe | Niveau | Description |
|--------|---------|--------|-------------|
| `menu` | `menu` | - | Affiche les actions disponibles |
| `help` | `help <action>` | - | Aide sur une action spÃ©cifique |
| `context` | `context <path>` | NAV1-2 | Change le contexte de travail |
| `status` | `status [path]` | NAV1-2 | Ã‰tat actuel (SVG/JSON/HTML) |
| `diff` | `diff [path]` | NAV1-2 | Compare dates, liste obsolÃ¨tes |
| `list` | `list <type> [path]` | NAV1-2 | Liste fichiers (svg/json/html) |
| `todo` | `todo [path]` | NAV1-2 | Affiche SVG manquants |
| `discover` | `discover <path>` | NAV1-3 | Phase 1: SVG â†’ JSON |
| `generate` | `generate <path>` | NAV1-3 | Phase 2: JSON â†’ HTML |
| `check` | `check <path>` | NAV1-3 | VÃ©rifie liens 404, non cliquables |
| `fix` | `fix <path>` | NAV2-3 | Corrige problÃ¨mes automatiquement |
| `analyze` | `analyze <page>` | NAV3 | Analyse dÃ©taillÃ©e d'une page |
| `deploy` | `deploy` | NAV1 | DÃ©ploie vers prod |

### 27.3 Action `check`

VÃ©rifie une section ou page pour dÃ©tecter les problÃ¨mes.

**Commande :** `check <path>`

**Exemples :**
```
check wordpress           # Toute la section
check wordpress/general   # Une page spÃ©cifique
```

**Output attendu :**
```
=== CHECK wordpress ===

ğŸ“„ Pages analysÃ©es: 16

âŒ Liens 404 (1):
   general.html â†’ modal-password.html (MANQUANT)

âš ï¸ Ã‰lÃ©ments non cliquables (12):
   backups.html:
   - "â†© Restaurer" (x5) â†’ Type: Modal
   - "Guides" â†’ Type: Externe

   domains.html:
   - "ğŸ”’ SSL" (x3) â†’ Type: Modal
   - "ğŸ“‹ Copier config" â†’ Type: JS

âœ… Pages OK: 14/16

Recommandation:
â†’ fix wordpress/backups  (ajouter liens modaux)
â†’ CrÃ©er modal-password.svg
```

### 27.4 Action `fix`

Corrige automatiquement les problÃ¨mes simples.

**Commande :** `fix <path>`

**Ce qui est corrigÃ© :**
- Liens externes â†’ `<a href="/static/lien_externe.html">`
- Actions JS â†’ `<a href="#">`
- Boutons modaux â†’ Lien vers modal-xxx.html si existe

**Ce qui N'est PAS corrigÃ© (nÃ©cessite intervention) :**
- SVG manquants
- URLs vers pages inexistantes
- Structure NAV incorrecte

### 27.5 Action `analyze`

Analyse dÃ©taillÃ©e d'une page spÃ©cifique.

**Commande :** `analyze <page>`

**Output attendu :**
```
=== ANALYZE wordpress/general ===

ğŸ“„ Fichiers:
   SVG: âœ… target_.web-cloud.wordpress.general.svg
   JSON: âœ… target_.web-cloud.wordpress.general.json
   HTML: âœ… /static/web-cloud/wordpress/general.html

ğŸ”— Liens (30 total):
   NAV1: 6 liens âœ…
   NAV2: 7 liens âœ…
   NAV3: 6 liens âœ…
   NAV4: 0 liens
   Actions: 11 liens

âš ï¸ Non cliquables (2):
   - "ğŸ“ AccÃ©der Ã  l'admin WordPress" â†’ Externe
   - "ğŸŒ Visiter le site" â†’ Externe

ğŸ“Š Score: 28/30 (93%)
```

### 27.6 Action `list`

Liste les fichiers d'un type dans une section.

**Commande :** `list <type> [path]`

**Types :** `svg`, `json`, `html`, `all`

**Exemples :**
```
list svg wordpress        # SVG de wordpress
list json web-cloud       # Tous les JSON web-cloud
list html                 # Tous les HTML
list all wordpress        # SVG + JSON + HTML
```

### 27.7 Action `todo`

Affiche le contenu des fichiers todo/.

**Commande :** `todo`

**Output attendu :**
```
=== TODO - SVG MANQUANTS ===

ğŸ“ web-cloud.wordpress.txt (1 manquant):
   âŒ target_.web-cloud.wordpress.modal-password.svg

ğŸ“ web-cloud.domain.txt (3 manquants):
   âŒ target_.web-cloud.domain.modal-renew.svg
   âŒ target_.web-cloud.domain.modal-transfer.svg
   âŒ target_.web-cloud.domain.modal-dnssec.svg

Total: 4 SVG Ã  crÃ©er
```

### 27.8 Options communes

| Option | Description | Applicable Ã  |
|--------|-------------|--------------|
| `--force` | RÃ©gÃ©nÃ¨re mÃªme si Ã  jour | generate |
| `--dry-run` | Simule sans Ã©crire | fix, generate |
| `--verbose` | Affichage dÃ©taillÃ© | tous |
| `--quiet` | Affichage minimal | tous |

**Exemples :**
```
generate wordpress --force      # Force rÃ©gÃ©nÃ©ration
fix wordpress --dry-run         # Simule les corrections
check wordpress --verbose       # DÃ©tails complets
```

---

## 28. CONTEXTE DE NAVIGATION (NAV1/NAV2/NAV3)

### 28.1 HiÃ©rarchie des chemins

Les actions utilisent un chemin qui reflÃ¨te la navigation :

```
<NAV1>/<NAV2>/<NAV3>
```

| Niveau | Exemple | Description |
|--------|---------|-------------|
| NAV1 | `web-cloud` | Univers principal |
| NAV2 | `web-cloud/wordpress` | Section |
| NAV3 | `web-cloud/wordpress/general` | Page/Onglet |

### 28.2 Syntaxe des chemins

```bash
# NAV1 seul â†’ Tout l'univers
check web-cloud

# NAV1/NAV2 â†’ Toute la section
check web-cloud/wordpress
discover wordpress              # Raccourci si NAV1 = web-cloud

# NAV1/NAV2/NAV3 â†’ Page spÃ©cifique
analyze web-cloud/wordpress/general
analyze wordpress/general       # Raccourci
```

### 28.3 Raccourcis par contexte

Si le contexte NAV1 est Ã©vident (ex: travail sur web-cloud), les raccourcis sont autorisÃ©s :

| Chemin complet | Raccourci | Contexte implicite |
|----------------|-----------|-------------------|
| `web-cloud/wordpress` | `wordpress` | NAV1 = web-cloud |
| `web-cloud/wordpress/general` | `wordpress/general` | NAV1 = web-cloud |
| `web-cloud/domain/zone` | `domain/zone` | NAV1 = web-cloud |
| `bare-metal/dedicated/list` | `dedicated/list` | NAV1 = bare-metal |

### 28.4 Actions par niveau

| Action | NAV1 | NAV2 | NAV3 | Description |
|--------|:----:|:----:|:----:|-------------|
| `status` | âœ… | âœ… | âŒ | Ã‰tat global ou section |
| `diff` | âœ… | âœ… | âŒ | Compare au niveau section |
| `discover` | âœ… | âœ… | âœ… | Analyse un ou plusieurs SVG |
| `generate` | âœ… | âœ… | âœ… | GÃ©nÃ¨re un ou plusieurs HTML |
| `check` | âœ… | âœ… | âœ… | VÃ©rifie liens et Ã©lÃ©ments |
| `analyze` | âŒ | âŒ | âœ… | Analyse une page spÃ©cifique |
| `fix` | âŒ | âœ… | âœ… | Corrige section ou page |
| `list` | âœ… | âœ… | âŒ | Liste fichiers |
| `todo` | âœ… | âœ… | âŒ | SVG manquants |
| `deploy` | âœ… | âŒ | âŒ | DÃ©ploie tout |

### 28.5 Exemples par niveau

**Niveau NAV1 (univers) :**
```bash
status web-cloud              # Ã‰tat de tout web-cloud
list svg public-cloud         # Tous les SVG public-cloud
deploy                        # DÃ©ploie tout
```

**Niveau NAV2 (section) :**
```bash
discover wordpress            # Analyse tous les SVG wordpress
generate domain               # GÃ©nÃ¨re tous les HTML domain
check voip                    # VÃ©rifie toute la section VoIP
todo hosting                  # SVG manquants pour hosting
```

**Niveau NAV3 (page) :**
```bash
analyze wordpress/general     # Analyse dÃ©taillÃ©e de general.html
fix wordpress/backups         # Corrige backups.html
discover domain/zone          # Analyse zone.svg uniquement
generate hosting/ssl          # GÃ©nÃ¨re ssl.html uniquement
```

### 28.6 Arborescence NAV complÃ¨te

```
NAV1: web-cloud/
â”œâ”€â”€ NAV2: domain/
â”‚   â”œâ”€â”€ NAV3: general, zone, dns-servers, redirections, dynhost,
â”‚   â”‚         glue, dnssec, contacts, tasks, alldom
â”‚   â””â”€â”€ Modals: modal-renew, modal-transfer, modal-zone-add...
â”‚
â”œâ”€â”€ NAV2: hosting/
â”‚   â”œâ”€â”€ NAV3: general, multisite, ftp, database, cron, modules,
â”‚   â”‚         ssl, cdn, tasks
â”‚   â””â”€â”€ Modals: modal-database-add, modal-ssl-order...
â”‚
â”œâ”€â”€ NAV2: wordpress/
â”‚   â”œâ”€â”€ NAV3: general, domains, performance, extensions, backups, tasks
â”‚   â”œâ”€â”€ NAV4: extensions â†’ themes, plugins
â”‚   â””â”€â”€ Modals: modal-create, modal-delete, modal-cdn, modal-ssl...
â”‚
â”œâ”€â”€ NAV2: emails/
â”‚   â”œâ”€â”€ NAV3: accounts, redirections, filters, autoresponders
â”‚   â””â”€â”€ Modals: modal-add-account, modal-add-redirect...
â”‚
â”œâ”€â”€ NAV2: voip/
â”‚   â”œâ”€â”€ NAV3-lines: general, phone, calls, forward, voicemail...
â”‚   â”œâ”€â”€ NAV3-groups: dashboard, services, phonebook, billing, admin
â”‚   â”œâ”€â”€ NAV3-numbers: general, redirect, queue, ivr, conference...
â”‚   â””â”€â”€ NAV3-fax: general, send, campaigns, incoming, outgoing...
â”‚
â””â”€â”€ NAV2: access/
    â””â”€â”€ NAV3: pack-xdsl, overthebox...

NAV1: public-cloud/
â”œâ”€â”€ NAV2: instances, block-storage, object-storage, databases...

NAV1: bare-metal/
â”œâ”€â”€ NAV2: dedicated, vps, ip, vrack, nasha...

NAV1: private-cloud/
â”œâ”€â”€ NAV2: vmware, nutanix...

NAV1: network/
â”œâ”€â”€ NAV2: cdn, iplb, vrack...
```

### 28.7 DÃ©tection automatique du contexte

Le systÃ¨me dÃ©tecte le contexte actuel :

```bash
# Si dernier travail = wordpress
> discover general
# InterprÃ©tÃ© comme: discover wordpress/general

# Pour changer de contexte
> context domain
# Maintenant les raccourcis s'appliquent Ã  domain

# Ou spÃ©cifier explicitement
> discover hosting/ssl
# Force le contexte hosting
```

### 28.8 Affichage du contexte dans menu

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATIC SITE GENERATOR - ACTIONS DISPONIBLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ Contexte actuel: web-cloud/wordpress

ğŸ“‹ NAVIGATION
   menu              Affiche ce menu
   context <path>    Change le contexte NAV
   ...
```

---

## 29. RÃˆGLES DE LIENS OBLIGATOIRES

### 29.1 Principe fondamental

**TOUT Ã©lÃ©ment visuellement cliquable DOIT avoir un `<a href>`.**

Un Ã©lÃ©ment est visuellement cliquable si :
- Il ressemble Ã  un bouton (`<rect>` + `<text>`)
- Il a une couleur d'action (`text-primary`, `text-error`, `text-white` sur `btn-primary`)
- Il utilise un verbe d'action (Supprimer, Enregistrer, CrÃ©er, etc.)
- Il a un emoji d'action (ğŸ—‘, â†©, ğŸ”’, â¬†, etc.)

### 29.2 RÃ¨gle des boutons (rect + text)

**TOUJOURS wrapper le `<text>` avec `<a href>` :**

```xml
<!-- âŒ INTERDIT -->
<rect class="btn-primary"/>
<text>Enregistrer</text>

<!-- âœ… CORRECT -->
<rect class="btn-primary"/>
<a href="..."><text>Enregistrer</text></a>
```

### 29.3 Mapping des destinations par type de bouton

| Bouton | Contexte | Destination |
|--------|----------|-------------|
| **Ã— (close)** | Modal header | Page parent |
| **Ã— (delete)** | Ligne tableau | modal-delete.html |
| **Annuler** | Modal footer | Page parent |
| **Enregistrer** | Modal footer | Page parent (action = retour) |
| **Supprimer** | Modal footer danger | Page liste (index.html) |
| **CrÃ©er** | Modal footer | Page crÃ©Ã©e ou index |
| **Mettre Ã  jour** | Bouton action | tasks.html |
| **Restaurer** | Tableau backups | modal-backup-restore.html |
| **ğŸ”’ SSL** | Tableau domains | modal-ssl.html |

### 29.4 DÃ©termination de la page parent

Pour les modals, la page parent est dÃ©duite du nom de fichier :

```python
def get_parent_page(modal_filename):
    """
    modal-create.html â†’ index.html ou general.html
    modal-delete.html â†’ general.html
    modal-ssl.html â†’ domains.html
    modal-domain-add.html â†’ domains.html
    modal-backup-restore.html â†’ backups.html
    modal-cdn.html â†’ performance.html
    """
    mappings = {
        "modal-create": "index",
        "modal-delete": "general",
        "modal-ssl": "domains",
        "modal-domain-add": "domains",
        "modal-backup-restore": "backups",
        "modal-cdn": "performance",
        "modal-import": "onboarding",
        "modal-password": "general",
    }
    base = modal_filename.replace(".html", "")
    return mappings.get(base, "general") + ".html"
```

### 29.5 Actions de confirmation (modal danger)

Pour les modals de suppression/danger, le bouton d'action mÃ¨ne Ã  la liste :

```
modal-delete.html â†’ "Supprimer" â†’ index.html (la ressource n'existe plus)
```

### 29.6 Actions de sauvegarde

Pour les modals de configuration, le bouton d'action mÃ¨ne Ã  la page parent :

```
modal-ssl.html â†’ "Enregistrer" â†’ domains.html (retour avec modification)
modal-cdn.html â†’ "Enregistrer" â†’ performance.html
```

### 29.7 Checklist de validation

AprÃ¨s chaque gÃ©nÃ©ration, vÃ©rifier :

```bash
# 1. Trouver les <text> dans des boutons sans <a href>
grep -E '<rect[^>]*(btn-primary|btn-outline|btn-danger)' page.html -A1 | grep '<text' | grep -v '<a href'

# 2. Trouver les Ã— sans lien
grep -E '<text[^>]*>Ã—</text>' page.html | grep -v '<a href'

# 3. Trouver les boutons d'action sans lien
grep -E '<text[^>]*>(Enregistrer|Supprimer|CrÃ©er|Annuler)</text>' page.html | grep -v '<a href'
```

### 29.8 Script de correction automatique

Pour chaque page HTML, le script `fix` doit :

1. **Identifier les boutons sans lien :**
   - `<rect class="btn-*">` suivi de `<text>` sans `<a>`

2. **Appliquer le mapping :**
   - Ã— dans modal header â†’ page parent
   - Ã— dans tableau â†’ modal-delete.html
   - Enregistrer â†’ page parent
   - Supprimer â†’ index.html
   - Annuler â†’ page parent

3. **Wrapper avec `<a href>` :**
   ```python
   text_element = '<text ...>Label</text>'
   wrapped = f'<a href="{destination}" style="cursor:pointer">{text_element}</a>'
   ```

### 29.9 Actions API â†’ tasks.html

Certaines actions sont des appels API sans page cible dÃ©diÃ©e.

**RÃˆGLE:** Ces actions naviguent vers `tasks.html` pour montrer la tÃ¢che en cours.

| Action | Destination |
|--------|-------------|
| `Vider le cache` | `tasks.html` |
| `ğŸ“‹ Copier config` | `tasks.html` |
| `GÃ©nÃ©rer` | `tasks.html` |
| `VÃ©rifier maintenant` | `tasks.html` |
| `Tout mettre Ã  jour` | `tasks.html` |
| `CrÃ©er le site` | `tasks.html` |
| `Restaurer` | `tasks.html` |
| `RÃ©initialiser` | `tasks.html` |

**Exemple:**
```xml
<a href="/static/web-cloud/wordpress/tasks.html" style="cursor:pointer">
  <text>ğŸ—‘ Vider le cache</text>
</a>
```

### 29.10 SynthÃ¨se des rÃ¨gles

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RÃˆGLE: TOUT BOUTON â†’ <a href>                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Ã— modal header â†’ page parent                                â”‚
â”‚  2. Ã— table row â†’ modal-delete.html                             â”‚
â”‚  3. Annuler â†’ page parent                                       â”‚
â”‚  4. Enregistrer â†’ page parent                                   â”‚
â”‚  5. Supprimer (danger) â†’ index.html                             â”‚
â”‚  6. Actions JS â†’ tasks.html (montre tÃ¢che en cours)             â”‚
â”‚  7. Liens externes â†’ /static/lien_externe.html                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 29.11 INTERDICTION DE `href="#"` (CRITIQUE)

**RÃˆGLE ABSOLUE:** Le lien `href="#"` est INTERDIT car il ne navigue nulle part.

**DÃ©tection dans l'action `check` :**
```bash
# Trouver tous les href="#" dans une section
grep -r 'href="#"' /home/ubuntu/aiapp/static/web-cloud/<section>/ --include="*.html"
```

**Remplacement obligatoire :**

| Type d'Ã©lÃ©ment | Pattern | Destination correcte |
|----------------|---------|----------------------|
| **IcÃ´ne ğŸŒ** | IcÃ´ne site dans sidebar | `/static/lien_externe.html` |
| **Liens domaine** | `mon-blog.fr`, URLs affichÃ©es | `/static/lien_externe.html` |
| **Boutons externes** | Admin WP, Visiter, Guides | `/static/lien_externe.html` |
| **Actions API** | Vider cache, MAJ, Tout mettre Ã  jour, RafraÃ®chir | `tasks.html` |
| **Boutons modale** | CrÃ©er, Restaurer, Lancer l'import, RÃ©initialiser | `tasks.html` |
| **Titres modaux** | Texte titre non cliquable | **Supprimer le `<a>`** |
| **Texte input** | SUPPRIMER (dans input de confirmation) | **Supprimer le `<a>`** |

**Script de correction automatique :**
```python
# Dans fix_href_hash()
replacements = {
    # IcÃ´nes et liens externes
    r'<a href="#"[^>]*>(<text[^>]*>[ğŸŒğŸ“]': '<a href="/static/lien_externe.html" title="Lien externe" style="cursor:pointer">\1',

    # Actions â†’ tasks.html
    r'(<a href=")#("[^>]*><text[^>]*>(Vider|MAJ|Tout mettre|RafraÃ®chir|CrÃ©er le site|Restaurer|Lancer|RÃ©initialiser|Supprimer|GÃ©nÃ©rer))': r'\1/static/web-cloud/wordpress/tasks.html\2',

    # Titres modaux â†’ supprimer le lien
    r'<a href="#"[^>]*>(<text[^>]*font-weight="600"[^>]*>[^<]+</text>)</a>': r'\1',
}
```

**Checklist `check` mise Ã  jour :**
```
1. âŒ Liens 404 (pages inexistantes)
2. âŒ href="#" (liens morts) â† NOUVEAU
3. âš ï¸ Ã‰lÃ©ments non cliquables
```

**Exemple d'output `check` :**
```
=== CHECK wordpress ===

âŒ Liens morts href="#" (15):
   backups.html:81  - <a href="#"><text>ğŸŒ</text></a> â†’ lien_externe.html
   backups.html:166 - <a href="#"><text>Ã— Supprimer</text></a> â†’ tasks.html
   domains.html:85  - <a href="#"><text>ğŸŒ</text></a> â†’ lien_externe.html
   ...

Commande de correction:
  fix wordpress --href
```
