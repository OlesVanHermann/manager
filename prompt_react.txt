# CONSIGNES REACT - NEW MANAGER OVHcloud

## 1. Contexte du projet

Interface **New Manager** pour la gestion des services OVHcloud : Cloud, Hebergement Web, Email, DNS, Domaines, VPS, Serveurs dedies.

Ce projet est une **reecriture progressive** du "old manager" existant (monorepo Angular + React OVHcloud).

### 1.1 Objectif de migration

Le **Old Manager** est accessible en production sur : `https://manager.eu.ovhcloud.com`

**Strategie de migration :**
- NE PAS faire de redirections vers `manager.eu.ovhcloud.com`
- REECRIRE les fonctionnalites en identifiant les appels API dans le code source du old manager
- UTILISER les APIs OVH directement dans le New Manager

**Methodologie "la methode" :**
1. **Localiser** la fonctionnalite dans le old manager (`/home/ubuntu/manager/`)
2. **Identifier** les appels API (endpoints `/me/*`, `/services/*`, etc.)
3. **Extraire** la logique metier et les types TypeScript
4. **Generer** le composant React equivalent pour le new manager

---

## 2. Regles de travail

1. **Lire et analyser** le code fourni. Ne pas partager l'analyse sauf demande explicite.
2. **Ne rien faire** sans autorisation.
3. **Attendre les consignes** avant toute action.
4. **Generer le code** dans le chat en utilisant **un seul bloc de code** avec copier-coller.
5. **Encapsuler** les commandes `cp` et `tee` dans un bloc markdown.
6. **Migration** : utiliser "la methode" -> `grep` dans old manager -> localiser les appels API -> extraire types -> generer composant React (pas de redirection vers manager.eu.ovhcloud.com)
7. **Conserver** le design system existant, ne pas reinventer les composants UI.
8. **Erreur 401 API** : rediriger vers l'auth OVH, pas d'erreur affichee.

---

## 3. Structure des repertoires

| Element | Chemin |
|---------|--------|
| **New Manager (Frontend React)** | `/home/ubuntu/aiapp/frontend/src/` |
| **Old Manager (Reference)** | `/home/ubuntu/manager/` |

---

## 4. New Manager

### 4.1 Archive
```bash
cd /home/ubuntu/
tar -cvf new_manager.tar --exclude='*2025*' aiapp/frontend/src/
```

### 4.2 Build

**Developpement :**
```bash
cd /home/ubuntu/aiapp/frontend
npm run build:dev
/home/ubuntu/aiapp/scripts/D1-build_frontend_dev.sh
```

**Production :**
```bash
cd /home/ubuntu/aiapp/frontend
npm run build:prod
/home/ubuntu/aiapp/scripts/D2-promote_dev_to_prod.sh
# ou
/home/ubuntu/aiapp/scripts/D2-promote_dev_to_prod.sh --from-dist
```

### 4.3 Arborescence du framework (Organisation par Univers)
```
/home/ubuntu/aiapp/frontend/src/
├── App.tsx                    # App principale + routing (NAV1 + NAV2)
├── main.tsx                   # Bootstrap React
├── index.css                  # Styles globaux + layout
│
├── components/                # Composants reutilisables
│   ├── Sidebar/               # Sidebar gauche (header, search, liste, pagination)
│   │   ├── Sidebar.tsx        # Composant principal
│   │   ├── navigationTree.ts  # Definition des univers et sections
│   │   ├── styles.css         # Styles sidebar
│   │   └── index.ts           # Exports
│   ├── AccountSidebar/        # Sidebar droite (menu utilisateur)
│   │   ├── AccountSidebar.tsx # Composant principal
│   │   ├── UserInfos.tsx      # Infos profil
│   │   ├── UsefulLinks.tsx    # Liens utiles
│   │   ├── Shortcuts.tsx      # Raccourcis
│   │   ├── styles.css         # Styles
│   │   └── index.ts           # Exports
│   ├── Skeleton.tsx           # Composants skeleton loading
│   └── ServiceIcons.tsx       # Icones des services
│
├── pages/                     # Pages organisees par UNIVERS (NAV1)
│   ├── Login.tsx              # Page connexion OAuth OVH
│   │
│   ├── home/                  # A) Univers HOME
│   │   ├── index.tsx          # Dashboard accueil
│   │   ├── styles.css
│   │   ├── account/           # A.2 Compte (8 tabs)
│   │   │   ├── index.tsx      # AccountPage (router tabs)
│   │   │   ├── SecurityTab.tsx
│   │   │   ├── EditTab.tsx
│   │   │   ├── PrivacyTab.tsx
│   │   │   ├── AdvancedTab.tsx
│   │   │   ├── ContactServicesTab.tsx
│   │   │   ├── styles.css
│   │   │   └── components/
│   │   │       ├── ProfileTile.tsx
│   │   │       ├── LastBillTile.tsx
│   │   │       └── ShortcutsTile.tsx
│   │   ├── billing/           # A.3 Facturation (11 tabs)
│   │   │   ├── index.tsx      # BillingPage (router tabs)
│   │   │   ├── ServicesTab.tsx
│   │   │   ├── PaymentsTab.tsx
│   │   │   ├── OrdersTab.tsx
│   │   │   └── styles.css
│   │   ├── support/           # A.4 Support (5 tabs)
│   │   │   ├── index.tsx      # SupportPage (router tabs)
│   │   │   ├── LevelTab.tsx
│   │   │   ├── CommunicationsTab.tsx
│   │   │   └── styles.css
│   │   ├── carbon/            # A.5 Carbone
│   │   │   ├── index.tsx
│   │   │   └── styles.css
│   │   └── api/               # A.6 Playground API
│   │       ├── index.tsx
│   │       └── styles.css
│   │
│   ├── iam/                   # G) Univers IAM (4 tabs)
│   │   ├── index.tsx          # IamPage (router tabs)
│   │   └── styles.css
│   │
│   ├── public-cloud/          # B) Univers PUBLIC CLOUD (placeholder)
│   ├── private-cloud/         # C) Univers PRIVATE CLOUD (placeholder)
│   ├── bare-metal/            # D) Univers BARE METAL (placeholder)
│   ├── web-cloud/             # E) Univers WEB CLOUD (placeholder)
│   ├── network/               # F) Univers NETWORK (placeholder)
│   │
│   └── _placeholder/          # Template pages non implementees
│       ├── index.tsx
│       └── styles.css
│
├── contexts/                  # React Contexts
│   └── AuthContext.tsx
│
├── services/                  # Services API
│   ├── api.ts                 # Client API base + getCredentials
│   ├── auth.service.ts
│   ├── account.service.ts
│   ├── billing.service.ts
│   ├── services.service.ts
│   ├── orders.service.ts
│   ├── contacts.service.ts
│   ├── support.service.ts
│   ├── communication.service.ts  # APIs v2 /notification/*
│   ├── notifications.service.ts
│   ├── agreements.service.ts
│   ├── procedures.service.ts     # KYC /me/procedure/*
│   ├── iam.service.ts
│   └── security.service.ts
│
├── types/                     # TypeScript types
│   ├── auth.types.ts
│   └── services.types.ts
│
├── lib/                       # Utilitaires
│   ├── useTabs.ts             # Hook gestion onglets
│   ├── constants.ts
│   ├── types.ts
│   └── ResetSlot.tsx
│
└── design-system/             # Design System
    ├── index.ts               # Constantes TypeScript
    ├── globals.css
    ├── tokens.css             # Variables CSS (couleurs, typo, spacing)
    ├── tokens/index.ts
    ├── PATTERNS.md            # Couleurs, typo, spacing
    ├── COMPONENTS.md          # Catalogue composants
    ├── DESIGN_TOKENS.md       # Patterns d'usage
    └── ICONS.md               # Icones disponibles
```

### 4.4 Convention de nommage des fichiers

| Element | Convention | Exemple |
|---------|------------|---------|
| Repertoire univers (NAV1) | `kebab-case` | `public-cloud/`, `bare-metal/` |
| Repertoire section (NAV2) | `kebab-case` | `account/`, `billing/` |
| Page principale section | `index.tsx` | `pages/home/account/index.tsx` |
| Tab (NAV3) | `PascalCaseTab.tsx` | `SecurityTab.tsx`, `OrdersTab.tsx` |
| Composant local | `PascalCase.tsx` | `ProfileTile.tsx` |
| Styles section | `styles.css` | `pages/home/account/styles.css` |

### 4.5 Imports dans App.tsx
```typescript
// Univers HOME (A)
import HomePage from "./pages/home";
import AccountPage from "./pages/home/account";
import BillingPage from "./pages/home/billing";
import SupportPage from "./pages/home/support";
import CarbonPage from "./pages/home/carbon";
import ApiPage from "./pages/home/api";

// Univers IAM (G)
import IamPage from "./pages/iam";

// Placeholder pour univers non implementes
import { PlaceholderPage } from "./pages/_placeholder";
```

### 4.6 Chemins d'imports relatifs

| Depuis | Vers services/ | Vers types/ |
|--------|---------------|-------------|
| `pages/home/index.tsx` | `../../services/` | `../../types/` |
| `pages/home/account/index.tsx` | `../../../services/` | `../../../types/` |
| `pages/home/account/SecurityTab.tsx` | `../../../services/` | `../../../types/` |
| `pages/home/account/components/ProfileTile.tsx` | `../../../../services/` | `../../../../types/` |
| `pages/iam/index.tsx` | `../../services/` | `../../types/` |

---

## 5. Design System (OVH Classic Blue)

### 5.1 Couleurs primaires (tokens.css)

| Token | Valeur | Usage |
|-------|--------|-------|
| `--color-primary-500` | `#0050D7` | Bleu OVH principal |
| `--color-primary-600` | `#003DA8` | Hover/Active |
| `--color-primary-700` | `#002B7A` | Pressed |
| `--color-primary-800` | `#122844` | Dark |
| `--color-primary-300` | `#85A5FF` | Light |
| `--color-primary-100` | `#D6E4FF` | Background |

### 5.2 Regle d'utilisation

Utiliser **uniquement** les variables CSS **sans fallback** :
```css
/* BON */
color: var(--color-primary-500);

/* MAUVAIS */
color: var(--color-primary-500, #0050D7);
```

### 5.3 Stack technique

| Composant | Source |
|-----------|--------|
| Design System | `@ovh-ux/muk` (Manager UI Kit) |
| Base ODS | `@ovhcloud/ods-react` v19.2.1 |
| Themes | `@ovhcloud/ods-themes` v19.2.1 |
| CSS | Variables CSS custom (tokens.css) |

### 5.4 Classes CSS disponibles
```css
/* Boutons */
.btn  .btn-primary  .btn-secondary  .btn-outline

/* Cartes/Tiles */
.tile  .tile-header  .tile-content

/* Onglets */
.tab-btn  .tabs-list

/* Badges */
.status-badge  .badge-success  .badge-warning  .badge-error

/* Formulaires */
.toggle-switch  .toggle-slider

/* Securite */
.security-card  .two-factor-method

/* Tableaux */
.bills-table  .method-table
```

### 5.5 CHARGEMENT PROGRESSIF (Streaming UI)

### Cas d'usage
Quand l'API OVH retourne une liste d'IDs puis nécessite N appels pour les détails (ex: /me/deposit, /me/bill).

### Structure du state
```typescript
interface RowData {
  id: string;
  loaded: boolean;
  details?: ApiDetails;
}

const [ids, setIds] = useState<string[]>([]);
const [rows, setRows] = useState<Map<string, RowData>>(new Map());
const [loadedCount, setLoadedCount] = useState(0);
const abortRef = useRef(false);
```

### Flux de chargement
```
1. GET /me/deposit → liste d'IDs (rapide)
2. Afficher tableau avec IDs + skeletons
3. Charger détails par batches de 10 (Promise.all)
4. Mettre à jour chaque ligne dès réception
5. Afficher compteur: {loadedCount}/{total}
```

### Composant Skeleton
```tsx
const Skeleton = () => <span className="skeleton-text"></span>;
```

### Gestion du changement de filtres
```typescript
// Abort previous loading when filters change
abortRef.current = true;
await new Promise(r => setTimeout(r, 50));
abortRef.current = false;
setLoadedCount(0); // IMPORTANT: reset counter
setRows(new Map());
```

### Export CSV
```typescript
const exportCSV = () => {
  const data = Array.from(rows.values())
    .filter(r => r.loaded && r.details)
    .map(r => r.details!);
  
  const csv = [headers.join(";"), ...data.map(row => [...].join(";"))].join("\n");
  const blob = new Blob(["\ufeff" + csv], { type: "text/csv;charset=utf-8" });
  // Télécharger via URL.createObjectURL
};
```

### Export PDF (via print)
```typescript
const exportPDF = () => {
  const html = `<!DOCTYPE html>...`;
  const w = window.open("", "_blank");
  w.document.write(html);
  w.onload = () => w.print();
};
```

---

## API PAIEMENTS (Deposits)

### Endpoints
```
GET /me/deposit                    → string[] (liste IDs)
GET /me/deposit?date.from=&date.to= → string[] (filtré par période)
GET /me/deposit/{depositId}        → Deposit (détails)
```

### Interface Deposit
```typescript
interface Deposit {
  depositId: string;
  date: string;
  amount: { currencyCode: string; text: string; value: number };
  orderId: number;
  paymentInfo?: { 
    paymentType: string;      // creditCard, withdrawal, bankAccount, paypal...
    publicLabel?: string;     // "XXXX XXXX XXXX 5575" ou "FR76 3002 7XXX...0 120"
    description?: string | null;
  };
  url: string;
  pdfUrl: string;
}
```

### Labels de paiement (FR)
```typescript
const PAYMENT_LABELS: Record = {
  creditCard: "Carte",
  withdrawal: "Prélèvement",
  bankAccount: "Virement",
  paypal: "PayPal",
  fidelityAccount: "Points fidélité",
  ovhAccount: "Compte OVH",
  voucher: "Bon d'achat",
};
```

### Formatage publicLabel
```typescript
// Masquer et raccourcir: "XXXX XXXX XXXX 5575" → "•••• 5575"
const short = publicLabel.replace(/X/g, "•").slice(-8);
return `${PAYMENT_LABELS[paymentType]} ${short}`;
```

---

## 6. Architecture technique

### 6.1 Proxy Nginx

Le frontend communique avec l'API OVH via un proxy Nginx :
```
/api/ovh/*  ->  https://eu.api.ovh.com/1.0/*
```

La signature des requetes est geree automatiquement cote serveur.

### 6.2 Layout principal (App.tsx)
```
+-------------------------------------------------------------------------------------------+
| +-----------------+ +-------------------------------------------------------+ +-------+ |
| | [H] [L] [G]     | | HOME | PUBLIC CLOUD | PRIVATE CLOUD | BARE METAL |    | | OK    | |
| +-----------------+ |      | WEB CLOUD | NETWORK | IAM                      | | nic   | |
| | [Search       ] | +-------------------------------------------------------+ +-------+ |
| +-----------------+ | [Accueil] [Compte] [Facturation] [Support] [...]       | <- NAV2  |
| | Liste:          | +-------------------------------------------------------+          |
| | - TOUS          | |                                                       |          |
| | - ressource 1   | |    PAGE AVEC SES PROPRES ONGLETS NAV3 INTERNES        |          |
| | - ressource 2   | |    (AccountPage, BillingPage, etc.)                   |          |
| | - ressource 3   | |                                                       |          |
| | - ...           | |    +-----------------------------------------------+  |          |
| |                 | |    | [Tab1] [Tab2] [Tab3] ...    <- NAV3 dans page |  |          |
| |                 | |    +-----------------------------------------------+  |          |
| |                 | |    |                                               |  |          |
| |                 | |    |            CONTENU DE LA PAGE                 |  |          |
| |                 | |    |                                               |  |          |
| +-----------------+ |    +-----------------------------------------------+  |          |
| |  [<]  10  [>]   | |                                                       |          |
| +-----------------+ +-------------------------------------------------------+          |
+-------------------------------------------------------------------------------------------+
```

**Composants du layout :**

| Zone | Composant | Description |
|------|-----------|-------------|
| Sidebar Header | `SidebarHeader` | Icone home + boutons vue (liste/grille) |
| Sidebar Search | `SearchInput` | Recherche (EN HAUT, apres header) |
| Sidebar Liste | `ResourceList` | Liste : TOUS (premier) + ressources |
| Sidebar Pagination | `Pagination` | Navigation < page > |
| Niveau 1 (NAV1) | `UniversTabs` | Onglets univers OVH (HOME, PUBLIC CLOUD, etc.) |
| Niveau 2 (NAV2) | `SectionTabs` | Sections de l'univers selectionne |
| Niveau 3 (NAV3) | `PageTabs` | **DANS chaque page** (pas dans le header global) |
| Contenu | `ContentArea` | Zone de contenu dynamique |
| User Menu | `UserMenu` | Avatar + NIC handle, ouvre AccountSidebar |
| AccountSidebar | `AccountSidebar` | Sidebar droite avec profil et actions |

### 6.3 Navigation Niveau 1 (Univers) - NAV1

| ID | Onglet | Repertoire | Description |
|----|--------|------------|-------------|
| A | **HOME** | `pages/home/` | Fonctionnalites transverses (compte, facturation, support) |
| B | **PUBLIC CLOUD** | `pages/public-cloud/` | Instances, Storage, Network, AI/ML, Databases |
| C | **PRIVATE CLOUD** | `pages/private-cloud/` | VMware, Nutanix, SAP HANA |
| D | **BARE METAL** | `pages/bare-metal/` | Serveurs dedies, VPS, Managed Bare Metal |
| E | **WEB CLOUD** | `pages/web-cloud/` | Domaines, Hebergement, Emails, DNS |
| F | **NETWORK** | `pages/network/` | IP, vRack, Load Balancer, CDN |
| G | **IAM** | `pages/iam/` | Identity & Access Management |

### 6.4 Sidebar gauche (Liste des ressources)

| Element | Position | Fonction |
|---------|----------|----------|
| **Header** | Haut | Icone home + boutons vue (liste/grille) |
| **Search** | Apres header | Filtre de recherche |
| **Liste** | Centre | TOUS (premier) + ressources de l'univers |
| **Pagination** | Bas | Navigation < page > |

**Comportement :**
- La liste se met a jour selon l'univers selectionne (NAV1)
- **TOUS** est toujours le premier element
- Cliquer sur une ressource affiche ses details dans le contenu
- La recherche filtre en temps reel
- Pagination avec numero de page courant

---

## 7. Univers HOME - Structure complete (A)

L'univers **HOME** regroupe toutes les fonctionnalites transverses.

### 7.1 Sections HOME (NAV2)

| # | Section (NAV2) | Repertoire | Route interne |
|---|----------------|------------|---------------|
| 1 | **Accueil** | `home/index.tsx` | `home-dashboard` |
| 2 | **Compte** | `home/account/` | `home-account` |
| 3 | **Facturation** | `home/billing/` | `home-billing` |
| 4 | **Support** | `home/support/` | `home-support` |
| 5 | **Carbone** | `home/carbon/` | `home-carbon` |
| 6 | **Playground API** | `home/api/` | `home-api` |

### 7.2 Compte - Tabs (NAV3)

| # | Tab ID | Label | Fichier | API principale |
|---|--------|-------|---------|----------------|
| a | `info` | Informations generales | `index.tsx` (default) | `GET /me` |
| b | `edit` | Editer mon compte | `EditTab.tsx` | `PUT /me` |
| c | `security` | Securite | `SecurityTab.tsx` | `GET /me/accessRestriction/*` |
| d | `gdpr` | Donnees personnelles | `PrivacyTab.tsx` | `GET /me/privacy/*` |
| e | `advanced` | Parametres avances | `AdvancedTab.tsx` | `GET /me/preferences` |
| f | `contacts-services` | Mes services (contacts) | `ContactServicesTab.tsx` | `GET /me/contact` |
| g | `contacts-requests` | Mes demandes (contacts) | *(dans index)* | `GET /me/task/contactChange` |
| h | `kyc` | Documents KYC | *(dans index)* | `GET /me/procedure/fraud` |

### 7.3 Facturation - Tabs (NAV3)

| # | Tab ID | Label | Fichier | API principale |
|---|--------|-------|---------|----------------|
| a | `services` | Mes services | `ServicesTab.tsx` | `GET /services` |
| b | `invoices` | Factures | `index.tsx` (dans BillingPage) | `GET /me/bill` |
| c | `refunds` | Avoirs | `index.tsx` | `GET /me/refund` |
| d | `payments` | Paiement | `PaymentsTab.tsx` | `GET /me/deposit` |
| e | `orders` | Commandes | `OrdersTab.tsx` | `GET /me/order` |
| f | `references` | Mes references internes | `index.tsx` | `GET /me/billing/purchaseOrder` |
| g | `methods` | Moyens de paiement | `index.tsx` | `GET /me/payment/method` |
| h | `prepaid` | Compte prepaye | `index.tsx` | `GET /me/ovhAccount` |
| i | `vouchers` | Bon d'achat | `index.tsx` | `GET /me/voucherAccount` |
| j | `fidelity` | Points de fidelite | `index.tsx` | `GET /me/fidelityAccount` |
| k | `contracts` | Contrats | `index.tsx` | `GET /me/agreements` |

### 7.4 Support - Tabs (NAV3)

| # | Tab ID | Label | Fichier | API principale |
|---|--------|-------|---------|----------------|
| a | `tickets` | Mes tickets | `index.tsx` (default) | `GET /support/tickets` |
| b | `create` | Creer un nouveau ticket | `index.tsx` | `POST /support/tickets` |
| c | `level` | Mon niveau de support | `LevelTab.tsx` | `GET /me/supportLevel` |
| d | `communications` | Mes communications | `CommunicationsTab.tsx` | `GET /me/notification` |
| e | `broadcast` | Parametres de diffusion | `index.tsx` | `GET /me/notification/preferences` |

### 7.5 Playground API

| # | Tab ID | Label | Fichier | Description |
|---|--------|-------|---------|-------------|
| a | `api` | API | `index.tsx` (default) | Console interactive |
| b | `advanced` | Parametres avances | *(dans index)* | Credentials, tokens |

---

## 8. Univers IAM - Structure complete (G)

L'univers **IAM** est un univers autonome dedie a la gestion des acces.

### 8.1 Sections IAM (NAV2 = Tabs)

Dans IAM, les sections NAV2 sont directement les tabs (pas de sous-navigation).

| # | Section ID | Label | Fichier | API principale |
|---|------------|-------|---------|----------------|
| a | `iam-identities` | Identites | `index.tsx` | `GET /me/identity/user` |
| b | `iam-policies` | Politiques | `index.tsx` | `GET /iam/policy` |
| c | `iam-groups` | Groupes | `index.tsx` | `GET /me/identity/group` |
| d | `iam-logs` | Logs | `index.tsx` | `GET /me/logs` |

---

## 9. Univers Produits (B-F) - Placeholders

Ces univers utilisent `_placeholder/index.tsx` en attendant l'implementation.

### 9.1 PUBLIC CLOUD (B) - `pages/public-cloud/`

| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| Instances | Liste, Creer |
| Storage | Block, Object, Archive |
| Network | Private Network, Load Balancer |
| Databases | Managed DB |
| AI & ML | Services IA |

### 9.2 PRIVATE CLOUD (C) - `pages/private-cloud/`

| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| VMware | vSphere, NSX |
| Nutanix | Clusters |
| SAP HANA | Instances SAP |

### 9.3 BARE METAL (D) - `pages/bare-metal/`

| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| Serveurs dedies | Mes serveurs, Commander |
| VPS | Mes VPS, Commander |
| Managed Bare Metal | Services manages |

### 9.4 WEB CLOUD (E) - `pages/web-cloud/`

| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| Domaines | Mes domaines, Zones DNS |
| Hebergements | Mes hebergements, Bases de donnees |
| Emails | Email domain, Email Pro, Exchange |

### 9.5 NETWORK (F) - `pages/network/`

| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| IP | Gestion IP |
| vRack | Private network |
| Load Balancer | LB |
| CDN | Content Delivery |

---

## 10. APIs OVH

### 10.1 Authentification

| Methode | Endpoint | Description |
|---------|----------|-------------|
| POST | `/auth/credential` | Demande de consumer key |
| GET | `/me` | Informations utilisateur |

### 10.2 Compte

| Methode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/me` | Informations generales |
| PUT | `/me` | Editer mon compte |
| GET | `/me/contact` | Mes services (contacts) |
| GET | `/me/task/contactChange` | Mes demandes (contact change) |
| GET | `/me/preferences` | Parametres avances |

### 10.3 Securite (2FA)

| Methode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/me/accessRestriction/sms` | Liste SMS 2FA |
| GET | `/me/accessRestriction/totp` | Liste TOTP (app mobile) |
| GET | `/me/accessRestriction/u2f` | Liste cles U2F |
| GET | `/me/accessRestriction/backupCode` | Codes de secours |

### 10.4 Donnees personnelles (RGPD)

| Methode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/me/privacy/requests` | Demandes RGPD |
| POST | `/me/privacy/requests/erasure` | Demande suppression |
| POST | `/me/privacy/requests/export` | Demande export |

### 10.5 Facturation

| Methode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/services` | Mes services |
| GET | `/me/bill` | Factures |
| GET | `/me/bill/{billId}` | Details facture |
| GET | `/me/refund` | Avoirs |
| GET | `/me/deposit` | Paiements |
| GET | `/me/deposit/{depositId}` | Details paiement |
| GET | `/me/order` | Commandes |
| GET | `/me/payment/method` | Moyens de paiement |
| GET | `/me/debtAccount` | Encours/dette |
| GET | `/me/ovhAccount` | Compte prepaye |
| GET | `/me/voucherAccount` | Bons d'achat |
| GET | `/me/fidelityAccount` | Points fidelite |
| GET | `/me/agreements` | Contrats |

### 10.6 Support

| Methode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/support/tickets` | Mes tickets |
| POST | `/support/tickets` | Creer ticket |
| GET | `/support/tickets/{ticketId}` | Details ticket |
| GET | `/me/supportLevel` | Niveau de support |
| GET | `/me/notification` | Mes communications |
| GET/PUT | `/me/notification/preferences` | Parametres de diffusion |

### 10.7 IAM

| Methode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/me/identity/user` | Liste identites |
| GET | `/iam/policy` | Liste politiques |
| GET | `/me/identity/group` | Liste groupes |
| GET | `/me/logs` | Logs audit |

---

## 11. Old Manager (Reference)

**Production** : `https://manager.eu.ovhcloud.com`
**Code source** : `/home/ubuntu/manager/`

### 11.1 Structure principale
```
/home/ubuntu/manager/packages/manager/
├── core/          # Utilitaires fondamentaux
├── modules/       # Modules metier reutilisables
└── apps/          # Applications completes
```

### 11.2 Core (`packages/manager/core/`)
```
api, application, ovh-product-icons, request-tagger,
shell-client, sso, url-builder, utils
```

### 11.3 Modules (`packages/manager/modules/`)
```
account, billing, billing-components, iam, support, order,
exchange, emailpro, email-domain, nasha, netapp, pci,
vps, vrack, carbon-calculator, mfa-enrollment, ...
```

### 11.4 Apps (`packages/manager/apps/`)
```
account, billing, dedicated, dedicated-servers, hub,
iam, pci, public-cloud, vps, vrack, web, web-hosting,
support, sms, telecom, exchange, email-pro, ...
```

### 11.5 Methodologie : Trouver les appels API

**IMPORTANT : Ne jamais rediriger vers manager.eu.ovhcloud.com**

Pour chaque fonctionnalite a migrer, identifier les appels API dans le old manager :
```bash
# 1. Chercher les endpoints API dans un module
cd /home/ubuntu/manager
grep -r "api.get\|api.post\|api.put\|api.delete" packages/manager/modules/billing/

# 2. Chercher les appels /me/* (compte utilisateur)
grep -rn "/me/" packages/manager/apps/account/

# 3. Chercher les services API d'un module
find packages/manager/modules/billing -name "*.service.ts" -o -name "*api*.ts"

# 4. Chercher une fonctionnalite specifique
grep -rn "refund\|avoir" packages/manager/modules/billing/

# 5. Voir les types/interfaces d'un endpoint
grep -rn "interface.*Bill\|type.*Bill" packages/manager/modules/billing/
```

---

## 12. Conventions de code

| Regle | Application |
|-------|-------------|
| **TypeScript** | Mode strict |
| **Composants** | Fonctionnels avec hooks |
| **Nommage composants** | PascalCase |
| **Nommage fonctions/variables** | camelCase |
| **Nommage repertoires** | kebab-case |
| **Structure fichiers** | Un composant = un fichier |
| **Exports** | Default pour pages, nommes pour composants |
| **Appels API** | Dans `services/`, jamais dans les composants |
| **NAV3 (onglets internes)** | Geres par chaque page, pas dans App.tsx |

### Securite

**JAMAIS de secrets dans le code frontend :**
- Pas de cles API, tokens, mots de passe ou credentials en dur
- Pas de secrets dans les variables d'environnement exposees au client (`VITE_*`)
- L'authentification passe par le flow OAuth OVH (cookies httpOnly cote serveur)
- Les appels API utilisent les credentials de session, pas de tokens hardcodes

---

## 13. Reference rapide

### 13.1 Recherche dans le Old Manager
```bash
# Chercher une fonctionnalite
cd /home/ubuntu/manager && grep -rn "pattern" packages/

# Chercher les appels API d'un module
grep -r "api.get\|api.post" packages/manager/modules/MODULE_NAME/

# Chercher les endpoints /me/*
grep -rn '"/me/' packages/manager/apps/APP_NAME/

# Chercher les services d'un module
find packages/manager/modules/MODULE_NAME -name "*.service.ts"

# Chercher les types/interfaces
grep -rn "interface\|type" packages/manager/modules/MODULE_NAME/src/types/
```

### 13.2 Build New Manager
```bash
# Creer archive new manager
cd /home/ubuntu && tar -cvf new_manager.tar --exclude='*2025*' aiapp/frontend/src/

# Build dev (compile + deploie en dev)
cd /home/ubuntu/aiapp/frontend && npm run build:dev
/home/ubuntu/aiapp/scripts/D1-build_frontend_dev.sh

# Build prod (compile + promeut en prod)
cd /home/ubuntu/aiapp/frontend && npm run build:prod
/home/ubuntu/aiapp/scripts/D2-promote_dev_to_prod.sh
# ou directement depuis dist :
/home/ubuntu/aiapp/scripts/D2-promote_dev_to_prod.sh --from-dist
```

### 13.3 Creer un nouveau Tab
```bash
# Exemple : creer ContactRequestsTab dans Account
touch /home/ubuntu/aiapp/frontend/src/pages/home/account/ContactRequestsTab.tsx
```

Structure type :
```typescript
import { useState, useEffect } from "react";
import type { OvhCredentials } from "../../../types/auth.types";
import * as contactsService from "../../../services/contacts.service";

const STORAGE_KEY = "ovh_credentials";

function getCredentials(): OvhCredentials | null {
  const stored = sessionStorage.getItem(STORAGE_KEY);
  if (!stored) return null;
  try { return JSON.parse(stored); } catch { return null; }
}

export default function ContactRequestsTab() {
  const [loading, setLoading] = useState(true);
  const [data, setData] = useState<any[]>([]);

  useEffect(() => {
    const creds = getCredentials();
    if (!creds) return;
    // Appel API...
  }, []);

  if (loading) return <div>Chargement...</div>;
  
  return (
    <div className="tab-content">
      {/* Contenu */}
    </div>
  );
}
```

---

## 14. Structure navigationTree.ts

Definition des univers dans `/src/components/Sidebar/navigationTree.ts` :
```typescript
interface Universe {
  id: string;           // "home", "public-cloud", "iam", etc.
  label: string;        // "HOME", "PUBLIC CLOUD", "IAM", etc.
  shortLabel?: string;  // Label court pour affichage compact
  sections: UniverseSection[];
}

interface UniverseSection {
  id: string;           // "home-account", "iam-identities", etc.
  label: string;        // "Compte", "Identites", etc.
  subsections?: NavNode[];  // Sous-sections (onglets NAV3)
}

interface NavNode {
  id: string;
  label: string;
  url?: string;         // URL pour liens externes
  external?: boolean;   // true = ouvre dans nouvel onglet
}
```

**Univers definis :**
```typescript
export const universes: Universe[] = [
  { id: 'home', label: 'HOME', sections: [...] },           // A
  { id: 'public-cloud', label: 'PUBLIC CLOUD', sections: [...] },  // B
  { id: 'private-cloud', label: 'PRIVATE CLOUD', sections: [...] }, // C
  { id: 'bare-metal', label: 'BARE METAL', sections: [...] },      // D
  { id: 'web-cloud', label: 'WEB CLOUD', sections: [...] },        // E
  { id: 'network', label: 'NETWORK', sections: [...] },            // F
  { id: 'iam', label: 'IAM', sections: [...] },                    // G
];
```

---

## 15. Mapping Fichiers - Navigation

### 15.1 Univers HOME (A)

| Fichier | NAV2 | NAV3 (tabs) |
|---------|------|-------------|
| `pages/home/index.tsx` | Accueil | - |
| `pages/home/account/index.tsx` | Compte | info, edit, security, gdpr, advanced, contacts-services, contacts-requests, kyc |
| `pages/home/billing/index.tsx` | Facturation | services, invoices, refunds, payments, orders, references, methods, prepaid, vouchers, fidelity, contracts |
| `pages/home/support/index.tsx` | Support | tickets, create, level, communications, broadcast |
| `pages/home/carbon/index.tsx` | Carbone | - |
| `pages/home/api/index.tsx` | Playground | - |

#### Account tabs (8) - APIs
| Tab | Label | Endpoint |
|-----|-------|----------|
| info | Informations generales | GET /me |
| edit | Editer mon compte | PUT /me |
| security | Securite | /me/accessRestriction/* |
| gdpr | Donnees personnelles | /me/consent |
| advanced | Parametres avances | /me |
| contacts-services | Mes services (contacts) | GET /services |
| contacts-requests | Mes demandes (contacts) | GET /me/task/contactChange |
| kyc | Documents KYC | GET /me/procedure/fraud |

#### Billing tabs (11) - APIs
| Tab | Label | Endpoint |
|-----|-------|----------|
| services | Mes services | GET /services |
| invoices | Factures | GET /me/bill |
| refunds | Avoirs | GET /me/refund |
| payments | Paiement | GET /me/deposit |
| orders | Commandes | GET /me/order |
| references | References internes | GET/POST/PUT /me/billing/purchaseOrder |
| methods | Moyens de paiement | GET /me/payment/method |
| prepaid | Compte prepaye | GET /me/ovhAccount |
| vouchers | Bons d'achat | GET /me/voucherAccount |
| fidelity | Points fidelite | GET /me/fidelityAccount |
| contracts | Contrats | GET /me/agreements |

#### Support tabs (5) - APIs
| Tab | Label | Endpoint |
|-----|-------|----------|
| tickets | Mes tickets | GET /support/tickets |
| create | Creer un ticket | POST /support/tickets |
| level | Niveau de support | GET /me/supportLevel |
| communications | Mes communications | GET /notification/history (v2) |
| broadcast | Parametres diffusion | GET/PUT /me/marketing, GET /notification/routing (v2) |

### 15.2 Univers IAM (G)

| Fichier | Section NAV2 |
|---------|--------------|
| `pages/iam/index.tsx` | Identites / Politiques / Groupes / Logs |

---

## 16. AccountSidebar (Menu utilisateur)

Accessible via l'avatar/NIC en haut a droite :
```
+----------------------------+
|        [Avatar OK]         |
|       Jean Dupont          |  <- Nom
|     [Administrateur]       |  <- Role IAM
|         Acme Corp          |  <- Societe
|                            |
|   jean.dupont@example.com  |  <- Email
|        ab12345-ovh         |  <- NIC handle
|        [Standard]          |  <- Niveau support
+----------------------------+
+----------------------------+
| Voir mes factures        > |  home-billing / invoices
| Verifier mes paiements   > |  home-billing / payments
| Suivre mes commandes     > |  home-billing / orders
| Renouveller mes services > |  home-billing / services
| Mes moyens de paiement   > |  home-billing / methods
| Valider mes contrats     > |  home-billing / contracts
-----------------------------+
| Voir mon profil          > |  home-account / info
| Changer mon mot de passe > |  home-account / security
| 2FA, Restriction IP      > |  home-account / security
| KYC Know Your Customer   > |  home-account / kyc
-----------------------------+
| Creer un ticket support  > |  home-support / create
| Voir mes tickets         > |  home-support / tickets
-----------------------------+
| Playground API           > |  home-api
+----------------------------+
+----------------------------+
| Documentation            > |  https://help.ovhcloud.com/
| Etat des services        > |  https://www.status-ovhcloud.com/
+----------------------------+
+----------------------------+
|       Se deconnecter       |
+----------------------------+
```

**Sections :**
- **Profil** : Avatar, nom, role, societe, email, NIC, niveau support (en bas de la carte)
- **Raccourcis** : 13 liens internes vers Billing, Account, Support, API
- **Liens externes** : Documentation, Etat des services
- **Session** : Logout

**Navigation interne (onNavigate) :**
```typescript
// Format: onNavigate(section, { tab })
onNavigate("home-billing", { tab: "invoices" })  // Factures
onNavigate("home-billing", { tab: "payments" })  // Paiements
onNavigate("home-billing", { tab: "orders" })    // Commandes
onNavigate("home-billing", { tab: "services" })  // Services
onNavigate("home-billing", { tab: "methods" })   // Moyens de paiement
onNavigate("home-billing", { tab: "contracts" }) // Contrats
onNavigate("home-account", { tab: "info" })      // Profil
onNavigate("home-account", { tab: "security" })  // Mot de passe / 2FA
onNavigate("home-account", { tab: "kyc" })       // KYC
onNavigate("home-support", { tab: "create" })    // Creer ticket
onNavigate("home-support", { tab: "tickets" })   // Mes tickets
onNavigate("home-api")                           // Playground API
```
