# CONSIGNES REACT - NEW MANAGER OVHcloud

## 1. Contexte du projet

Interface **New Manager** pour la gestion des services OVHcloud : Cloud, HÃ©bergement Web, Email, DNS, Domaines, VPS, Serveurs dÃ©diÃ©s.

Ce projet est une **rÃ©Ã©criture progressive** du "old manager" existant (monorepo Angular + React OVHcloud).

---

## 2. RÃ¨gles de travail

1. **Lire et analyser** le code fourni. Ne pas partager l'analyse sauf demande explicite.
2. **Ne rien faire** sans autorisation.
3. **Attendre les consignes** avant toute action.
4. **GÃ©nÃ©rer le code** dans le chat en utilisant **un seul bloc de code** avec copier-coller.
5. **Encapsuler** les commandes `cp` et `tee` dans un bloc markdown.
6. **Migration** : utiliser "la mÃ©thode" â†’ `grep` â†’ localiser â†’ extraire â†’ gÃ©nÃ©rer.
7. **Conserver** le design system existant, ne pas rÃ©inventer les composants UI.
8. **Erreur 401 API** : rediriger vers l'auth OVH, pas d'erreur affichÃ©e.

---

## 3. Structure des rÃ©pertoires

| Ã‰lÃ©ment | Chemin |
|---------|--------|
| **New Manager (Frontend React)** | `/home/ubuntu/aiapp/frontend/src/` |
| **Old Manager (RÃ©fÃ©rence)** | `/home/ubuntu/manager/` |

---

## 4. New Manager

### 4.1 Archive
```bash
cd /home/ubuntu/
tar -cvf new_manager.tar --exclude='*2025*' aiapp/frontend/src/
```

### 4.2 Build

**DÃ©veloppement :**
```bash
cd /home/ubuntu/aiapp/frontend
npm run build:dev
/home/ubuntu/aiapp/scripts/D1-build_frontend_dev.sh
```

**Production :**
```bash
cd /home/ubuntu/aiapp/frontend
npm run build:prod
/home/ubuntu/aiapp/scripts/D2-promote_dev_to_prod.sh
# ou
/home/ubuntu/aiapp/scripts/D2-promote_dev_to_prod.sh --from-dist
```

### 4.3 Arborescence du framework
```
/home/ubuntu/aiapp/frontend/src/
â”œâ”€â”€ App.tsx                    # App principale + routing (NAV1 + NAV2)
â”œâ”€â”€ main.tsx                   # Bootstrap React
â”œâ”€â”€ index.css                  # Styles globaux + layout
â”‚
â”œâ”€â”€ components/                # Composants rÃ©utilisables
â”‚   â”œâ”€â”€ Sidebar/               # Sidebar gauche (header, search, liste, pagination)
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx        # Composant principal
â”‚   â”‚   â”œâ”€â”€ navigationTree.ts  # DÃ©finition des univers et sections
â”‚   â”‚   â”œâ”€â”€ styles.css         # Styles sidebar
â”‚   â”‚   â””â”€â”€ index.ts           # Exports
â”‚   â””â”€â”€ AccountSidebar/        # Sidebar droite (menu utilisateur)
â”‚       â”œâ”€â”€ AccountSidebar.tsx # Composant principal
â”‚       â”œâ”€â”€ UserInfos.tsx      # Infos profil
â”‚       â”œâ”€â”€ UsefulLinks.tsx    # Liens utiles
â”‚       â”œâ”€â”€ Shortcuts.tsx      # Raccourcis
â”‚       â”œâ”€â”€ styles.css         # Styles
â”‚       â””â”€â”€ index.ts           # Exports
â”‚
â”œâ”€â”€ pages/                     # Pages/Routes (chaque page gÃ¨re son NAV3)
â”‚   â”œâ”€â”€ Home.tsx               # Dashboard accueil
â”‚   â”œâ”€â”€ Login.tsx              # Page connexion OAuth OVH
â”‚   â”œâ”€â”€ Dev.tsx                # Playground API / debug
â”‚   â”œâ”€â”€ Account/               # Mon compte (5 onglets internes)
â”‚   â”œâ”€â”€ Billing/               # Facturation (8 onglets internes)
â”‚   â”œâ”€â”€ Services/              # Mes services
â”‚   â”œâ”€â”€ Orders/                # Commandes
â”‚   â”œâ”€â”€ Contacts/              # Contacts
â”‚   â”œâ”€â”€ Communication/         # Communications
â”‚   â”œâ”€â”€ Support/               # Assistance
â”‚   â”œâ”€â”€ Carbon/                # Empreinte carbone
â”‚   â”œâ”€â”€ Iam/                   # Identity & Access Management
â”‚   â””â”€â”€ Placeholder/           # Pages placeholder (univers non implÃ©mentÃ©s)
â”‚
â”œâ”€â”€ contexts/                  # React Contexts
â”‚   â””â”€â”€ AuthContext.tsx
â”‚
â”œâ”€â”€ services/                  # Services API
â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”œâ”€â”€ account.service.ts
â”‚   â”œâ”€â”€ billing.service.ts
â”‚   â”œâ”€â”€ services.service.ts
â”‚   â””â”€â”€ security.service.ts
â”‚
â”œâ”€â”€ types/                     # TypeScript types
â”‚   â”œâ”€â”€ auth.types.ts
â”‚   â””â”€â”€ services.types.ts
â”‚
â”œâ”€â”€ lib/                       # Utilitaires
â”‚   â”œâ”€â”€ useTabs.ts             # Hook gestion onglets
â”‚   â”œâ”€â”€ constants.ts
â”‚   â”œâ”€â”€ types.ts
â”‚   â””â”€â”€ ResetSlot.tsx
â”‚
â””â”€â”€ design-system/             # Design System
    â”œâ”€â”€ index.ts               # Constantes TypeScript
    â”œâ”€â”€ globals.css
    â”œâ”€â”€ tokens.css             # Variables CSS (couleurs, typo, spacing)
    â”œâ”€â”€ tokens/index.ts
    â”œâ”€â”€ PATTERNS.md            # Couleurs, typo, spacing
    â”œâ”€â”€ COMPONENTS.md          # Catalogue composants
    â”œâ”€â”€ DESIGN_TOKENS.md       # Patterns d'usage
    â””â”€â”€ ICONS.md               # IcÃ´nes disponibles
```

---

## 5. Design System (OVH Classic Blue)

### 5.1 Couleurs primaires (tokens.css)

| Token | Valeur | Usage |
|-------|--------|-------|
| `--color-primary-500` | `#0050D7` | Bleu OVH principal |
| `--color-primary-600` | `#003DA8` | Hover/Active |
| `--color-primary-700` | `#002B7A` | Pressed |
| `--color-primary-800` | `#122844` | Dark |
| `--color-primary-300` | `#85A5FF` | Light |
| `--color-primary-100` | `#D6E4FF` | Background |

### 5.2 RÃ¨gle d'utilisation

Utiliser **uniquement** les variables CSS **sans fallback** :
```css
/* âœ… BON */
color: var(--color-primary-500);

/* âŒ MAUVAIS */
color: var(--color-primary-500, #0050D7);
```

### 5.3 Stack technique

| Composant | Source |
|-----------|--------|
| Design System | `@ovh-ux/muk` (Manager UI Kit) |
| Base ODS | `@ovhcloud/ods-react` v19.2.1 |
| ThÃ¨mes | `@ovhcloud/ods-themes` v19.2.1 |
| CSS | Tailwind CSS |

### 5.4 Classes CSS disponibles
```css
/* Boutons */
.btn  .btn-primary  .btn-secondary  .btn-outline

/* Cartes/Tiles */
.tile  .tile-header  .tile-content

/* Onglets */
.tab-btn  .tabs-list

/* Badges */
.status-badge  .badge-success  .badge-warning  .badge-error

/* Formulaires */
.toggle-switch  .toggle-slider

/* SÃ©curitÃ© */
.security-card  .two-factor-method

/* Tableaux */
.bills-table  .method-table
```

---

## 6. Architecture technique

### 6.1 Proxy Nginx

Le frontend communique avec l'API OVH via un proxy Nginx :
```
/api/ovh/*  â†’  https://eu.api.ovh.com/1.0/*
```

La signature des requÃªtes est gÃ©rÃ©e automatiquement cÃ´tÃ© serveur.

### 6.2 Layout principal (App.tsx)
```
+-------------------------------------------------------------------------------------------+
| +-----------------+ +-------------------------------------------------------+ +-------+ |
| | [H] [â–¡] [â–¡] [â–¡] | | HOME | PUBLIC CLOUD | PRIVATE CLOUD | BARE METAL |    | | OK    | |
| +-----------------+ |      | WEB CLOUD | IPv4/IPv6 NETWORK                   | | nic   | |
| | [ğŸ” Search    ] | +-------------------------------------------------------+ +-------+ |
| +-----------------+ | [Accueil] [Mon compte] [Facturation] [Services] [...]  | <- NAV2  |
| | Liste:          | +-------------------------------------------------------+          |
| | - TOUS          | |                                                       |          |
| | - ressource 1   | |    PAGE AVEC SES PROPRES ONGLETS NAV3 INTERNES        |          |
| | - ressource 2   | |    (AccountPage, BillingPage, etc.)                   |          |
| | - ressource 3   | |                                                       |          |
| | - ...           | |    +-----------------------------------------------+  |          |
| |                 | |    | [Tab1] [Tab2] [Tab3] ...    <- NAV3 dans page |  |          |
| |                 | |    +-----------------------------------------------+  |          |
| |                 | |    |                                               |  |          |
| |                 | |    |            CONTENU DE LA PAGE                 |  |          |
| |                 | |    |                                               |  |          |
| +-----------------+ |    +-----------------------------------------------+  |          |
| |  [â—„]  10  [â–º]   | |                                                       |          |
| +-----------------+ +-------------------------------------------------------+          |
+-------------------------------------------------------------------------------------------+
```

**Composants du layout :**

| Zone | Composant | Description |
|------|-----------|-------------|
| Sidebar Header | `SidebarHeader` | IcÃ´ne home + boutons vue (liste/grille) |
| Sidebar Search | `SearchInput` | Recherche (EN HAUT, aprÃ¨s header) |
| Sidebar Liste | `ResourceList` | Liste : TOUS (premier) + ressources |
| Sidebar Pagination | `Pagination` | Navigation â—„ page â–º |
| Niveau 1 (NAV1) | `UniversTabs` | Onglets univers OVH (HOME, PUBLIC CLOUD, etc.) |
| Niveau 2 (NAV2) | `SectionTabs` | Sections de l'univers sÃ©lectionnÃ© |
| Niveau 3 (NAV3) | `PageTabs` | **DANS chaque page** (pas dans le header global) |
| Contenu | `ContentArea` | Zone de contenu dynamique |
| User Menu | `UserMenu` | Avatar + NIC handle, ouvre AccountSidebar |
| AccountSidebar | `AccountSidebar` | Sidebar droite avec profil et actions |

### 6.3 Navigation Niveau 1 (Univers)

| Onglet | Description |
|--------|-------------|
| **HOME** | FonctionnalitÃ©s non-produit (compte, facturation, services, IAM, support...) |
| **PUBLIC CLOUD** | Instances, Storage, Network, AI/ML, Databases |
| **PRIVATE CLOUD** | VMware, Nutanix, SAP HANA |
| **BARE METAL** | Serveurs dÃ©diÃ©s, VPS, Managed Bare Metal |
| **WEB CLOUD** | Domaines, HÃ©bergement, Emails, DNS |
| **IPv4/IPv6 NETWORK** | IP, vRack, Load Balancer, CDN |

### 6.4 Sidebar gauche (Liste des ressources)

| Ã‰lÃ©ment | Position | Fonction |
|---------|----------|----------|
| **Header** | Haut | IcÃ´ne home + boutons vue (liste/grille) |
| **Search** | AprÃ¨s header | Filtre de recherche |
| **Liste** | Centre | TOUS (premier) + ressources de l'univers |
| **Pagination** | Bas | Navigation â—„ page â–º |

**Comportement :**
- La liste se met Ã  jour selon l'univers sÃ©lectionnÃ© (NAV1)
- **TOUS** est toujours le premier Ã©lÃ©ment
- Cliquer sur une ressource affiche ses dÃ©tails dans le contenu
- La recherche filtre en temps rÃ©el
- Pagination avec numÃ©ro de page courant

### 6.5 Univers HOME - Sections (Niveau 2)

L'univers **HOME** regroupe toutes les fonctionnalitÃ©s non-produit :

| Section (NAV2) | Page | Onglets internes (NAV3) |
|----------------|------|-------------------------|
| **Accueil** | `Home.tsx` | Dashboard principal |
| **Mon compte** | `AccountPage` | Info gÃ©nÃ©rales, SÃ©curitÃ©, Niveau support, RGPD, AvancÃ© |
| **Facturation** | `BillingPage` | Factures, Avoirs, Paiements, Moyens, Encours, PrÃ©payÃ©, Bons, FidÃ©litÃ© |
| **Mes services** | `ServicesPage` | Tous, Renouvellement, RÃ©siliation |
| **Commandes** | `OrdersPage` | Historique, Bons de commande |
| **Contacts** | `ContactsPage` | Mes contacts, Gestion droits |
| **IAM** | `IamPage` | IdentitÃ©s, Politiques, Groupes, Logs |
| **Support** | `SupportPage` | Mes demandes, CrÃ©er, Centre d'aide |
| **Communications** | `CommunicationPage` | Emails, Marketing, Notifications |
| **Empreinte carbone** | `CarbonPage` | Dashboard carbone |
| **Playground API** | `Dev.tsx` | Console, Apps, Credentials, Docs |

### 6.6 AccountSidebar (Menu utilisateur)

Accessible via l'avatar/NIC en haut Ã  droite :
```
+---------------------------+
|        [Avatar]           |
|           OK              |
|       [Standard]          |  <- Niveau de support
|      Octave Klaba         |  <- Nom
|    [Administrateur]       |  <- RÃ´le
|         Jezby             |  <- SociÃ©tÃ©
|                           |
|  octave.klaba@ovh.com     |  <- Email
|     ko51027-ovh           |  <- NIC handle
+---------------------------+
|    Voir mes factures  >   |
|  Suivre mes paiements >   |
|    GÃ©rer mes services >   |
+---------------------------+
|     Documentation     >   |
|    Playground API     >   |
|   Ã‰tat des services   >   |
+---------------------------+
|        [Logout]           |
+---------------------------+
```

**Sections :**
- **Profil** : Avatar, niveau support, nom, rÃ´le, sociÃ©tÃ©, email, NIC
- **Raccourcis** : Liens rapides vers sections HOME
- **Liens externes** : Documentation, API, Status
- **Session** : Logout

### 6.7 Univers Produits - Sections (Niveau 2)

**PUBLIC CLOUD :**
| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| Instances | Liste, CrÃ©er |
| Storage | Block, Object, Archive |
| Network | Private Network, Load Balancer |
| Databases | Managed DB |
| AI & ML | Services IA |

**BARE METAL :**
| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| Serveurs dÃ©diÃ©s | Mes serveurs, Commander |
| VPS | Mes VPS, Commander |
| Managed Bare Metal | Services managÃ©s |

**WEB CLOUD :**
| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| Domaines | Mes domaines, Zones DNS |
| HÃ©bergements | Mes hÃ©bergements, Bases de donnÃ©es |
| Emails | Email domain, Email Pro, Exchange |

**IPv4/IPv6 NETWORK :**
| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| IP | Gestion IP |
| vRack | Private network |
| Load Balancer | LB |
| CDN | Content Delivery |

---

## 7. APIs OVH

### 7.1 Authentification

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| POST | `/auth/credential` | Demande de consumer key |
| GET | `/me` | Informations utilisateur |

### 7.2 Facturation

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/me/bill` | Liste des IDs de factures |
| GET | `/me/bill/{billId}` | DÃ©tails d'une facture |
| GET | `/me/refund` | Liste des avoirs |
| GET | `/me/deposit` | Liste des paiements |
| GET | `/me/deposit/{depositId}` | DÃ©tails d'un paiement |
| GET | `/me/payment/method` | Moyens de paiement |
| GET | `/me/debtAccount` | Encours/dette |
| GET | `/me/ovhAccount` | Compte prÃ©payÃ© |
| GET | `/me/voucherAccount` | Bons d'achat |
| GET | `/me/fidelityAccount` | Points fidÃ©litÃ© |

### 7.3 SÃ©curitÃ© (2FA)

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/me/accessRestriction/sms` | Liste SMS 2FA |
| GET | `/me/accessRestriction/totp` | Liste TOTP (app mobile) |
| GET | `/me/accessRestriction/u2f` | Liste clÃ©s U2F |
| GET | `/me/accessRestriction/backupCode` | Codes de secours |

### 7.4 Compte

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/me/supportLevel` | Niveau de support |
| GET | `/me/marketing` | PrÃ©fÃ©rences marketing |
| PUT | `/me/marketing` | Mise Ã  jour marketing |
| GET | `/me/privacy/requests` | Demandes RGPD |
| POST | `/me/privacy/requests/erasure` | Demande suppression |

---

## 8. Old Manager (RÃ©fÃ©rence)

### 8.1 Structure principale
```
/home/ubuntu/manager/packages/manager/
â”œâ”€â”€ core/          # Utilitaires fondamentaux
â”œâ”€â”€ modules/       # Modules mÃ©tier rÃ©utilisables
â””â”€â”€ apps/          # Applications complÃ¨tes
```

### 8.2 Core (`packages/manager/core/`)
```
api, application, ovh-product-icons, request-tagger,
shell-client, sso, url-builder, utils
```

### 8.3 Modules (`packages/manager/modules/`)
```
account, billing, billing-components, iam, support, order,
exchange, emailpro, email-domain, nasha, netapp, pci,
vps, vrack, carbon-calculator, mfa-enrollment, ...
```

### 8.4 Apps (`packages/manager/apps/`)
```
account, billing, dedicated, dedicated-servers, hub,
iam, pci, public-cloud, vps, vrack, web, web-hosting,
support, sms, telecom, exchange, email-pro, ...
```

---

## 9. Conventions de code

| RÃ¨gle | Application |
|-------|-------------|
| **TypeScript** | Mode strict |
| **Composants** | Fonctionnels avec hooks |
| **Nommage composants** | PascalCase |
| **Nommage fonctions/variables** | camelCase |
| **Structure fichiers** | Un composant = un fichier |
| **Exports** | NommÃ©s (prÃ©fÃ©rÃ©s aux exports default) |
| **Appels API** | Dans `services/`, jamais dans les composants |
| **NAV3 (onglets internes)** | GÃ©rÃ©s par chaque page, pas dans App.tsx |

### âš ï¸ SÃ©curitÃ©

**JAMAIS de secrets dans le code frontend :**
- Pas de clÃ©s API, tokens, mots de passe ou credentials en dur
- Pas de secrets dans les variables d'environnement exposÃ©es au client (`VITE_*`)
- L'authentification passe par le flow OAuth OVH (cookies httpOnly cÃ´tÃ© serveur)
- Les appels API utilisent les credentials de session, pas de tokens hardcodÃ©s

---

## 10. RÃ©fÃ©rence rapide
```bash
# Localiser dans l'ancien manager
cd /home/ubuntu/manager && grep -r "pattern" packages/

# CrÃ©er archive new manager
cd /home/ubuntu && tar -cvf new_manager.tar --exclude='*2025*' aiapp/frontend/src/

# Build dev (compile + dÃ©ploie en dev)
cd /home/ubuntu/aiapp/frontend && npm run build:dev
/home/ubuntu/aiapp/scripts/D1-build_frontend_dev.sh

# Build prod (compile + promeut en prod)
cd /home/ubuntu/aiapp/frontend && npm run build:prod
/home/ubuntu/aiapp/scripts/D2-promote_dev_to_prod.sh
# ou directement depuis dist :
/home/ubuntu/aiapp/scripts/D2-promote_dev_to_prod.sh --from-dist
```

---

## 11. Structure navigationTree.ts

DÃ©finition des univers dans `/src/components/Sidebar/navigationTree.ts` :
```typescript
interface Universe {
  id: string;           // "home", "public-cloud", etc.
  label: string;        // "HOME", "PUBLIC CLOUD", etc.
  shortLabel?: string;  // Label court pour affichage compact
  sections: UniversSection[];
}

interface UniversSection {
  id: string;           // "home-account", "pci-instances", etc.
  label: string;        // "Mon compte", "Instances", etc.
  subsections?: NavNode[];  // Sous-sections (liens externes possibles)
}

interface NavNode {
  id: string;
  label: string;
  url?: string;         // URL pour liens externes
  external?: boolean;   // true = ouvre dans nouvel onglet
}
```

**Univers dÃ©finis :**
1. `home` - HOME (11 sections)
2. `public-cloud` - PUBLIC CLOUD
3. `private-cloud` - PRIVATE CLOUD
4. `bare-metal` - BARE METAL
5. `web-cloud` - WEB CLOUD
6. `network` - IPv4/IPv6 NETWORK
