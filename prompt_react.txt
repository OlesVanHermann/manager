# CONSIGNES REACT - NEW MANAGER OVHcloud

## 1. Contexte du projet

Interface **New Manager** pour la gestion des services OVHcloud : Cloud, HÃ©bergement Web, Email, DNS, Domaines, VPS, Serveurs dÃ©diÃ©s.

Ce projet est une **rÃ©Ã©criture progressive** du "old manager" existant (monorepo Angular + React OVHcloud).

### 1.1 Objectif de migration

Le **Old Manager** est accessible en production sur : `https://manager.eu.ovhcloud.com`

**StratÃ©gie de migration :**
- âŒ **NE PAS** faire de redirections vers `manager.eu.ovhcloud.com`
- âœ… **RÃ‰Ã‰CRIRE** les fonctionnalitÃ©s en identifiant les appels API dans le code source du old manager
- âœ… **UTILISER** les APIs OVH directement dans le New Manager

**MÃ©thodologie "la mÃ©thode" :**
1. **Localiser** la fonctionnalitÃ© dans le old manager (`/home/ubuntu/manager/`)
2. **Identifier** les appels API (endpoints `/me/*`, `/services/*`, etc.)
3. **Extraire** la logique mÃ©tier et les types TypeScript
4. **GÃ©nÃ©rer** le composant React Ã©quivalent pour le new manager

---

## 2. RÃ¨gles de travail

1. **Lire et analyser** le code fourni. Ne pas partager l'analyse sauf demande explicite.
2. **Ne rien faire** sans autorisation.
3. **Attendre les consignes** avant toute action.
4. **GÃ©nÃ©rer le code** dans le chat en utilisant **un seul bloc de code** avec copier-coller.
5. **Encapsuler** les commandes `cp` et `tee` dans un bloc markdown.
6. **Migration** : utiliser "la mÃ©thode" â†’ `grep` dans old manager â†’ localiser les appels API â†’ extraire types â†’ gÃ©nÃ©rer composant React (âš ï¸ pas de redirection vers manager.eu.ovhcloud.com)
7. **Conserver** le design system existant, ne pas rÃ©inventer les composants UI.
8. **Erreur 401 API** : rediriger vers l'auth OVH, pas d'erreur affichÃ©e.

---

## 3. Structure des rÃ©pertoires

| Ã‰lÃ©ment | Chemin |
|---------|--------|
| **New Manager (Frontend React)** | `/home/ubuntu/aiapp/frontend/src/` |
| **Old Manager (RÃ©fÃ©rence)** | `/home/ubuntu/manager/` |

---

## 4. New Manager

### 4.1 Archive
```bash
cd /home/ubuntu/
tar -cvf new_manager.tar --exclude='*2025*' aiapp/frontend/src/
```

### 4.2 Build

**DÃ©veloppement :**
```bash
cd /home/ubuntu/aiapp/frontend
npm run build:dev
/home/ubuntu/aiapp/scripts/D1-build_frontend_dev.sh
```

**Production :**
```bash
cd /home/ubuntu/aiapp/frontend
npm run build:prod
/home/ubuntu/aiapp/scripts/D2-promote_dev_to_prod.sh
# ou
/home/ubuntu/aiapp/scripts/D2-promote_dev_to_prod.sh --from-dist
```

### 4.3 Arborescence du framework (Organisation par Univers)
```
/home/ubuntu/aiapp/frontend/src/
â”œâ”€â”€ App.tsx                    # App principale + routing (NAV1 + NAV2)
â”œâ”€â”€ main.tsx                   # Bootstrap React
â”œâ”€â”€ index.css                  # Styles globaux + layout
â”‚
â”œâ”€â”€ components/                # Composants rÃ©utilisables
â”‚   â”œâ”€â”€ Sidebar/               # Sidebar gauche (header, search, liste, pagination)
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx        # Composant principal
â”‚   â”‚   â”œâ”€â”€ navigationTree.ts  # DÃ©finition des univers et sections
â”‚   â”‚   â”œâ”€â”€ styles.css         # Styles sidebar
â”‚   â”‚   â””â”€â”€ index.ts           # Exports
â”‚   â”œâ”€â”€ AccountSidebar/        # Sidebar droite (menu utilisateur)
â”‚   â”‚   â”œâ”€â”€ AccountSidebar.tsx # Composant principal
â”‚   â”‚   â”œâ”€â”€ UserInfos.tsx      # Infos profil
â”‚   â”‚   â”œâ”€â”€ UsefulLinks.tsx    # Liens utiles
â”‚   â”‚   â”œâ”€â”€ Shortcuts.tsx      # Raccourcis
â”‚   â”‚   â”œâ”€â”€ styles.css         # Styles
â”‚   â”‚   â””â”€â”€ index.ts           # Exports
â”‚   â”œâ”€â”€ Skeleton.tsx           # Composants skeleton loading
â”‚   â””â”€â”€ ServiceIcons.tsx       # IcÃ´nes des services
â”‚
â”œâ”€â”€ pages/                     # Pages organisÃ©es par UNIVERS (NAV1)
â”‚   â”œâ”€â”€ Login.tsx              # Page connexion OAuth OVH
â”‚   â”‚
â”‚   â”œâ”€â”€ home/                  # A) Univers HOME
â”‚   â”‚   â”œâ”€â”€ index.tsx          # Dashboard accueil
â”‚   â”‚   â”œâ”€â”€ styles.css
â”‚   â”‚   â”œâ”€â”€ account/           # A.2 Compte (7 tabs)
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx      # AccountPage (router tabs)
â”‚   â”‚   â”‚   â”œâ”€â”€ SecurityTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EditTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PrivacyTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AdvancedTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ContactServicesTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ styles.css
â”‚   â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚   â”‚       â”œâ”€â”€ ProfileTile.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ LastBillTile.tsx
â”‚   â”‚   â”‚       â””â”€â”€ ShortcutsTile.tsx
â”‚   â”‚   â”œâ”€â”€ billing/           # A.3 Facturation (11 tabs)
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx      # BillingPage (router tabs)
â”‚   â”‚   â”‚   â”œâ”€â”€ ServicesTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PaymentsTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ OrdersTab.tsx
â”‚   â”‚   â”‚   â””â”€â”€ styles.css
â”‚   â”‚   â”œâ”€â”€ support/           # A.4 Support (5 tabs)
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx      # SupportPage (router tabs)
â”‚   â”‚   â”‚   â”œâ”€â”€ LevelTab.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CommunicationsTab.tsx
â”‚   â”‚   â”‚   â””â”€â”€ styles.css
â”‚   â”‚   â”œâ”€â”€ carbon/            # A.5 Carbone
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â””â”€â”€ styles.css
â”‚   â”‚   â””â”€â”€ api/               # A.6 Playground API (2 tabs)
â”‚   â”‚       â”œâ”€â”€ index.tsx
â”‚   â”‚       â””â”€â”€ styles.css
â”‚   â”‚
â”‚   â”œâ”€â”€ iam/                   # G) Univers IAM (4 tabs)
â”‚   â”‚   â”œâ”€â”€ index.tsx          # IamPage (router tabs)
â”‚   â”‚   â””â”€â”€ styles.css
â”‚   â”‚
â”‚   â”œâ”€â”€ public-cloud/          # B) Univers PUBLIC CLOUD (placeholder)
â”‚   â”œâ”€â”€ private-cloud/         # C) Univers PRIVATE CLOUD (placeholder)
â”‚   â”œâ”€â”€ bare-metal/            # D) Univers BARE METAL (placeholder)
â”‚   â”œâ”€â”€ web-cloud/             # E) Univers WEB CLOUD (placeholder)
â”‚   â”œâ”€â”€ network/               # F) Univers NETWORK (placeholder)
â”‚   â”‚
â”‚   â””â”€â”€ _placeholder/          # Template pages non implÃ©mentÃ©es
â”‚       â”œâ”€â”€ index.tsx
â”‚       â””â”€â”€ styles.css
â”‚
â”œâ”€â”€ contexts/                  # React Contexts
â”‚   â””â”€â”€ AuthContext.tsx
â”‚
â”œâ”€â”€ services/                  # Services API
â”‚   â”œâ”€â”€ api.ts                 # Client API base + getCredentials
â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”œâ”€â”€ account.service.ts
â”‚   â”œâ”€â”€ billing.service.ts
â”‚   â”œâ”€â”€ services.service.ts
â”‚   â”œâ”€â”€ orders.service.ts
â”‚   â”œâ”€â”€ contacts.service.ts
â”‚   â”œâ”€â”€ support.service.ts
â”‚   â”œâ”€â”€ communication.service.ts  # APIs v2 /notification/*
â”‚   â”œâ”€â”€ notifications.service.ts
â”‚   â”œâ”€â”€ agreements.service.ts
â”‚   â”œâ”€â”€ procedures.service.ts     # KYC /me/procedure/*
â”‚   â”œâ”€â”€ iam.service.ts
â”‚   â””â”€â”€ security.service.ts
â”‚
â”œâ”€â”€ types/                     # TypeScript types
â”‚   â”œâ”€â”€ auth.types.ts
â”‚   â””â”€â”€ services.types.ts
â”‚
â”œâ”€â”€ lib/                       # Utilitaires
â”‚   â”œâ”€â”€ useTabs.ts             # Hook gestion onglets
â”‚   â”œâ”€â”€ constants.ts
â”‚   â”œâ”€â”€ types.ts
â”‚   â””â”€â”€ ResetSlot.tsx
â”‚
â””â”€â”€ design-system/             # Design System
    â”œâ”€â”€ index.ts               # Constantes TypeScript
    â”œâ”€â”€ globals.css
    â”œâ”€â”€ tokens.css             # Variables CSS (couleurs, typo, spacing)
    â”œâ”€â”€ tokens/index.ts
    â”œâ”€â”€ PATTERNS.md            # Couleurs, typo, spacing
    â”œâ”€â”€ COMPONENTS.md          # Catalogue composants
    â”œâ”€â”€ DESIGN_TOKENS.md       # Patterns d'usage
    â””â”€â”€ ICONS.md               # IcÃ´nes disponibles
```

### 4.4 Convention de nommage des fichiers

| Ã‰lÃ©ment | Convention | Exemple |
|---------|------------|---------|
| RÃ©pertoire univers (NAV1) | `kebab-case` | `public-cloud/`, `bare-metal/` |
| RÃ©pertoire section (NAV2) | `kebab-case` | `account/`, `billing/` |
| Page principale section | `index.tsx` | `pages/home/account/index.tsx` |
| Tab (NAV3) | `PascalCaseTab.tsx` | `SecurityTab.tsx`, `OrdersTab.tsx` |
| Composant local | `PascalCase.tsx` | `ProfileTile.tsx` |
| Styles section | `styles.css` | `pages/home/account/styles.css` |

### 4.5 Imports dans App.tsx

```typescript
// Univers HOME (A)
import HomePage from "./pages/home";
import AccountPage from "./pages/home/account";
import BillingPage from "./pages/home/billing";
import SupportPage from "./pages/home/support";
import CarbonPage from "./pages/home/carbon";
import ApiPage from "./pages/home/api";

// Univers IAM (G)
import IamPage from "./pages/iam";

// Placeholder pour univers non implÃ©mentÃ©s
import { PlaceholderPage } from "./pages/_placeholder";
```

### 4.6 Chemins d'imports relatifs

| Depuis | Vers services/ | Vers types/ |
|--------|---------------|-------------|
| `pages/home/index.tsx` | `../../services/` | `../../types/` |
| `pages/home/account/index.tsx` | `../../../services/` | `../../../types/` |
| `pages/home/account/SecurityTab.tsx` | `../../../services/` | `../../../types/` |
| `pages/home/account/components/ProfileTile.tsx` | `../../../../services/` | `../../../../types/` |
| `pages/iam/index.tsx` | `../../services/` | `../../types/` |

---

## 5. Design System (OVH Classic Blue)

### 5.1 Couleurs primaires (tokens.css)

| Token | Valeur | Usage |
|-------|--------|-------|
| `--color-primary-500` | `#0050D7` | Bleu OVH principal |
| `--color-primary-600` | `#003DA8` | Hover/Active |
| `--color-primary-700` | `#002B7A` | Pressed |
| `--color-primary-800` | `#122844` | Dark |
| `--color-primary-300` | `#85A5FF` | Light |
| `--color-primary-100` | `#D6E4FF` | Background |

### 5.2 RÃ¨gle d'utilisation

Utiliser **uniquement** les variables CSS **sans fallback** :
```css
/* âœ… BON */
color: var(--color-primary-500);

/* âŒ MAUVAIS */
color: var(--color-primary-500, #0050D7);
```

### 5.3 Stack technique

| Composant | Source |
|-----------|--------|
| Design System | `@ovh-ux/muk` (Manager UI Kit) |
| Base ODS | `@ovhcloud/ods-react` v19.2.1 |
| ThÃ¨mes | `@ovhcloud/ods-themes` v19.2.1 |
| CSS | Tailwind CSS |

### 5.4 Classes CSS disponibles
```css
/* Boutons */
.btn  .btn-primary  .btn-secondary  .btn-outline

/* Cartes/Tiles */
.tile  .tile-header  .tile-content

/* Onglets */
.tab-btn  .tabs-list

/* Badges */
.status-badge  .badge-success  .badge-warning  .badge-error

/* Formulaires */
.toggle-switch  .toggle-slider

/* SÃ©curitÃ© */
.security-card  .two-factor-method

/* Tableaux */
.bills-table  .method-table
```

---

## 6. Architecture technique

### 6.1 Proxy Nginx

Le frontend communique avec l'API OVH via un proxy Nginx :
```
/api/ovh/*  â†’  https://eu.api.ovh.com/1.0/*
```

La signature des requÃªtes est gÃ©rÃ©e automatiquement cÃ´tÃ© serveur.

### 6.2 Layout principal (App.tsx)
```
+-------------------------------------------------------------------------------------------+
| +-----------------+ +-------------------------------------------------------+ +-------+ |
| | [H] [â–¡] [â–¡] [â–¡] | | HOME | PUBLIC CLOUD | PRIVATE CLOUD | BARE METAL |    | | OK    | |
| +-----------------+ |      | WEB CLOUD | NETWORK | IAM                      | | nic   | |
| | [ğŸ” Search    ] | +-------------------------------------------------------+ +-------+ |
| +-----------------+ | [Accueil] [Compte] [Facturation] [Support] [...]       | <- NAV2  |
| | Liste:          | +-------------------------------------------------------+          |
| | - TOUS          | |                                                       |          |
| | - ressource 1   | |    PAGE AVEC SES PROPRES ONGLETS NAV3 INTERNES        |          |
| | - ressource 2   | |    (AccountPage, BillingPage, etc.)                   |          |
| | - ressource 3   | |                                                       |          |
| | - ...           | |    +-----------------------------------------------+  |          |
| |                 | |    | [Tab1] [Tab2] [Tab3] ...    <- NAV3 dans page |  |          |
| |                 | |    +-----------------------------------------------+  |          |
| |                 | |    |                                               |  |          |
| |                 | |    |            CONTENU DE LA PAGE                 |  |          |
| |                 | |    |                                               |  |          |
| +-----------------+ |    +-----------------------------------------------+  |          |
| |  [â—„]  10  [â–º]   | |                                                       |          |
| +-----------------+ +-------------------------------------------------------+          |
+-------------------------------------------------------------------------------------------+
```

**Composants du layout :**

| Zone | Composant | Description |
|------|-----------|-------------|
| Sidebar Header | `SidebarHeader` | IcÃ´ne home + boutons vue (liste/grille) |
| Sidebar Search | `SearchInput` | Recherche (EN HAUT, aprÃ¨s header) |
| Sidebar Liste | `ResourceList` | Liste : TOUS (premier) + ressources |
| Sidebar Pagination | `Pagination` | Navigation â—„ page â–º |
| Niveau 1 (NAV1) | `UniversTabs` | Onglets univers OVH (HOME, PUBLIC CLOUD, etc.) |
| Niveau 2 (NAV2) | `SectionTabs` | Sections de l'univers sÃ©lectionnÃ© |
| Niveau 3 (NAV3) | `PageTabs` | **DANS chaque page** (pas dans le header global) |
| Contenu | `ContentArea` | Zone de contenu dynamique |
| User Menu | `UserMenu` | Avatar + NIC handle, ouvre AccountSidebar |
| AccountSidebar | `AccountSidebar` | Sidebar droite avec profil et actions |

### 6.3 Navigation Niveau 1 (Univers) - NAV1

| ID | Onglet | RÃ©pertoire | Description |
|----|--------|------------|-------------|
| A | **HOME** | `pages/home/` | FonctionnalitÃ©s transverses (compte, facturation, support) |
| B | **PUBLIC CLOUD** | `pages/public-cloud/` | Instances, Storage, Network, AI/ML, Databases |
| C | **PRIVATE CLOUD** | `pages/private-cloud/` | VMware, Nutanix, SAP HANA |
| D | **BARE METAL** | `pages/bare-metal/` | Serveurs dÃ©diÃ©s, VPS, Managed Bare Metal |
| E | **WEB CLOUD** | `pages/web-cloud/` | Domaines, HÃ©bergement, Emails, DNS |
| F | **NETWORK** | `pages/network/` | IP, vRack, Load Balancer, CDN |
| G | **IAM** | `pages/iam/` | Identity & Access Management |

### 6.4 Sidebar gauche (Liste des ressources)

| Ã‰lÃ©ment | Position | Fonction |
|---------|----------|----------|
| **Header** | Haut | IcÃ´ne home + boutons vue (liste/grille) |
| **Search** | AprÃ¨s header | Filtre de recherche |
| **Liste** | Centre | TOUS (premier) + ressources de l'univers |
| **Pagination** | Bas | Navigation â—„ page â–º |

**Comportement :**
- La liste se met Ã  jour selon l'univers sÃ©lectionnÃ© (NAV1)
- **TOUS** est toujours le premier Ã©lÃ©ment
- Cliquer sur une ressource affiche ses dÃ©tails dans le contenu
- La recherche filtre en temps rÃ©el
- Pagination avec numÃ©ro de page courant

---

## 7. Univers HOME - Structure complÃ¨te (A)

L'univers **HOME** regroupe toutes les fonctionnalitÃ©s transverses.

### 7.1 Sections HOME (NAV2)

| # | Section (NAV2) | RÃ©pertoire | Route interne |
|---|----------------|------------|---------------|
| 1 | **Accueil** | `home/index.tsx` | `home-dashboard` |
| 2 | **Compte** | `home/account/` | `home-account` |
| 3 | **Facturation** | `home/billing/` | `home-billing` |
| 4 | **Support** | `home/support/` | `home-support` |
| 5 | **Carbone** | `home/carbon/` | `home-carbon` |
| 6 | **Playground API** | `home/api/` | `home-api` |

### 7.2 Compte - Tabs (NAV3)

| # | Tab ID | Label | Fichier | API principale |
|---|--------|-------|---------|----------------|
| a | `info` | Informations gÃ©nÃ©rales | `index.tsx` (default) | `GET /me` |
| b | `edit` | Ã‰diter mon compte | `EditTab.tsx` | `PUT /me` |
| c | `security` | SÃ©curitÃ© | `SecurityTab.tsx` | `GET /me/accessRestriction/*` |
| d | `gdpr` | DonnÃ©es personnelles | `PrivacyTab.tsx` | `GET /me/privacy/*` |
| e | `advanced` | ParamÃ¨tres avancÃ©s | `AdvancedTab.tsx` | `GET /me/preferences` |
| f | `contacts-services` | Mes services (contacts) | `ContactServicesTab.tsx` | `GET /me/contact` |
| g | `contacts-requests` | Mes demandes (contacts) | *(Ã  crÃ©er)* | `GET /me/task/contactChange` |

### 7.3 Facturation - Tabs (NAV3)

| # | Tab ID | Label | Fichier | API principale |
|---|--------|-------|---------|----------------|
| a | `services` | Mes services | `ServicesTab.tsx` | `GET /services` |
| b | `invoices` | Factures | `index.tsx` (dans BillingPage) | `GET /me/bill` |
| c | `refunds` | Avoirs | `index.tsx` | `GET /me/refund` |
| d | `payments` | Paiement | `PaymentsTab.tsx` | `GET /me/deposit` |
| e | `orders` | Commandes | `OrdersTab.tsx` | `GET /me/order` |
| f | `references` | Mes rÃ©fÃ©rences internes | *(Ã  crÃ©er)* | `GET /me/billing/invoicesByPostalMail` |
| g | `methods` | Moyens de paiement | `index.tsx` | `GET /me/payment/method` |
| h | `prepaid` | Compte prÃ©payÃ© | `index.tsx` | `GET /me/ovhAccount` |
| i | `vouchers` | Bon d'achat | `index.tsx` | `GET /me/voucherAccount` |
| j | `fidelity` | Points de fidÃ©litÃ© | `index.tsx` | `GET /me/fidelityAccount` |
| k | `contracts` | Contrats | `index.tsx` | `GET /me/agreements` |

### 7.4 Support - Tabs (NAV3)

| # | Tab ID | Label | Fichier | API principale |
|---|--------|-------|---------|----------------|
| a | `tickets` | Mes tickets | `index.tsx` (default) | `GET /support/tickets` |
| b | `create` | CrÃ©er un nouveau ticket | `index.tsx` | `POST /support/tickets` |
| c | `level` | Mon niveau de support | `LevelTab.tsx` | `GET /me/supportLevel` |
| d | `communications` | Mes communications | `CommunicationsTab.tsx` | `GET /me/notification` |
| e | `broadcast` | ParamÃ¨tres de diffusion | *(Ã  crÃ©er)* | `GET /me/notification/preferences` |

### 7.5 Playground API - Tabs (NAV3)

| # | Tab ID | Label | Fichier | Description |
|---|--------|-------|---------|-------------|
| a | `api` | API | `index.tsx` (default) | Console interactive |
| b | `advanced` | ParamÃ¨tres avancÃ©s | *(dans index)* | Credentials, tokens |

---

## 8. Univers IAM - Structure complÃ¨te (G)

L'univers **IAM** est un univers autonome dÃ©diÃ© Ã  la gestion des accÃ¨s.

### 8.1 Sections IAM (NAV2 = Tabs)

Dans IAM, les sections NAV2 sont directement les tabs (pas de sous-navigation).

| # | Section ID | Label | Fichier | API principale |
|---|------------|-------|---------|----------------|
| a | `iam-identities` | IdentitÃ©s | `index.tsx` | `GET /me/identity/user` |
| b | `iam-policies` | Politiques | `index.tsx` | `GET /iam/policy` |
| c | `iam-groups` | Groupes | `index.tsx` | `GET /me/identity/group` |
| d | `iam-logs` | Logs | `index.tsx` | `GET /me/logs` |

---

## 9. Univers Produits (B-F) - Placeholders

Ces univers utilisent `_placeholder/index.tsx` en attendant l'implÃ©mentation.

### 9.1 PUBLIC CLOUD (B) - `pages/public-cloud/`

| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| Instances | Liste, CrÃ©er |
| Storage | Block, Object, Archive |
| Network | Private Network, Load Balancer |
| Databases | Managed DB |
| AI & ML | Services IA |

### 9.2 PRIVATE CLOUD (C) - `pages/private-cloud/`

| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| VMware | vSphere, NSX |
| Nutanix | Clusters |
| SAP HANA | Instances SAP |

### 9.3 BARE METAL (D) - `pages/bare-metal/`

| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| Serveurs dÃ©diÃ©s | Mes serveurs, Commander |
| VPS | Mes VPS, Commander |
| Managed Bare Metal | Services managÃ©s |

### 9.4 WEB CLOUD (E) - `pages/web-cloud/`

| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| Domaines | Mes domaines, Zones DNS |
| HÃ©bergements | Mes hÃ©bergements, Bases de donnÃ©es |
| Emails | Email domain, Email Pro, Exchange |

### 9.5 NETWORK (F) - `pages/network/`

| Section | Subsections |
|---------|-------------|
| Accueil | Dashboard |
| IP | Gestion IP |
| vRack | Private network |
| Load Balancer | LB |
| CDN | Content Delivery |

---

## 10. APIs OVH

### 10.1 Authentification

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| POST | `/auth/credential` | Demande de consumer key |
| GET | `/me` | Informations utilisateur |

### 10.2 Compte

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/me` | Informations gÃ©nÃ©rales |
| PUT | `/me` | Ã‰diter mon compte |
| GET | `/me/contact` | Mes services (contacts) |
| GET | `/me/task/contactChange` | Mes demandes (contact change) |
| GET | `/me/preferences` | ParamÃ¨tres avancÃ©s |

### 10.3 SÃ©curitÃ© (2FA)

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/me/accessRestriction/sms` | Liste SMS 2FA |
| GET | `/me/accessRestriction/totp` | Liste TOTP (app mobile) |
| GET | `/me/accessRestriction/u2f` | Liste clÃ©s U2F |
| GET | `/me/accessRestriction/backupCode` | Codes de secours |

### 10.4 DonnÃ©es personnelles (RGPD)

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/me/privacy/requests` | Demandes RGPD |
| POST | `/me/privacy/requests/erasure` | Demande suppression |
| POST | `/me/privacy/requests/export` | Demande export |

### 10.5 Facturation

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/services` | Mes services |
| GET | `/me/bill` | Factures |
| GET | `/me/bill/{billId}` | DÃ©tails facture |
| GET | `/me/refund` | Avoirs |
| GET | `/me/deposit` | Paiements |
| GET | `/me/deposit/{depositId}` | DÃ©tails paiement |
| GET | `/me/order` | Commandes |
| GET | `/me/payment/method` | Moyens de paiement |
| GET | `/me/debtAccount` | Encours/dette |
| GET | `/me/ovhAccount` | Compte prÃ©payÃ© |
| GET | `/me/voucherAccount` | Bons d'achat |
| GET | `/me/fidelityAccount` | Points fidÃ©litÃ© |
| GET | `/me/agreements` | Contrats |

### 10.6 Support

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/support/tickets` | Mes tickets |
| POST | `/support/tickets` | CrÃ©er ticket |
| GET | `/support/tickets/{ticketId}` | DÃ©tails ticket |
| GET | `/me/supportLevel` | Niveau de support |
| GET | `/me/notification` | Mes communications |
| GET/PUT | `/me/notification/preferences` | ParamÃ¨tres de diffusion |

### 10.7 IAM

| MÃ©thode | Endpoint | Description |
|---------|----------|-------------|
| GET | `/me/identity/user` | Liste identitÃ©s |
| GET | `/iam/policy` | Liste politiques |
| GET | `/me/identity/group` | Liste groupes |
| GET | `/me/logs` | Logs audit |

---

## 11. Old Manager (RÃ©fÃ©rence)

**Production** : `https://manager.eu.ovhcloud.com`
**Code source** : `/home/ubuntu/manager/`

### 11.1 Structure principale
```
/home/ubuntu/manager/packages/manager/
â”œâ”€â”€ core/          # Utilitaires fondamentaux
â”œâ”€â”€ modules/       # Modules mÃ©tier rÃ©utilisables
â””â”€â”€ apps/          # Applications complÃ¨tes
```

### 11.2 Core (`packages/manager/core/`)
```
api, application, ovh-product-icons, request-tagger,
shell-client, sso, url-builder, utils
```

### 11.3 Modules (`packages/manager/modules/`)
```
account, billing, billing-components, iam, support, order,
exchange, emailpro, email-domain, nasha, netapp, pci,
vps, vrack, carbon-calculator, mfa-enrollment, ...
```

### 11.4 Apps (`packages/manager/apps/`)
```
account, billing, dedicated, dedicated-servers, hub,
iam, pci, public-cloud, vps, vrack, web, web-hosting,
support, sms, telecom, exchange, email-pro, ...
```

### 11.5 MÃ©thodologie : Trouver les appels API

**âš ï¸ IMPORTANT : Ne jamais rediriger vers manager.eu.ovhcloud.com**

Pour chaque fonctionnalitÃ© Ã  migrer, identifier les appels API dans le old manager :

```bash
# 1. Chercher les endpoints API dans un module
cd /home/ubuntu/manager
grep -r "api.get\|api.post\|api.put\|api.delete" packages/manager/modules/billing/

# 2. Chercher les appels /me/* (compte utilisateur)
grep -rn "/me/" packages/manager/apps/account/

# 3. Chercher les services API d'un module
find packages/manager/modules/billing -name "*.service.ts" -o -name "*api*.ts"

# 4. Chercher une fonctionnalitÃ© spÃ©cifique
grep -rn "refund\|avoir" packages/manager/modules/billing/

# 5. Voir les types/interfaces d'un endpoint
grep -rn "interface.*Bill\|type.*Bill" packages/manager/modules/billing/
```

**Exemple de migration - Support (Tickets) :**
```bash
# Ã‰tape 1 : Localiser
grep -rn "ticket" packages/manager/modules/support/
# â†’ Trouve : support-ticket.service.ts

# Ã‰tape 2 : Identifier l'API
cat packages/manager/modules/support/src/services/support-ticket.service.ts
# â†’ Trouve : GET /support/tickets, POST /support/tickets

# Ã‰tape 3 : Extraire les types
grep -rn "interface.*Ticket" packages/manager/modules/support/
# â†’ Trouve les interfaces TypeScript

# Ã‰tape 4 : GÃ©nÃ©rer dans new_manager
# â†’ CrÃ©er support.service.ts avec getTickets(), createTicket()
# â†’ CrÃ©er pages/home/support/TicketsTab.tsx
```

---

## 12. Conventions de code

| RÃ¨gle | Application |
|-------|-------------|
| **TypeScript** | Mode strict |
| **Composants** | Fonctionnels avec hooks |
| **Nommage composants** | PascalCase |
| **Nommage fonctions/variables** | camelCase |
| **Nommage rÃ©pertoires** | kebab-case |
| **Structure fichiers** | Un composant = un fichier |
| **Exports** | Default pour pages, nommÃ©s pour composants |
| **Appels API** | Dans `services/`, jamais dans les composants |
| **NAV3 (onglets internes)** | GÃ©rÃ©s par chaque page, pas dans App.tsx |

### âš ï¸ SÃ©curitÃ©

**JAMAIS de secrets dans le code frontend :**
- Pas de clÃ©s API, tokens, mots de passe ou credentials en dur
- Pas de secrets dans les variables d'environnement exposÃ©es au client (`VITE_*`)
- L'authentification passe par le flow OAuth OVH (cookies httpOnly cÃ´tÃ© serveur)
- Les appels API utilisent les credentials de session, pas de tokens hardcodÃ©s

---

## 13. RÃ©fÃ©rence rapide

### 13.1 Recherche dans le Old Manager
```bash
# Chercher une fonctionnalitÃ©
cd /home/ubuntu/manager && grep -rn "pattern" packages/

# Chercher les appels API d'un module
grep -r "api.get\|api.post" packages/manager/modules/MODULE_NAME/

# Chercher les endpoints /me/*
grep -rn '"/me/' packages/manager/apps/APP_NAME/

# Chercher les services d'un module
find packages/manager/modules/MODULE_NAME -name "*.service.ts"

# Chercher les types/interfaces
grep -rn "interface\|type" packages/manager/modules/MODULE_NAME/src/types/
```

### 13.2 Build New Manager
```bash
# CrÃ©er archive new manager
cd /home/ubuntu && tar -cvf new_manager.tar --exclude='*2025*' aiapp/frontend/src/

# Build dev (compile + dÃ©ploie en dev)
cd /home/ubuntu/aiapp/frontend && npm run build:dev
/home/ubuntu/aiapp/scripts/D1-build_frontend_dev.sh

# Build prod (compile + promeut en prod)
cd /home/ubuntu/aiapp/frontend && npm run build:prod
/home/ubuntu/aiapp/scripts/D2-promote_dev_to_prod.sh
# ou directement depuis dist :
/home/ubuntu/aiapp/scripts/D2-promote_dev_to_prod.sh --from-dist
```

### 13.3 CrÃ©er un nouveau Tab

```bash
# Exemple : crÃ©er ContactRequestsTab dans Account
touch /home/ubuntu/aiapp/frontend/src/pages/home/account/ContactRequestsTab.tsx
```

Structure type :
```typescript
import { useState, useEffect } from "react";
import type { OvhCredentials } from "../../../types/auth.types";
import * as contactsService from "../../../services/contacts.service";

const STORAGE_KEY = "ovh_credentials";

function getCredentials(): OvhCredentials | null {
  const stored = sessionStorage.getItem(STORAGE_KEY);
  if (!stored) return null;
  try { return JSON.parse(stored); } catch { return null; }
}

export default function ContactRequestsTab() {
  const [loading, setLoading] = useState(true);
  const [data, setData] = useState<any[]>([]);

  useEffect(() => {
    const creds = getCredentials();
    if (!creds) return;
    // Appel API...
  }, []);

  if (loading) return <div>Chargement...</div>;
  
  return (
    <div className="tab-content">
      {/* Contenu */}
    </div>
  );
}
```

---

## 14. Structure navigationTree.ts

DÃ©finition des univers dans `/src/components/Sidebar/navigationTree.ts` :

```typescript
interface Universe {
  id: string;           // "home", "public-cloud", "iam", etc.
  label: string;        // "HOME", "PUBLIC CLOUD", "IAM", etc.
  shortLabel?: string;  // Label court pour affichage compact
  sections: UniverseSection[];
}

interface UniverseSection {
  id: string;           // "home-account", "iam-identities", etc.
  label: string;        // "Compte", "IdentitÃ©s", etc.
  subsections?: NavNode[];  // Sous-sections (onglets NAV3)
}

interface NavNode {
  id: string;
  label: string;
  url?: string;         // URL pour liens externes
  external?: boolean;   // true = ouvre dans nouvel onglet
}
```

**Univers dÃ©finis :**
```typescript
export const universes: Universe[] = [
  { id: 'home', label: 'HOME', sections: [...] },           // A
  { id: 'public-cloud', label: 'PUBLIC CLOUD', sections: [...] },  // B
  { id: 'private-cloud', label: 'PRIVATE CLOUD', sections: [...] }, // C
  { id: 'bare-metal', label: 'BARE METAL', sections: [...] },      // D
  { id: 'web-cloud', label: 'WEB CLOUD', sections: [...] },        // E
  { id: 'network', label: 'NETWORK', sections: [...] },            // F
  { id: 'iam', label: 'IAM', sections: [...] },                    // G
];
```

---

## 15. Mapping Fichiers â†” Navigation

### 15.1 Univers HOME (A)

| Fichier | NAV2 | NAV3 (tabs) |
|---------|------|-------------|
| `pages/home/index.tsx` | Accueil | - |
| `pages/home/account/index.tsx` | Compte | info, edit, security, gdpr, advanced, contacts-services, contacts-requests, kyc |
| `pages/home/billing/index.tsx` | Facturation | services, invoices, refunds, payments, orders, references, methods, prepaid, vouchers, fidelity, contracts |
| `pages/home/support/index.tsx` | Support | tickets, create, level, communications, broadcast |
| `pages/home/carbon/index.tsx` | Carbone | - |
| `pages/home/api/index.tsx` | Playground | - |

#### Account tabs (8) - APIs
| Tab | Label | Endpoint |
|-----|-------|----------|
| info | Informations gÃ©nÃ©rales | GET /me |
| edit | Ã‰diter mon compte | PUT /me |
| security | SÃ©curitÃ© | /me/accessRestriction/* |
| gdpr | DonnÃ©es personnelles | /me/consent |
| advanced | ParamÃ¨tres avancÃ©s | /me |
| contacts-services | Mes services (contacts) | GET /services |
| contacts-requests | Mes demandes (contacts) | GET /me/task/contactChange |
| kyc | Documents KYC | GET /me/procedure/fraud |

#### Billing tabs (11) - APIs
| Tab | Label | Endpoint |
|-----|-------|----------|
| services | Mes services | GET /services |
| invoices | Factures | GET /me/bill |
| refunds | Avoirs | GET /me/refund |
| payments | Paiement | GET /me/deposit |
| orders | Commandes | GET /me/order |
| references | RÃ©fÃ©rences internes | GET/POST/PUT /me/billing/purchaseOrder |
| methods | Moyens de paiement | GET /me/payment/method |
| prepaid | Compte prÃ©payÃ© | GET /me/ovhAccount |
| vouchers | Bons d'achat | GET /me/voucherAccount |
| fidelity | Points fidÃ©litÃ© | GET /me/fidelityAccount |
| contracts | Contrats | GET /me/agreements |

#### Support tabs (5) - APIs
| Tab | Label | Endpoint |
|-----|-------|----------|
| tickets | Mes tickets | GET /support/tickets |
| create | CrÃ©er un ticket | POST /support/tickets |
| level | Niveau de support | GET /me/supportLevel |
| communications | Mes communications | GET /notification/history (v2) |
| broadcast | ParamÃ¨tres diffusion | GET/PUT /me/marketing, GET /notification/routing (v2) |

### 15.2 Univers IAM (G)

| Fichier | Section NAV2 |
|---------|--------------|
| `pages/iam/index.tsx` | IdentitÃ©s / Politiques / Groupes / Logs |

---

## 16. AccountSidebar (Menu utilisateur)

Accessible via l'avatar/NIC en haut Ã  droite :
```
+---------------------------+
|        [Avatar]           |
|           OK              |
|       [Standard]          |  <- Niveau support
|      Jean Dupont          |  <- Nom
|    [Administrateur]       |  <- RÃ´le IAM
|        Acme Corp          |  <- SociÃ©tÃ©
|                           |
|  jean.dupont@example.com  |  <- Email
|       ab12345-ovh         |  <- NIC handle
---------------------------+
+---------------------------+
|    Voir mes factures  >   |
|  Suivre mes paiements >   |
|    GÃ©rer mes services >   |
+---------------------------+
|     Documentation     >   |
|    Playground API     >   |
|   Ã‰tat des services   >   |
+---------------------------+
|        [Logout]           |
+---------------------------+
```

**Sections :**
- **Profil** : Avatar, niveau support, nom, rÃ´le, sociÃ©tÃ©, email, NIC
- **Raccourcis** : Liens rapides vers sections HOME (Factures, Paiements, Services)
- **Liens externes** : Documentation, API, Status
- **Session** : Logout
