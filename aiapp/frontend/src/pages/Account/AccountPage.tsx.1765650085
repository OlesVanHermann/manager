import { useState } from "react";
import type { OvhUser } from "../../types/auth.types";
import ProfileTile from "./ProfileTile";
import ShortcutsTile from "./ShortcutsTile";
import LastBillTile from "./LastBillTile";
import ProfileEditTab from "./ProfileEditTab";
import SecurityTab from "./SecurityTab";
import SupportLevelTab from "./SupportLevelTab";
import GdprTab from "./GdprTab";
import AdvancedTab from "./AdvancedTab";
import "./styles.css";

interface AccountPageProps {
  user: OvhUser | null;
  isActive?: boolean;
  onNavigate?: (section: string, options?: { tab?: string }) => void;
}

const tabs = [
  { id: "general", label: "Informations generales" },
  { id: "profile", label: "Editer mon profil" },
  { id: "security", label: "Securite" },
  { id: "support", label: "Mon niveau de support" },
  { id: "gdpr", label: "Donnees personnelles" },
  { id: "advanced", label: "Parametres avances" },
];

export default function AccountPage({ user, isActive, onNavigate }: AccountPageProps) {
  const [activeTab, setActiveTab] = useState("general");

  if (isActive === false) return null;

  const handleShortcutClick = (_shortcutId: string, section?: string, tab?: string) => {
    if (onNavigate && section) {
      onNavigate(section, { tab });
    }
  };

  const handleEditProfile = () => {
    setActiveTab("profile");
  };

  const handleViewBill = () => {
    if (onNavigate) {
      onNavigate("home-billing", { tab: "bills" });
    }
  };

  return (
    <div className="account-page">
      <div className="account-header">
        <div className="account-header-content">
          <h1>Mon compte</h1>
          <p className="account-subtitle">
            Administrez votre compte client. Dans cette rubrique, vous gerez la securite de votre compte, votre niveau de support et vos utilisateurs.
          </p>
        </div>
        <a href="https://help.ovhcloud.com" target="_blank" rel="noopener noreferrer" className="guides-link">
          Guides
        </a>
      </div>

      <div className="account-tabs">
        <div className="tabs-list">
          {tabs.map((tab) => (
            <button
              key={tab.id}
              className={"tab-btn" + (activeTab === tab.id ? " active" : "")}
              onClick={() => setActiveTab(tab.id)}
            >
              {tab.label}
            </button>
          ))}
        </div>
      </div>

      {activeTab === "general" && (
        <div className="account-tiles">
          <ProfileTile user={user} onEditProfile={handleEditProfile} />
          <ShortcutsTile onShortcutClick={handleShortcutClick} />
          <LastBillTile onViewBill={handleViewBill} />
        </div>
      )}

      {activeTab === "profile" && <ProfileEditTab user={user} />}
      {activeTab === "security" && <SecurityTab />}
      {activeTab === "support" && <SupportLevelTab />}
      {activeTab === "gdpr" && <GdprTab />}
      {activeTab === "advanced" && <AdvancedTab />}
    </div>
  );
}
