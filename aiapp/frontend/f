#!/bin/bash
# ============================================================
# SCRIPT DE CORRECTION - Fix namespaces i18n et styles.css
# Usage: cd /home/ubuntu/aiapp/frontend && bash /tmp/fix-namespaces.sh
# ============================================================

set -e

echo "============================================================"
echo "CORRECTION - Namespaces i18n et imports CSS"
echo "============================================================"
echo ""

# ============================================================
# CORRECTION 1: Namespace i18n - overthebox
# ============================================================
echo "üîß Correction overthebox..."

# GeneralTab
sed -i 's|useTranslation("web-cloud/overthebox/index")|useTranslation("web-cloud/access/overthebox/general")|g' \
  src/pages/web-cloud/access/overthebox/tabs/general/GeneralTab.tsx

# RemotesTab  
sed -i 's|useTranslation("web-cloud/overthebox/index")|useTranslation("web-cloud/access/overthebox/remotes")|g' \
  src/pages/web-cloud/access/overthebox/tabs/remotes/RemotesTab.tsx

# TasksTab
sed -i 's|useTranslation("web-cloud/overthebox/index")|useTranslation("web-cloud/access/overthebox/tasks")|g' \
  src/pages/web-cloud/access/overthebox/tabs/tasks/TasksTab.tsx

echo "  ‚úì overthebox corrig√©"

# ============================================================
# CORRECTION 2: Namespace i18n - pack-xdsl
# ============================================================
echo "üîß Correction pack-xdsl..."

# GeneralTab
sed -i 's|useTranslation("web-cloud/pack-xdsl/index")|useTranslation("web-cloud/access/pack-xdsl/general")|g' \
  src/pages/web-cloud/access/pack-xdsl/tabs/general/GeneralTab.tsx

# AccessTab
sed -i 's|useTranslation("web-cloud/pack-xdsl/index")|useTranslation("web-cloud/access/pack-xdsl/access")|g' \
  src/pages/web-cloud/access/pack-xdsl/tabs/access/AccessTab.tsx

# ServicesTab
sed -i 's|useTranslation("web-cloud/pack-xdsl/index")|useTranslation("web-cloud/access/pack-xdsl/services")|g' \
  src/pages/web-cloud/access/pack-xdsl/tabs/services/ServicesTab.tsx

# TasksTab
sed -i 's|useTranslation("web-cloud/pack-xdsl/index")|useTranslation("web-cloud/access/pack-xdsl/tasks")|g' \
  src/pages/web-cloud/access/pack-xdsl/tabs/tasks/TasksTab.tsx

# VoipTab
sed -i 's|useTranslation("web-cloud/pack-xdsl/index")|useTranslation("web-cloud/access/pack-xdsl/voip")|g' \
  src/pages/web-cloud/access/pack-xdsl/tabs/voip/VoipTab.tsx

echo "  ‚úì pack-xdsl corrig√©"

# ============================================================
# CORRECTION 3: Namespace i18n - carrier-sip
# ============================================================
echo "üîß Correction carrier-sip..."

# GeneralTab
sed -i 's|useTranslation("web-cloud/telecom/carrier-sip/index")|useTranslation("web-cloud/telecom/carrier-sip/general")|g' \
  src/pages/web-cloud/telecom/carrier-sip/tabs/general/GeneralTab.tsx

# EndpointsTab
sed -i 's|useTranslation("web-cloud/telecom/carrier-sip/index")|useTranslation("web-cloud/telecom/carrier-sip/endpoints")|g' \
  src/pages/web-cloud/telecom/carrier-sip/tabs/endpoints/EndpointsTab.tsx

# CdrTab
sed -i 's|useTranslation("web-cloud/telecom/carrier-sip/index")|useTranslation("web-cloud/telecom/carrier-sip/cdr")|g' \
  src/pages/web-cloud/telecom/carrier-sip/tabs/cdr/CdrTab.tsx

echo "  ‚úì carrier-sip corrig√©"

# ============================================================
# CORRECTION 4: Namespace i18n - sms
# ============================================================
echo "üîß Correction sms..."

# OutgoingTab
sed -i 's|useTranslation(.web-cloud/sms/index.)|useTranslation("web-cloud/telecom/sms/outgoing")|g' \
  src/pages/web-cloud/telecom/sms/tabs/outgoing/OutgoingTab.tsx 2>/dev/null || true

# IncomingTab
sed -i 's|useTranslation(.web-cloud/sms/index.)|useTranslation("web-cloud/telecom/sms/incoming")|g' \
  src/pages/web-cloud/telecom/sms/tabs/incoming/IncomingTab.tsx 2>/dev/null || true

# SendersTab
sed -i 's|useTranslation(.web-cloud/sms/index.)|useTranslation("web-cloud/telecom/sms/senders")|g' \
  src/pages/web-cloud/telecom/sms/tabs/senders/SendersTab.tsx 2>/dev/null || true

echo "  ‚úì sms corrig√©"

# ============================================================
# CORRECTION 5: Namespace i18n - voip
# ============================================================
echo "üîß Correction voip..."

# LinesTab
sed -i 's|useTranslation(.web-cloud/voip/index.)|useTranslation("web-cloud/telecom/voip/lines")|g' \
  src/pages/web-cloud/telecom/voip/tabs/lines/LinesTab.tsx 2>/dev/null || true

# NumbersTab
sed -i 's|useTranslation(.web-cloud/voip/index.)|useTranslation("web-cloud/telecom/voip/numbers")|g' \
  src/pages/web-cloud/telecom/voip/tabs/numbers/NumbersTab.tsx 2>/dev/null || true

# VoicemailsTab
sed -i 's|useTranslation(.web-cloud/voip/index.)|useTranslation("web-cloud/telecom/voip/voicemails")|g' \
  src/pages/web-cloud/telecom/voip/tabs/voicemails/VoicemailsTab.tsx 2>/dev/null || true

echo "  ‚úì voip corrig√©"

# ============================================================
# CORRECTION 6: Import styles.css ‚Üí index.css
# ============================================================
echo "üîß Correction import CSS..."

sed -i 's|import "./styles.css";|import "./index.css";|g' \
  src/pages/web-cloud/index.tsx

echo "  ‚úì import CSS corrig√©"

# ============================================================
# CORRECTION 7: Adapter les cl√©s t() pour nouveaux namespaces
# ============================================================
echo "üîß Adaptation des cl√©s t()..."

# overthebox - supprimer pr√©fixes "general.", "remotes.", "tasks."
sed -i 's|t("general\.|t("|g' src/pages/web-cloud/access/overthebox/tabs/general/GeneralTab.tsx
sed -i 's|t("remotes\.|t("|g' src/pages/web-cloud/access/overthebox/tabs/remotes/RemotesTab.tsx
sed -i 's|t("tasks\.|t("|g' src/pages/web-cloud/access/overthebox/tabs/tasks/TasksTab.tsx

# pack-xdsl - supprimer pr√©fixes
sed -i 's|t("general\.|t("|g' src/pages/web-cloud/access/pack-xdsl/tabs/general/GeneralTab.tsx
sed -i 's|t("access\.|t("|g' src/pages/web-cloud/access/pack-xdsl/tabs/access/AccessTab.tsx
sed -i 's|t("services\.|t("|g' src/pages/web-cloud/access/pack-xdsl/tabs/services/ServicesTab.tsx
sed -i 's|t("tasks\.|t("|g' src/pages/web-cloud/access/pack-xdsl/tabs/tasks/TasksTab.tsx
sed -i 's|t("voip\.|t("|g' src/pages/web-cloud/access/pack-xdsl/tabs/voip/VoipTab.tsx

# carrier-sip - supprimer pr√©fixes
sed -i 's|t("general\.|t("|g' src/pages/web-cloud/telecom/carrier-sip/tabs/general/GeneralTab.tsx
sed -i 's|t("endpoints\.|t("|g' src/pages/web-cloud/telecom/carrier-sip/tabs/endpoints/EndpointsTab.tsx
sed -i 's|t("cdr\.|t("|g' src/pages/web-cloud/telecom/carrier-sip/tabs/cdr/CdrTab.tsx

# sms - supprimer pr√©fixes
sed -i 's|t("outgoing\.|t("|g' src/pages/web-cloud/telecom/sms/tabs/outgoing/OutgoingTab.tsx 2>/dev/null || true
sed -i 's|t("incoming\.|t("|g' src/pages/web-cloud/telecom/sms/tabs/incoming/IncomingTab.tsx 2>/dev/null || true
sed -i 's|t("senders\.|t("|g' src/pages/web-cloud/telecom/sms/tabs/senders/SendersTab.tsx 2>/dev/null || true

# voip - supprimer pr√©fixes
sed -i 's|t("lines\.|t("|g' src/pages/web-cloud/telecom/voip/tabs/lines/LinesTab.tsx 2>/dev/null || true
sed -i 's|t("numbers\.|t("|g' src/pages/web-cloud/telecom/voip/tabs/numbers/NumbersTab.tsx 2>/dev/null || true
sed -i 's|t("voicemails\.|t("|g' src/pages/web-cloud/telecom/voip/tabs/voicemails/VoicemailsTab.tsx 2>/dev/null || true

echo "  ‚úì cl√©s t() adapt√©es"

# ============================================================
# V√âRIFICATIONS
# ============================================================
echo ""
echo "üîç V√©rifications..."

ERRORS=0

# Test namespace monolithique
result=$(grep -rn 'useTranslation.*index"' src/pages/web-cloud/*/tabs/ src/pages/web-cloud/*/*/tabs/ 2>/dev/null || true)
if [ -z "$result" ]; then
  echo "  ‚úÖ PASS - Namespaces i18n"
else
  echo "  ‚ùå FAIL - Namespaces monolithiques restants:"
  echo "$result"
  ERRORS=$((ERRORS+1))
fi

# Test import styles.css
result=$(grep -rn "import.*styles\.css" src/pages/web-cloud/ 2>/dev/null || true)
if [ -z "$result" ]; then
  echo "  ‚úÖ PASS - Import CSS"
else
  echo "  ‚ùå FAIL - Imports styles.css restants:"
  echo "$result"
  ERRORS=$((ERRORS+1))
fi

echo ""
echo "============================================================"
if [ $ERRORS -eq 0 ]; then
  echo "‚úÖ TOUTES LES CORRECTIONS APPLIQU√âES"
else
  echo "‚ö†Ô∏è  $ERRORS erreur(s) restante(s)"
fi
echo "============================================================"
