{"version":3,"file":"vps.service-B8AimrfM.js","sources":["../../src/services/vps.service.ts"],"sourcesContent":["// ============================================================\n// SERVICE VPS - Virtual Private Server OVHcloud\n// ============================================================\n\nimport { ovhApi } from './api.service';\n\n// ============================================================\n// TYPES\n// ============================================================\n\nexport interface Vps {\n  name: string;\n  displayName: string;\n  cluster: string;\n  model: { name: string; offer: string; version: string; disk: number; memory: number; vcore: number };\n  netbootMode: 'local' | 'rescue';\n  offerType: string;\n  slaMonitoring: boolean;\n  state: 'backuping' | 'installing' | 'maintenance' | 'rebooting' | 'rescued' | 'running' | 'stopped' | 'stopping' | 'upgrading';\n  vcore: number;\n  zone: string;\n  keymap: string | null;\n  memoryLimit: number;\n  monitoringIpBlocks: string[];\n}\n\nexport interface VpsServiceInfos {\n  serviceId: number;\n  creation: string;\n  expiration: string;\n  contactAdmin: string;\n  contactTech: string;\n  contactBilling: string;\n  status: string;\n  renew: { automatic: boolean; deleteAtExpiration: boolean; period: number | null };\n}\n\nexport interface VpsIp {\n  ipAddress: string;\n  gateway: string | null;\n  type: 'primary' | 'additional';\n  version: 'v4' | 'v6';\n  reverse: string | null;\n  macAddress: string | null;\n}\n\nexport interface VpsDisk {\n  id: number;\n  size: number;\n  state: 'connected' | 'disconnected' | 'pending';\n  type: 'additional' | 'primary';\n  bandwidthLimit: number;\n  fileSystem: string | null;\n  isReadOnly: boolean;\n  name: string | null;\n  monitored: boolean;\n}\n\nexport interface VpsSnapshot {\n  creationDate: string;\n  description: string;\n}\n\nexport interface VpsBackup {\n  id: number;\n  creationDate: string;\n  description: string | null;\n  state: 'created' | 'creating' | 'deleted' | 'deleting' | 'error' | 'restoring';\n}\n\nexport interface VpsTemplate {\n  id: number;\n  name: string;\n  distribution: string;\n  locale: string;\n  availableLanguage: string[];\n  bitFormat: number;\n}\n\nexport interface VpsTask {\n  id: number;\n  type: string;\n  state: 'blocked' | 'cancelled' | 'doing' | 'done' | 'error' | 'paused' | 'todo' | 'waitingAck';\n  progress: number;\n  startDate: string | null;\n  doneDate: string | null;\n}\n\nexport interface VpsMonitoring {\n  cpu: { timestamp: number; value: number }[];\n  mem: { timestamp: number; value: number }[];\n  netRx: { timestamp: number; value: number }[];\n  netTx: { timestamp: number; value: number }[];\n}\n\nexport interface VpsOption {\n  option: string;\n  state: 'released' | 'subscribed';\n}\n\n// ============================================================\n// SERVICE\n// ============================================================\n\nclass VpsService {\n  async listVps(): Promise<string[]> {\n    return ovhApi.get<string[]>('/vps');\n  }\n\n  async getVps(serviceName: string): Promise<Vps> {\n    return ovhApi.get<Vps>(`/vps/${serviceName}`);\n  }\n\n  async getServiceInfos(serviceName: string): Promise<VpsServiceInfos> {\n    return ovhApi.get<VpsServiceInfos>(`/vps/${serviceName}/serviceInfos`);\n  }\n\n  // ---------- IPs ----------\n  async listIps(serviceName: string): Promise<string[]> {\n    return ovhApi.get<string[]>(`/vps/${serviceName}/ips`);\n  }\n\n  async getIp(serviceName: string, ipAddress: string): Promise<VpsIp> {\n    return ovhApi.get<VpsIp>(`/vps/${serviceName}/ips/${ipAddress}`);\n  }\n\n  // ---------- Disks ----------\n  async listDisks(serviceName: string): Promise<number[]> {\n    return ovhApi.get<number[]>(`/vps/${serviceName}/disks`);\n  }\n\n  async getDisk(serviceName: string, id: number): Promise<VpsDisk> {\n    return ovhApi.get<VpsDisk>(`/vps/${serviceName}/disks/${id}`);\n  }\n\n  // ---------- Snapshot ----------\n  async getSnapshot(serviceName: string): Promise<VpsSnapshot | null> {\n    try {\n      return await ovhApi.get<VpsSnapshot>(`/vps/${serviceName}/snapshot`);\n    } catch { return null; }\n  }\n\n  async createSnapshot(serviceName: string, description?: string): Promise<void> {\n    return ovhApi.post<void>(`/vps/${serviceName}/createSnapshot`, { description });\n  }\n\n  async deleteSnapshot(serviceName: string): Promise<void> {\n    return ovhApi.delete<void>(`/vps/${serviceName}/snapshot`);\n  }\n\n  async restoreSnapshot(serviceName: string): Promise<void> {\n    return ovhApi.post<void>(`/vps/${serviceName}/snapshot/revert`, {});\n  }\n\n  // ---------- Automated Backup ----------\n  async listBackups(serviceName: string): Promise<string[]> {\n    return ovhApi.get<string[]>(`/vps/${serviceName}/automatedBackup/attachedBackup`);\n  }\n\n  async getBackupAccess(serviceName: string): Promise<{ additionalDisk: string | null; nfs: string | null }> {\n    return ovhApi.get(`/vps/${serviceName}/automatedBackup`);\n  }\n\n  // ---------- Templates ----------\n  async listTemplates(serviceName: string): Promise<number[]> {\n    return ovhApi.get<number[]>(`/vps/${serviceName}/templates`);\n  }\n\n  async getTemplate(serviceName: string, id: number): Promise<VpsTemplate> {\n    return ovhApi.get<VpsTemplate>(`/vps/${serviceName}/templates/${id}`);\n  }\n\n  // ---------- Actions ----------\n  async reboot(serviceName: string): Promise<VpsTask> {\n    return ovhApi.post<VpsTask>(`/vps/${serviceName}/reboot`, {});\n  }\n\n  async start(serviceName: string): Promise<VpsTask> {\n    return ovhApi.post<VpsTask>(`/vps/${serviceName}/start`, {});\n  }\n\n  async stop(serviceName: string): Promise<VpsTask> {\n    return ovhApi.post<VpsTask>(`/vps/${serviceName}/stop`, {});\n  }\n\n  async reinstall(serviceName: string, templateId: number): Promise<VpsTask> {\n    return ovhApi.post<VpsTask>(`/vps/${serviceName}/reinstall`, { templateId });\n  }\n\n  async setRescueMode(serviceName: string, rescue: boolean): Promise<VpsTask> {\n    return ovhApi.post<VpsTask>(`/vps/${serviceName}/setNetbootMode`, { netBootMode: rescue ? 'rescue' : 'local' });\n  }\n\n  // ---------- Monitoring ----------\n  async getMonitoring(serviceName: string, period: 'lastday' | 'lastmonth' | 'lastweek' | 'lastyear'): Promise<VpsMonitoring> {\n    return ovhApi.get<VpsMonitoring>(`/vps/${serviceName}/monitoring?period=${period}`);\n  }\n\n  // ---------- Tasks ----------\n  async listTasks(serviceName: string): Promise<number[]> {\n    return ovhApi.get<number[]>(`/vps/${serviceName}/tasks`);\n  }\n\n  async getTask(serviceName: string, id: number): Promise<VpsTask> {\n    return ovhApi.get<VpsTask>(`/vps/${serviceName}/tasks/${id}`);\n  }\n\n  // ---------- Options ----------\n  async listOptions(serviceName: string): Promise<string[]> {\n    return ovhApi.get<string[]>(`/vps/${serviceName}/option`);\n  }\n\n  async getOption(serviceName: string, option: string): Promise<VpsOption> {\n    return ovhApi.get<VpsOption>(`/vps/${serviceName}/option/${option}`);\n  }\n}\n\nexport const vpsService = new VpsService();\n"],"names":["VpsService","ovhApi","serviceName","ipAddress","id","description","templateId","rescue","period","option","vpsService"],"mappings":"8CAwGA,MAAMA,CAAW,CACf,MAAM,SAA6B,CACjC,OAAOC,EAAO,IAAc,MAAM,CACpC,CAEA,MAAM,OAAOC,EAAmC,CAC9C,OAAOD,EAAO,IAAS,QAAQC,CAAW,EAAE,CAC9C,CAEA,MAAM,gBAAgBA,EAA+C,CACnE,OAAOD,EAAO,IAAqB,QAAQC,CAAW,eAAe,CACvE,CAGA,MAAM,QAAQA,EAAwC,CACpD,OAAOD,EAAO,IAAc,QAAQC,CAAW,MAAM,CACvD,CAEA,MAAM,MAAMA,EAAqBC,EAAmC,CAClE,OAAOF,EAAO,IAAW,QAAQC,CAAW,QAAQC,CAAS,EAAE,CACjE,CAGA,MAAM,UAAUD,EAAwC,CACtD,OAAOD,EAAO,IAAc,QAAQC,CAAW,QAAQ,CACzD,CAEA,MAAM,QAAQA,EAAqBE,EAA8B,CAC/D,OAAOH,EAAO,IAAa,QAAQC,CAAW,UAAUE,CAAE,EAAE,CAC9D,CAGA,MAAM,YAAYF,EAAkD,CAClE,GAAI,CACF,OAAO,MAAMD,EAAO,IAAiB,QAAQC,CAAW,WAAW,CACrE,MAAQ,CAAE,OAAO,IAAM,CACzB,CAEA,MAAM,eAAeA,EAAqBG,EAAqC,CAC7E,OAAOJ,EAAO,KAAW,QAAQC,CAAW,kBAAmB,CAAE,YAAAG,EAAa,CAChF,CAEA,MAAM,eAAeH,EAAoC,CACvD,OAAOD,EAAO,OAAa,QAAQC,CAAW,WAAW,CAC3D,CAEA,MAAM,gBAAgBA,EAAoC,CACxD,OAAOD,EAAO,KAAW,QAAQC,CAAW,mBAAoB,EAAE,CACpE,CAGA,MAAM,YAAYA,EAAwC,CACxD,OAAOD,EAAO,IAAc,QAAQC,CAAW,iCAAiC,CAClF,CAEA,MAAM,gBAAgBA,EAAqF,CACzG,OAAOD,EAAO,IAAI,QAAQC,CAAW,kBAAkB,CACzD,CAGA,MAAM,cAAcA,EAAwC,CAC1D,OAAOD,EAAO,IAAc,QAAQC,CAAW,YAAY,CAC7D,CAEA,MAAM,YAAYA,EAAqBE,EAAkC,CACvE,OAAOH,EAAO,IAAiB,QAAQC,CAAW,cAAcE,CAAE,EAAE,CACtE,CAGA,MAAM,OAAOF,EAAuC,CAClD,OAAOD,EAAO,KAAc,QAAQC,CAAW,UAAW,EAAE,CAC9D,CAEA,MAAM,MAAMA,EAAuC,CACjD,OAAOD,EAAO,KAAc,QAAQC,CAAW,SAAU,EAAE,CAC7D,CAEA,MAAM,KAAKA,EAAuC,CAChD,OAAOD,EAAO,KAAc,QAAQC,CAAW,QAAS,EAAE,CAC5D,CAEA,MAAM,UAAUA,EAAqBI,EAAsC,CACzE,OAAOL,EAAO,KAAc,QAAQC,CAAW,aAAc,CAAE,WAAAI,EAAY,CAC7E,CAEA,MAAM,cAAcJ,EAAqBK,EAAmC,CAC1E,OAAON,EAAO,KAAc,QAAQC,CAAW,kBAAmB,CAAE,YAAaK,EAAS,SAAW,OAAA,CAAS,CAChH,CAGA,MAAM,cAAcL,EAAqBM,EAAmF,CAC1H,OAAOP,EAAO,IAAmB,QAAQC,CAAW,sBAAsBM,CAAM,EAAE,CACpF,CAGA,MAAM,UAAUN,EAAwC,CACtD,OAAOD,EAAO,IAAc,QAAQC,CAAW,QAAQ,CACzD,CAEA,MAAM,QAAQA,EAAqBE,EAA8B,CAC/D,OAAOH,EAAO,IAAa,QAAQC,CAAW,UAAUE,CAAE,EAAE,CAC9D,CAGA,MAAM,YAAYF,EAAwC,CACxD,OAAOD,EAAO,IAAc,QAAQC,CAAW,SAAS,CAC1D,CAEA,MAAM,UAAUA,EAAqBO,EAAoC,CACvE,OAAOR,EAAO,IAAe,QAAQC,CAAW,WAAWO,CAAM,EAAE,CACrE,CACF,CAEO,MAAMC,EAAa,IAAIV"}