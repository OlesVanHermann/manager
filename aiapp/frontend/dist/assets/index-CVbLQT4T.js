import{u as w,r as a,j as e}from"./index-svQWOpff.js";import{o as h}from"./api.service-CIh7kdHI.js";/* empty css               */class Z{async listZones(){return h.get("/domain/zone")}async getZone(s){return h.get(`/domain/zone/${s}`)}async getServiceInfos(s){return h.get(`/domain/zone/${s}/serviceInfos`)}async getSoa(s){return h.get(`/domain/zone/${s}/soa`)}async listRecords(s,t,i){let c=`/domain/zone/${s}/record`;const m=[];return t&&m.push(`fieldType=${t}`),i!==void 0&&m.push(`subDomain=${i}`),m.length&&(c+="?"+m.join("&")),h.get(c)}async getRecord(s,t){return h.get(`/domain/zone/${s}/record/${t}`)}async createRecord(s,t){return h.post(`/domain/zone/${s}/record`,t)}async updateRecord(s,t,i){return h.put(`/domain/zone/${s}/record/${t}`,i)}async deleteRecord(s,t){return h.delete(`/domain/zone/${s}/record/${t}`)}async refreshZone(s){return h.post(`/domain/zone/${s}/refresh`,{})}async resetZone(s,t=!1){return h.post(`/domain/zone/${s}/reset`,{minimized:t})}async listHistory(s){return h.get(`/domain/zone/${s}/history`)}async getHistory(s,t){return h.get(`/domain/zone/${s}/history/${t}`)}async restoreHistory(s,t){return h.post(`/domain/zone/${s}/history/${t}/restore`,{})}async listTasks(s,t){let i=`/domain/zone/${s}/task`;return t&&(i+=`?status=${t}`),h.get(i)}async getTask(s,t){return h.get(`/domain/zone/${s}/task/${t}`)}async exportZone(s){return h.get(`/domain/zone/${s}/export`)}async importZone(s,t){return h.post(`/domain/zone/${s}/import`,{zoneFile:t})}}const v=new Z,D=["A","AAAA","CNAME","MX","TXT","NS","SRV","CAA","DKIM","SPF","DMARC","PTR"];function E({zoneName:l}){const{t:s}=w("web-cloud/dns-zones/index"),{t}=w("common"),[i,c]=a.useState([]),[m,p]=a.useState(!0),[f,y]=a.useState(null),[o,x]=a.useState(""),[u,d]=a.useState(""),[j,C]=a.useState(!1),k=a.useCallback(async()=>{try{p(!0),y(null);const r=await v.listRecords(l,o||void 0),$=[];for(let n=0;n<r.length;n+=10){const S=r.slice(n,n+10),g=await Promise.all(S.map(L=>v.getRecord(l,L)));$.push(...g),c([...$])}}catch(r){y(String(r))}finally{p(!1)}},[l,o]);a.useEffect(()=>{k()},[k]);const T=async()=>{try{C(!0),await v.refreshZone(l),await k()}catch(r){y(String(r))}finally{C(!1)}},b=i.filter(r=>!u||r.subDomain.toLowerCase().includes(u.toLowerCase()));return m&&i.length===0?e.jsxs("div",{className:"tab-loading",children:[e.jsx("div",{className:"skeleton-block"}),e.jsx("div",{className:"skeleton-block"})]}):e.jsxs("div",{className:"records-tab",children:[e.jsxs("div",{className:"tab-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:s("records.title")}),e.jsx("p",{className:"tab-description",children:s("records.description")})]}),e.jsx("button",{className:"btn-primary",onClick:T,disabled:j,children:j?t("loading"):s("records.refresh")})]}),e.jsxs("div",{className:"filters-row",children:[e.jsxs("select",{value:o,onChange:r=>x(r.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:s("records.allTypes")}),D.map(r=>e.jsx("option",{value:r,children:r},r))]}),e.jsx("input",{type:"text",placeholder:s("records.filterSubdomain"),value:u,onChange:r=>d(r.target.value),className:"filter-input"}),e.jsxs("span",{className:"records-count",children:[b.length," ",s("records.count")]})]}),f&&e.jsx("div",{className:"error-banner",children:f}),b.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:s("records.empty")})}):e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("records.type")}),e.jsx("th",{children:s("records.subdomain")}),e.jsx("th",{children:s("records.target")}),e.jsx("th",{children:s("records.ttl")})]})}),e.jsx("tbody",{children:b.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:`record-type type-${r.fieldType.toLowerCase()}`,children:r.fieldType})}),e.jsx("td",{className:"font-mono",children:r.subDomain||"@"}),e.jsx("td",{className:"font-mono target-cell",children:r.target}),e.jsxs("td",{children:[r.ttl,"s"]})]},r.id))})]})]})}function M({zoneName:l}){const{t:s}=w("web-cloud/dns-zones/index"),{t}=w("common"),[i,c]=a.useState([]),[m,p]=a.useState(!0),[f,y]=a.useState(null),[o,x]=a.useState(null);a.useEffect(()=>{(async()=>{try{p(!0);const j=await v.listHistory(l);c(j)}catch(j){y(String(j))}finally{p(!1)}})()},[l]);const u=async d=>{if(confirm(s("history.confirmRestore")))try{x(d),await v.restoreHistory(l,d),alert(s("history.restored"))}catch(j){y(String(j))}finally{x(null)}};return m?e.jsx("div",{className:"tab-loading",children:e.jsx("div",{className:"skeleton-block"})}):f?e.jsx("div",{className:"error-state",children:f}):e.jsxs("div",{className:"history-tab",children:[e.jsxs("div",{className:"tab-header",children:[e.jsx("h3",{children:s("history.title")}),e.jsx("p",{className:"tab-description",children:s("history.description")})]}),i.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:s("history.empty")})}):e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("history.date")}),e.jsx("th",{children:s("history.actions")})]})}),e.jsx("tbody",{children:i.map(d=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(d).toLocaleString()}),e.jsx("td",{children:e.jsx("button",{className:"btn-small",onClick:()=>u(d),disabled:o===d,children:o===d?t("loading"):s("history.restore")})})]},d))})]}),e.jsxs("div",{className:"info-box",children:[e.jsx("h4",{children:s("history.info")}),e.jsx("p",{children:s("history.infoDesc")})]})]})}function P({zoneName:l}){const{t:s}=w("web-cloud/dns-zones/index"),[t,i]=a.useState([]),[c,m]=a.useState(!0),[p,f]=a.useState(null);a.useEffect(()=>{(async()=>{try{m(!0);const x=await v.listTasks(l),u=await Promise.all(x.slice(0,50).map(d=>v.getTask(l,d)));u.sort((d,j)=>new Date(j.createdAt).getTime()-new Date(d.createdAt).getTime()),i(u)}catch(x){f(String(x))}finally{m(!1)}})()},[l]);const y=o=>{const u={todo:{class:"warning",icon:"â³"},doing:{class:"info",icon:"ðŸ”„"},done:{class:"success",icon:"âœ“"},error:{class:"error",icon:"âœ—"},cancelled:{class:"inactive",icon:"âŠ˜"}}[o]||{class:"inactive",icon:"?"};return e.jsxs("span",{className:`badge ${u.class}`,children:[u.icon," ",o]})};return c?e.jsx("div",{className:"tab-loading",children:e.jsx("div",{className:"skeleton-block"})}):p?e.jsx("div",{className:"error-state",children:p}):e.jsxs("div",{className:"tasks-tab",children:[e.jsxs("div",{className:"tab-header",children:[e.jsx("h3",{children:s("tasks.title")}),e.jsx("p",{className:"tab-description",children:s("tasks.description")})]}),t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{children:s("tasks.empty")})]}):e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("tasks.function")}),e.jsx("th",{children:s("tasks.status")}),e.jsx("th",{children:s("tasks.created")}),e.jsx("th",{children:s("tasks.done")})]})}),e.jsx("tbody",{children:t.map(o=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-mono",children:o.function}),e.jsx("td",{children:y(o.status)}),e.jsx("td",{children:new Date(o.createdAt).toLocaleString()}),e.jsx("td",{children:o.doneAt?new Date(o.doneAt).toLocaleString():"-"})]},o.id))})]})]})}function F(){var $;const{t:l}=w("web-cloud/dns-zones/index"),{t:s}=w("common"),[t,i]=a.useState([]),[c,m]=a.useState(null),[p,f]=a.useState("records"),[y,o]=a.useState(!0),[x,u]=a.useState(null),[d,j]=a.useState(""),C=[{id:"records",labelKey:"tabs.records"},{id:"history",labelKey:"tabs.history"},{id:"tasks",labelKey:"tabs.tasks"}],k=a.useCallback(async()=>{try{o(!0),u(null);const n=await v.listZones(),S=n.map(g=>({name:g,loading:!0}));i(S),n.length>0&&!c&&m(n[0]);for(let g=0;g<n.length;g+=5){const L=n.slice(g,g+5);await Promise.all(L.map(async R=>{try{const z=await v.getZone(R);i(A=>A.map(N=>N.name===R?{...N,details:z,loading:!1}:N))}catch(z){i(A=>A.map(N=>N.name===R?{...N,loading:!1,error:String(z)}:N))}}))}}catch(n){u(String(n))}finally{o(!1)}},[c]);a.useEffect(()=>{k()},[]);const T=t.filter(n=>n.name.toLowerCase().includes(d.toLowerCase())),b=t.find(n=>n.name===c),r=()=>{if(!c)return null;switch(p){case"records":return e.jsx(E,{zoneName:c});case"history":return e.jsx(M,{zoneName:c});case"tasks":return e.jsx(P,{zoneName:c});default:return null}};return e.jsxs("div",{className:"dns-zones-page",children:[e.jsxs("aside",{className:"zones-sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h2",{children:l("title")}),e.jsx("span",{className:"zone-count",children:t.length})]}),e.jsx("div",{className:"sidebar-search",children:e.jsx("input",{type:"text",placeholder:l("searchPlaceholder"),value:d,onChange:n=>j(n.target.value)})}),e.jsx("div",{className:"zones-list",children:y&&t.length===0?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"skeleton-item"}),e.jsx("div",{className:"skeleton-item"})]}):x?e.jsx("div",{className:"error-state",children:x}):T.length===0?e.jsx("div",{className:"empty-state",children:s("empty.title")}):T.map(n=>{var S,g;return e.jsxs("button",{className:`zone-item ${c===n.name?"active":""}`,onClick:()=>m(n.name),children:[e.jsx("div",{className:"zone-icon",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 14.25h13.5m-13.5 0a3 3 0 01-3-3m3 3a3 3 0 100 6h13.5a3 3 0 100-6m-16.5-3a3 3 0 013-3h13.5a3 3 0 013 3m-19.5 0a4.5 4.5 0 01.9-2.7L5.737 5.1a3.375 3.375 0 012.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 01.9 2.7"})})}),e.jsxs("div",{className:"zone-info",children:[e.jsx("span",{className:"zone-name",children:n.name}),n.details&&e.jsxs("span",{className:"zone-ns",children:[((S=n.details.nameServers)==null?void 0:S.length)||0," NS"]})]}),((g=n.details)==null?void 0:g.hasDnsAnycast)&&e.jsx("span",{className:"anycast-badge",children:"Anycast"})]},n.name)})})]}),e.jsx("main",{className:"zones-main",children:c&&b?e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:c}),b.details&&e.jsx("p",{className:"page-description",children:(($=b.details.nameServers)==null?void 0:$.join(", "))||"N/A"})]}),e.jsxs("button",{className:"btn-refresh",onClick:k,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})}),s("actions.refresh")]})]}),e.jsx("div",{className:"tabs-container",children:e.jsx("div",{className:"tabs-list",children:C.map(n=>e.jsx("button",{className:`tab-btn ${p===n.id?"active":""}`,onClick:()=>f(n.id),children:l(n.labelKey)},n.id))})}),e.jsx("div",{className:"tab-content",children:r()})]}):e.jsxs("div",{className:"no-selection",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 14.25h13.5"})}),e.jsx("p",{children:l("selectZone")})]})})]})}export{F as default};
//# sourceMappingURL=index-CVbLQT4T.js.map
