# PROMPT SPLIT - Défactorisation Totale (JS + CSS) → Services et Styles Isolés par NAV3

## A) Contexte

Tu es un expert en refactoring React/TypeScript pour le projet New Manager OVHcloud.

**Architecture de navigation :**
- **NAV1** : Catégorie principale (ex: general, web-cloud, bare-metal, network...)
- **NAV2** : Sous-catégorie / Produit (ex: general, hosting, private-database, vps...)
- **NAV3** : Onglets fonctionnels (ex: general, ftp, ssl, cdn...)

**Convention : le 1er élément de chaque niveau s'appelle `general`**

**Objectif :** DÉFACTORISER un module monolithique (services API + CSS) en modules ISOLÉS, un par NAV3.

---

## B) Arborescence Cible

### Code (src/)

**Convention :**
```
src/pages/{NAV1}/{NAV2}/
├── {nav2}.types.ts
├── index.tsx
└── tabs/
    └── {nav3}/
        ├── {Nav3}Tab.service.ts
        ├── {Nav3}Tab.tsx
        └── {Nav3}Tab.css
```

**Exemple :**
```
src/pages/
├── general/                              ← NAV1: general
│   ├── general/                          ← NAV2: general (dashboard global)
│   │   ├── general.types.ts
│   │   ├── index.tsx
│   │   └── tabs/
│   │       ├── general/                  ← NAV3: general
│   │       │   ├── GeneralTab.service.ts
│   │       │   ├── GeneralTab.tsx
│   │       │   └── GeneralTab.css
│   │       ├── notifications/            ← NAV3: notifications
│   │       │   ├── NotificationsTab.service.ts
│   │       │   ├── NotificationsTab.tsx
│   │       │   └── NotificationsTab.css
│   │       └── welcome/                  ← NAV3: welcome
│   │           ├── WelcomeTab.service.ts
│   │           ├── WelcomeTab.tsx
│   │           └── WelcomeTab.css
│   └── settings/                         ← NAV2: settings
│       ├── settings.types.ts
│       ├── index.tsx
│       └── tabs/
│           ├── general/                  ← NAV3: general
│           │   ├── GeneralTab.service.ts
│           │   ├── GeneralTab.tsx
│           │   └── GeneralTab.css
│           └── preferences/              ← NAV3: preferences
│               ├── PreferencesTab.service.ts
│               ├── PreferencesTab.tsx
│               └── PreferencesTab.css
├── web-cloud/                            ← NAV1: web-cloud
│   ├── general/                          ← NAV2: general (dashboard web-cloud)
│   │   ├── general.types.ts
│   │   ├── index.tsx
│   │   └── tabs/
│   │       └── general/
│   │           ├── GeneralTab.service.ts
│   │           ├── GeneralTab.tsx
│   │           └── GeneralTab.css
│   └── hosting/                          ← NAV2: hosting
│       ├── hosting.types.ts
│       ├── index.tsx
│       └── tabs/
│           ├── general/                  ← NAV3: general
│           │   ├── GeneralTab.ts
│           │   ├── GeneralTab.tsx
│           │   └── GeneralTab.css
│           ├── ftp/                      ← NAV3: ftp
│           │   ├── FtpTab.service.ts
│           │   ├── FtpTab.tsx
│           │   └── FtpTab.css
│           └── ssl/                      ← NAV3: ssl
│               ├── SslTab.service.ts
│               ├── SslTab.tsx
│               └── SslTab.css
```

### Traductions (public/locales/)

**Convention :**
```
public/locales/{lang}/{NAV1}/{NAV2}/
└── {nav3}.json
```

**Exemple :**
```
public/locales/
├── fr/
│   ├── general/                          ← NAV1: general
│   │   ├── general/                      ← NAV2: general
│   │   │   ├── general.json              ← NAV3: general
│   │   │   ├── notifications.json        ← NAV3: notifications
│   │   │   └── welcome.json              ← NAV3: welcome
│   │   └── settings/                     ← NAV2: settings
│   │       ├── general.json              ← NAV3: general
│   │       └── preferences.json          ← NAV3: preferences
│   └── web-cloud/                        ← NAV1: web-cloud
│       ├── general/                      ← NAV2: general
│       │   └── general.json
│       └── hosting/                      ← NAV2: hosting
│           ├── general.json              ← NAV3: general
│           ├── ftp.json                  ← NAV3: ftp
│           └── ssl.json                  ← NAV3: ssl
└── en/
    ├── general/
    │   ├── general/
    │   │   ├── general.json
    │   │   ├── notifications.json
    │   │   └── welcome.json
    │   └── settings/
    │       ├── general.json
    │       └── preferences.json
    └── web-cloud/
        ├── general/
        │   └── general.json
        └── hosting/
            ├── general.json
            ├── ftp.json
            └── ssl.json
```

### Résumé

| Niveau | 1er élément | Fichiers code | Fichier trad |
|--------|-------------|---------------|--------------|
| **NAV1** | `general` | `src/pages/general/` | `public/locales/{lang}/general/` |
| **NAV2** | `general` | `{nav2}.types.ts` + `index.tsx` | — |
| **NAV3** | `general` | `{Nav3}Tab.service.ts` + `.tsx` + `.css` | `{nav3}.json` |

---

## C) Principe de DÉFACTORISATION (STRICT)

### Définition

**DÉFACTORISATION** = L'inverse de la factorisation/mutualisation.
Au lieu de partager le code commun, on le **DUPLIQUE VOLONTAIREMENT** pour garantir l'**INDÉPENDANCE TOTALE**.

> "Chaque tab est une île. Aucun pont entre les îles. Ni en JS, ni en CSS."

### Pourquoi défactoriser ?

| Factorisation (AVANT)                | Défactorisation (APRÈS)              |
|--------------------------------------|--------------------------------------|
| 1 service partagé = 1 point de casse | N services isolés = 0 régression     |
| 1 CSS partagé = styles qui cassent   | N CSS isolés = styles indépendants   |
| Modifier FTP casse SSL               | Modifier FTP n'impacte QUE FTP       |
| Couplage fort entre tabs             | Couplage ZÉRO entre tabs             |
| "DRY" mal appliqué                   | "WET" assumé (Write Everything Twice)|
| Refacto globale risquée              | Refacto locale safe                  |

### Règle d'or

```
SI deux tabs ont besoin de la même fonction/style/helper :
   → DUPLIQUER le code dans CHAQUE tab
   → NE JAMAIS créer un fichier partagé
```

---

## D) INTERDITS ABSOLUS - JAVASCRIPT/TYPESCRIPT ❌

### ❌ INTERDIT JS-1 : Import croisé entre tabs

```typescript
// ❌ INTERDIT - FtpTab.tsx ne doit JAMAIS faire :
import { sslService } from "../ssl/SslTab";
import { quelqueChose } from "../general/GeneralTab";
import { formatDomain } from "../multisite/MultisiteTab";
```

### ❌ INTERDIT JS-2 : Service partagé dans /services/

```typescript
// ❌ INTERDIT - Plus JAMAIS de service mutualisé :
import { hostingService } from "../../../../../../services/web-cloud.hosting";
import { databaseService } from "../../../../../../services/web-cloud.private-database";
```

### ❌ INTERDIT JS-3 : Helper/utils partagé au niveau NAV2

```typescript
// ❌ INTERDIT - Pas de fichier utils/helpers commun :
import { formatDate } from "../../hosting.utils";
import { validateDomain } from "../../hosting.helpers";
import { useHostingData } from "../../hooks/useHostingData";
```

### ❌ INTERDIT JS-4 : Composant partagé interne au NAV2

```typescript
// ❌ INTERDIT - Pas de composants mutualisés entre tabs :
import { HostingCard } from "../../components/HostingCard";
import { DomainSelector } from "../../shared/DomainSelector";
```

### ❌ INTERDIT JS-5 : Ré-export ou barrel file au niveau NAV2

```typescript
// ❌ INTERDIT - Pas de index.ts qui ré-exporte :
// hosting/index.ts
export * from "./tabs/ftp/FtpTab";
export * from "./tabs/ssl/SslTab";
```

### ❌ INTERDIT JS-6 : Context/Provider partagé entre tabs

```typescript
// ❌ INTERDIT - Pas de context commun :
import { useHostingContext } from "../../HostingContext";
import { HostingProvider } from "../../HostingProvider";
```

---

## E) INTERDITS ABSOLUS - CSS/STYLES ❌

### ❌ INTERDIT CSS-1 : Fichier CSS partagé au niveau NAV2

```typescript
// ❌ INTERDIT - Pas de CSS commun entre tabs :
import "../../hosting.css";
import "../../hosting.scss";
import styles from "../../hosting.module.css";
```

### ❌ INTERDIT CSS-2 : Import CSS croisé entre tabs

```typescript
// ❌ INTERDIT - FtpTab ne doit JAMAIS importer le CSS d'un autre tab :
import "../ssl/SslTab.css";
import styles from "../general/GeneralTab.module.css";
```

### ❌ INTERDIT CSS-3 : Classes CSS globales au niveau NAV2

```css
/* ❌ INTERDIT - Pas de classes génériques sans préfixe tab */
.hosting-card { }
.hosting-table { }
.hosting-modal { }
```

### ❌ INTERDIT CSS-4 : Variables CSS partagées au niveau NAV2

```css
/* ❌ INTERDIT - Pas de variables CSS communes entre tabs */
/* hosting-variables.css */
:root {
  --hosting-primary: #0050d7;
  --hosting-spacing: 16px;
}
```

### ❌ INTERDIT CSS-5 : Styled-components/Emotion partagés

```typescript
// ❌ INTERDIT - Pas de composants styled partagés :
import { HostingContainer, HostingButton } from "../../hosting.styled";
import { StyledCard } from "../../components/StyledCard";
```

### ❌ INTERDIT CSS-6 : Mixins/Functions SCSS partagés au niveau NAV2

```scss
// ❌ INTERDIT - Pas de mixins communs :
@import "../../hosting.mixins";
@import "../../hosting.functions";
```

---

## F) AUTORISÉS ✅

### ✅ AUTORISÉ 1 : Types partagés au niveau NAV2 (SEULE exception JS)

```typescript
// ✅ OK - Un seul fichier types partagé
import type { HostingInfo, FtpUser, SslCertificate } from "../../hosting.types";
```

**Pourquoi ?** Les types sont des contrats d'API, pas du code exécutable.

### ✅ AUTORISÉ 2 : Services API globaux (/services/api.ts)

```typescript
// ✅ OK - Fonctions API bas niveau
import { ovhGet, ovhPost, ovhPut, ovhDelete } from "../../../../../../services/api";
```

### ✅ AUTORISÉ 3 : Composants design system global (/components/)

```typescript
// ✅ OK - Composants UI génériques
import { Button, Modal, Table, Alert } from "../../../../../../components/ui";
import { DataGrid } from "../../../../../../components/DataGrid";
```

### ✅ AUTORISÉ 4 : CSS design system global (/styles/)

```typescript
// ✅ OK - Styles globaux de l'application
import "../../../../../../styles/global.css";
import "../../../../../../styles/variables.css";
```

```css
/* ✅ OK - Utiliser les variables CSS globales */
.ftp-card {
  color: var(--ods-color-primary);
  padding: var(--ods-spacing-md);
}
```

### ✅ AUTORISÉ 5 : Hooks globaux (/hooks/)

```typescript
// ✅ OK - Hooks génériques
import { useApi } from "../../../../../../hooks/useApi";
import { useToast } from "../../../../../../hooks/useToast";
```

### ✅ AUTORISÉ 6 : Duplication JS ASSUMÉE

```typescript
// ✅ OK - Si FTP et SSL ont besoin de formatDate(), CHAQUE tab a SA copie :

// tabs/ftp/FtpTab.ts
const formatDate = (d: string) => new Date(d).toLocaleDateString("fr-FR");

// tabs/ssl/SslTab.ts  
const formatDate = (d: string) => new Date(d).toLocaleDateString("fr-FR");
```

### ✅ AUTORISÉ 7 : Duplication CSS ASSUMÉE

```css
/* ✅ OK - Si FTP et SSL ont besoin du même style, CHAQUE tab a SA copie */

/* tabs/ftp/FtpTab.css */
.ftp-status-badge {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
}

/* tabs/ssl/SslTab.css */
.ssl-status-badge {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
}
```

---

## G) Structure CSS par Tab

### Convention de fichiers

```
pages/{nav1}/{nav2}/
  {nav2}.types.ts                    ← Types partagés (SEUL partage)
  tabs/
    {tab}/
      {Tab}Tab.ts                    ← Service isolé
      {Tab}Tab.tsx                   ← Composant
      {Tab}Tab.css                   ← Styles isolés (ou .module.css)
      {Tab}Tab.types.ts              ← Types locaux si nécessaire
      modals/
        {Modal}Modal.tsx
        {Modal}Modal.css             ← Styles modale isolés
```

### Convention de nommage CSS

**Préfixe OBLIGATOIRE par tab pour éviter les collisions :**

| Tab      | Préfixe CSS     | Exemple                        |
|----------|-----------------|--------------------------------|
| general  | `.general-`     | `.general-card`, `.general-info` |
| ftp      | `.ftp-`         | `.ftp-user-row`, `.ftp-quota`    |
| ssl      | `.ssl-`         | `.ssl-certificate`, `.ssl-badge` |
| cdn      | `.cdn-`         | `.cdn-status`, `.cdn-domain`     |
| multisite| `.multisite-`   | `.multisite-table`, `.multisite-row` |

---

## H) Indépendance entre niveaux

| Niveau | Indépendance entre 2 éléments | Partage autorisé |
|--------|-------------------------------|------------------|
| **NAV1 ↔ NAV1** | ✅ **TOTALE** | Rien (sauf globaux `/services/api.ts`, `/components/ui`, `/hooks/`) |
| **NAV2 ↔ NAV2** | ✅ **TOTALE** | Rien (sauf globaux) |
| **NAV3 ↔ NAV3** | ✅ **TOTALE** | **UNIQUEMENT `{nav2}.types.ts`** (types = contrats API, pas de code exécutable) |

---

## I) Workflow de Défactorisation

### PHASE 1 : ANALYSE

```bash
# 1. Lister les méthodes du service monolithique
grep -n "export.*function\|export.*const.*=" services/{nav1}.{nav2}.ts

# 2. Lister les types
grep -n "export.*type\|export.*interface" services/{nav1}.{nav2}.ts

# 3. Lister les classes CSS utilisées
grep -roh 'className="[^"]*"' src/pages/{nav1}/{nav2}/tabs/ | sort | uniq -c | sort -rn

# 4. Identifier les imports croisés existants
grep -rn "from.*tabs/" src/pages/{nav1}/{nav2}/tabs/
```

### PHASE 2 : CRÉATION TYPES

```bash
# Créer le fichier types partagé au niveau NAV2
tee src/pages/{nav1}/{nav2}/{nav2}.types.ts > /dev/null <<'FILEEND'
// Types partagés pour {nav2}
// SEUL fichier partagé entre les tabs

export interface {Nav2}Info {
  // ...
}

export interface {Tab1}Data {
  // ...
}

export interface {Tab2}Data {
  // ...
}
FILEEND
```

### PHASE 3 : CRÉATION SERVICES PAR TAB

```bash
# Pour chaque tab, créer son service isolé
tee src/pages/{nav1}/{nav2}/tabs/{tab}/{Tab}Tab.ts > /dev/null <<'FILEEND'
import { ovhGet, ovhPost, ovhPut, ovhDelete } from "../../../../../../services/api";
import type { {Tab}Data } from "../../{nav2}.types";

// ========================================
// SERVICE {TAB} - ISOLÉ
// ========================================

// Helpers locaux (dupliqués si nécessaire)
const formatDate = (d: string) => new Date(d).toLocaleDateString("fr-FR");

// API calls
export const {tab}Service = {
  getAll: (serviceName: string): Promise<{Tab}Data[]> =>
    ovhGet(`/hosting/web/${serviceName}/{tab}`),
    
  get: (serviceName: string, id: string): Promise<{Tab}Data> =>
    ovhGet(`/hosting/web/${serviceName}/{tab}/${id}`),
    
  create: (serviceName: string, data: Partial<{Tab}Data>): Promise<void> =>
    ovhPost(`/hosting/web/${serviceName}/{tab}`, data),
    
  update: (serviceName: string, id: string, data: Partial<{Tab}Data>): Promise<void> =>
    ovhPut(`/hosting/web/${serviceName}/{tab}/${id}`, data),
    
  delete: (serviceName: string, id: string): Promise<void> =>
    ovhDelete(`/hosting/web/${serviceName}/{tab}/${id}`),
};
FILEEND
```

### PHASE 4 : CRÉATION CSS PAR TAB

```bash
# Pour chaque tab, créer son CSS isolé
tee src/pages/{nav1}/{nav2}/tabs/{tab}/{Tab}Tab.css > /dev/null <<'FILEEND'
/* ========================================
   STYLES {TAB} - ISOLÉS
   Préfixe OBLIGATOIRE : .{tab}-
   ======================================== */

.{tab}-container {
  padding: var(--ods-spacing-md);
}

.{tab}-card {
  background: var(--ods-color-surface);
  border-radius: var(--ods-radius-md);
  padding: var(--ods-spacing-md);
}

.{tab}-table {
  width: 100%;
}

.{tab}-status-badge {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
}

.{tab}-actions {
  display: flex;
  gap: var(--ods-spacing-sm);
}
FILEEND
```

### PHASE 5 : MODIFICATION COMPOSANTS

```bash
# Modifier chaque {Tab}Tab.tsx pour utiliser les imports locaux
# AVANT:
import { hostingService } from "../../../../../../services/web-cloud.hosting";
import "../../hosting.css";

# APRÈS:
import { {tab}Service } from "./{Tab}Tab.service";
import "./{Tab}Tab.css";
```

### PHASE 6 : VÉRIFICATION

```bash
# ===== TESTS D'ISOLATION JS (DOIVENT RETOURNER 0 RÉSULTAT) =====

echo "=== Test JS-1: imports croisés entre tabs ==="
grep -rn "from.*\.\.\/.*Tab" src/pages/{nav1}/{nav2}/tabs/

echo "=== Test JS-2: ancien service monolithique ==="
grep -rn "from.*services/{nav1}\.{nav2}" src/pages/{nav1}/{nav2}/tabs/

echo "=== Test JS-3: utils/helpers partagés ==="
grep -rn "from.*{nav2}\.utils\|from.*{nav2}\.helpers" src/pages/{nav1}/{nav2}/tabs/

# ===== TESTS D'ISOLATION CSS (DOIVENT RETOURNER 0 RÉSULTAT) =====

echo "=== Test CSS-1: CSS partagé NAV2 ==="
grep -rn "import.*{nav2}\.css\|import.*{nav2}\.scss" src/pages/{nav1}/{nav2}/tabs/

echo "=== Test CSS-2: import CSS croisé entre tabs ==="
grep -rn "import.*\.\.\/.*\.css" src/pages/{nav1}/{nav2}/tabs/

echo "=== Test CSS-3: classes sans préfixe tab ==="
# Chercher className="xxx" où xxx ne commence pas par le nom du tab
for tab in general ftp ssl cdn multisite database; do
  grep -rn "className=\"[^${tab}]" src/pages/{nav1}/{nav2}/tabs/$tab/ 2>/dev/null | grep -v "className=\"$tab-"
done

# ===== SI TOUS LES TESTS PASSENT =====
cd /home/ubuntu/aiapp/frontend && npm run build:dev
```

### PHASE 7 : NETTOYAGE

```bash
# Backup puis suppression des fichiers monolithiques
mv --backup=numbered services/{nav1}.{nav2}.ts /home/ubuntu/action-target/tmp/

# Si CSS monolithique existe
if [ -f styles/{nav2}.css ]; then
  mv --backup=numbered styles/{nav2}.css /home/ubuntu/action-target/tmp/
fi

# Vérifier build
npm run build:dev
```

---

## J) Actions Principales

### → "regenerer" (cp+tee)

TOUJOURS utiliser le bloc de code Markdown.
Fournir dans UNE SEULE fenêtre de code par script.
La dernière version du script, TOUT le script en une fois.
JAMAIS de "... comme avant" ou "// reste inchangé".

**Format :**
```bash
cp --backup=numbered /chemin/fichier /home/ubuntu/action-target/tmp/ 2>/dev/null || true
tee /chemin/fichier > /dev/null <<'FILEEND'
// Le code ENTIER ici
// Avec TOUS les commentaires
// JAMAIS de "..." ou de raccourcis
FILEEND
```

**Rappels anti-casse cp+tee :**
- Délimiteur final DOIT être en début de ligne, sans espace
- Pas de guillemets "intelligents" — garder `'FILEEND'` avec apostrophes simples
- Pas d'indentation avant `tee … <<'FILEEND'` ni avant `FILEEND`
- **DÉLIMITEURS UNIQUES** : utiliser `FILEEND`, `SCRIPTEND`, `CODEEND` (jamais `FS` ou `EOF`)

### → "patcher" (super-patch)

TOUJOURS utiliser bloc de code Markdown.
Fournir le patch dans UNE SEULE fenêtre de code.

**Format :**
```bash
super-patch <<'PATCHEND'
--- /chemin/fichier.tsx
+++ /chemin/fichier.tsx
@@
 ligne contexte avant
-ancienne ligne
+nouvelle ligne
 ligne contexte après
PATCHEND
```

**Rappels anti-casse super-patch :**
- Délimiteur final en colonne 0, sans espace
- TOUJOURS une ligne de contexte (sans `-/+`) AVANT et APRÈS `@@`
- Utiliser des chemins absolus

---

## K) Conventions de Nommage

### Fichiers

| Élément          | Convention            | Exemple                      |
|------------------|-----------------------|------------------------------|
| Service          | `{tab}Service`        | `ftpService`, `sslService`   |
| Fichier service  | `{Tab}Tab.service.ts` | `FtpTab.service.ts`, `SslTab.service.ts` |
| Fichier types    | `{nav2}.types.ts`     | `hosting.types.ts`           |
| Composant        | `{Tab}Tab.tsx`        | `FtpTab.tsx`, `SslTab.tsx`   |
| Styles           | `{Tab}Tab.css`        | `FtpTab.css`, `SslTab.css`   |
| Traductions      | `{nav3}.json`         | `ftp.json`, `ssl.json`       |

### Classes CSS

| Tab       | Préfixe       | Exemples                              |
|-----------|---------------|---------------------------------------|
| general   | `.general-`   | `.general-card`, `.general-header`    |
| ftp       | `.ftp-`       | `.ftp-user`, `.ftp-quota`             |
| ssl       | `.ssl-`       | `.ssl-cert`, `.ssl-status`            |
| cdn       | `.cdn-`       | `.cdn-domain`, `.cdn-flush`           |
| multisite | `.multisite-` | `.multisite-table`, `.multisite-row`  |
| database  | `.database-`  | `.database-card`, `.database-info`    |

### Imports (depuis tabs/{tab}/)

```typescript
// Service API global
import { ovhGet, ovhPost } from "../../../../../../services/api";

// Types NAV2
import type { HostingInfo } from "../../hosting.types";

// Service local
import { ftpService } from "./FtpTab.service";

// CSS local
import "./FtpTab.css";
```

---

## L) Checklist Finale

### Avant de commencer
- [ ] Archive tar uploadée
- [ ] Service monolithique JS identifié
- [ ] CSS monolithique identifié (si existant)
- [ ] Liste des tabs à défactoriser

### Analyse
- [ ] Matrice tab→méthodes→types créée
- [ ] Matrice tab→classes CSS créée
- [ ] Imports croisés existants identifiés

### Création JS
- [ ] `{nav2}.types.ts` créé avec TOUS les types
- [ ] `{Tab}Tab.ts` créé pour CHAQUE tab (service isolé)
- [ ] Helpers dupliqués dans chaque service

### Création CSS
- [ ] `{Tab}Tab.css` créé pour CHAQUE tab
- [ ] Toutes les classes préfixées `.{tab}-`
- [ ] Styles dupliqués si nécessaire

### Création Traductions
- [ ] `public/locales/fr/{nav1}/{nav2}/{nav3}.json` créé pour CHAQUE tab
- [ ] `public/locales/en/{nav1}/{nav2}/{nav3}.json` créé pour CHAQUE tab

### Modification
- [ ] Tous les `.tsx` modifiés (imports JS)
- [ ] Tous les `.tsx` modifiés (imports CSS)
- [ ] Toutes les className renommées avec préfixe

### Validation JS
- [ ] Test imports croisés → 0 résultat
- [ ] Test ancien service → 0 résultat
- [ ] Test utils partagés → 0 résultat

### Validation CSS
- [ ] Test CSS partagé → 0 résultat
- [ ] Test CSS croisé → 0 résultat
- [ ] Test classes sans préfixe → 0 résultat

### Finalisation
- [ ] Build réussi (`npm run build:dev`)
- [ ] Ancien service JS backupé + supprimé
- [ ] Ancien CSS partagé backupé + supprimé
- [ ] Test fonctionnel sur https://manager.di2amp.com/dev/

---

## M) Commandes Utiles

```bash
# Lister tous les fichiers d'un module (via index pré-généré)
grep "{nav1}/{nav2}" /home/ubuntu/new_manager_files.txt | grep -E "\.(ts|tsx|css)$" | sort

# Compter les imports JS par source
grep -rh "from.*service" src/pages/{nav1}/{nav2} | sort | uniq -c | sort -rn

# Compter les imports CSS
grep -rh "import.*\.css" src/pages/{nav1}/{nav2} | sort | uniq -c | sort -rn

# Lister toutes les classes CSS utilisées
grep -roh 'className="[^"]*"' src/pages/{nav1}/{nav2} | sort | uniq -c | sort -rn

# VÉRIFICATION ISOLATION JS
grep -r "from.*tabs/" src/pages/{nav1}/{nav2}/tabs/{tab}/ | grep -v 'from "./'

# VÉRIFICATION ISOLATION CSS
grep -r "import.*\.\..*\.css" src/pages/{nav1}/{nav2}/tabs/

# Lister les traductions (via index pré-généré)
grep "locales.*\.json$" /home/ubuntu/new_manager_files.txt | sort
```

---

## N) Workflow Chat

1. **Upload** : tar sources + ce prompt
2. **Demande** : "Applique prompt_split.txt sur {nav1}/{nav2}"
3. **Claude analyse** : extrait, liste méthodes/types/CSS par tab, propose matrices
4. **Validation** : "GO" pour lancer la génération
5. **Génération JS** : scripts cp+tee services par batch de 5
6. **Génération CSS** : scripts cp+tee styles par batch de 5
7. **Génération i18n** : scripts cp+tee traductions par batch de 5
8. **Modification** : patches pour imports et classNames
9. **Vérification** : scripts de test isolation JS + CSS + build
10. **Nettoyage** : backup + suppression fichiers monolithiques

---

## O) Rappel Final

> **DÉFACTORISATION = DUPLICATION VOLONTAIRE (JS + CSS)**
>
> Si tu hésites entre "factoriser pour éviter la duplication" et "dupliquer pour garantir l'isolation" :
>
> **→ TOUJOURS CHOISIR L'ISOLATION**
>
> Le coût de la duplication (quelques lignes JS/CSS en plus) est INFINIMENT plus faible que le coût du couplage (régressions en cascade, styles qui cassent, tests impossibles).
>
> **"Chaque tab est une île. Aucun pont entre les îles. Ni en JS, ni en CSS."**
