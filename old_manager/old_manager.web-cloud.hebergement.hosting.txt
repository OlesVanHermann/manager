# CAHIER DES CHARGES - Web Hosting (Hebergement Web)

## Source : old_manager_web-cloud_hebergement.tar + old_manager_web-cloud_hebergement_hosting.tar
## Package : @ovh-ux/manager-web-hosting-app v0.12.1

---

# 1. RESUME EXECUTIF

## Perimetre
Application React de gestion des hebergements web mutualises OVHcloud et Managed WordPress.

## Objectif fonctionnel
- Gerer les hebergements web (infos, domaines, SSL, BDD, FTP, cron)
- Gerer les sites Managed WordPress (creation, import, suppression)
- Suivre les taches en cours
- Gerer la visibilite Pro (SEO local)

## Users cibles
Clients OVHcloud avec hebergement web (Starter, Perso, Pro, Performance 1-4, Cloud Web)

## Regions
EU, CA

---

# 2. ARCHITECTURE

## Arborescence

```
packages/manager/apps/web-hosting/
├── public/translations/           # i18n (8 langues)
│   ├── common/
│   ├── dashboard/
│   ├── ssl/
│   ├── task/
│   ├── onboarding/
│   ├── local-seo/
│   └── managedWordpress/
├── src/
│   ├── components/               # Composants reutilisables
│   │   ├── topBar/              # Actions SSL
│   │   ├── tabs/                # Container scrollable
│   │   ├── tabsPanel/           # Navigation onglets
│   │   ├── badgeStatus/         # Badge statut colore
│   │   ├── expirationDate/      # Date expiration
│   │   ├── loading/             # Spinner
│   │   └── breadcrumb/          # Fil Ariane
│   ├── data/
│   │   ├── api/                 # Services API
│   │   │   ├── dashboard.ts     # APIs hebergement
│   │   │   ├── ssl.ts           # APIs SSL
│   │   │   ├── local-seo.ts     # APIs SEO local
│   │   │   ├── managedWordpress.ts  # APIs WordPress
│   │   │   ├── AttachedDomain.ts    # Domaines attaches
│   │   │   └── AttachedDomainDigStatus.ts  # Statut DNS
│   │   ├── hooks/               # React Query hooks
│   │   └── types/               # Types TypeScript
│   ├── pages/
│   │   ├── onboarding/          # Page accueil
│   │   ├── websites/            # Liste sites
│   │   ├── dashboard/           # Dashboard hebergement
│   │   │   ├── ssl/             # Gestion SSL
│   │   │   ├── task/            # Taches en cours
│   │   │   ├── local-seo/       # Visibilite Pro
│   │   │   └── multisite/       # Ajout domaine
│   │   └── managedWordpress/    # WordPress manage
│   ├── routes/                  # Configuration routing
│   ├── hooks/                   # Hooks utilitaires
│   └── utils/                   # Helpers
└── package.json
```

## Dependances principales

| Package | Version | Usage |
|---------|---------|-------|
| @ovh-ux/manager-core-api | ^0.20.1 | v6, v2, aapi, fetchIcebergV2 |
| @ovh-ux/manager-react-components | ^2.43.1 | Datagrid, useResourcesIcebergV6/V2 |
| @ovhcloud/ods-components | ^18.6.2 | Design System ODS |
| @tanstack/react-query | ^5.51.21 | Cache/requetes |
| react-hook-form + zod | 7.56.0 / ^3.24.2 | Validation |
| export-to-csv | ^1.4.0 | Export CSV |

---

# 3. PAGES & NAVIGATION

## Routes

| Route | Page | Description |
|-------|------|-------------|
| / | RootPage | Layout racine |
| /onboarding | OnboardingPage | Page accueil sans service |
| /websites | WebsitesPage | Liste tous les sites |
| /managed-hosting-for-wordpress | ManagedWordpressPage | Liste services WordPress |
| /managed-hosting-for-wordpress/:serviceName | ManagedWordpressResourcePage | Dashboard WordPress |
| /managed-hosting-for-wordpress/:serviceName/create | ManagedWordpressServiceCreatePage | Creer site WP |
| /managed-hosting-for-wordpress/:serviceName/import | ManagedWordpressServiceImportPage | Importer site WP |
| /managed-hosting-for-wordpress/:serviceName/tasks | ManagedWordpressServiceTasksPage | Taches WP |
| /managed-hosting-for-wordpress/:serviceName/delete-modal | ManagedWordpressServiceDelete | Modal suppression |
| /:serviceName | DashboardLayout | Dashboard hebergement |
| /:serviceName/ssl | SslPage | Certificats SSL |
| /:serviceName/import-ssl | ImportSslPage | Import SSL custom |
| /:serviceName/order-sectigo | OrderSectigoPage | Commander Sectigo |
| /:serviceName/:domain/disable-ssl | DisableSslPage | Desactiver SSL |
| /:serviceName/:domain/san-ssl | SanSslPage | Voir SAN |
| /:serviceName/task | OngoingTaskPage | Taches en cours |
| /:serviceName/add-domain | AddDomainPage | Ajouter domaine |
| /:serviceName/order-domain | OrderDomainPage | Commander domaine |
| /:serviceName/localSeo | LocalSeoPage | Visibilite Pro |
| /:serviceName/localSeo/:locationId/terminate | RemoveSeoSubscriptionPage | Resilier SEO |

---

# 4. COMPOSANTS UI

## TopBar (SSL)

**Props** : Aucune (useParams pour serviceName)

**Structure** :
```tsx
<div className="mb-10 flex flex-col space-y-10">
  <div className="flex space-x-4">
    <OdsButton label="Commander un certificat SSL Sectigo" />
    <OdsButton label="Import de votre propre certificat SSL" variant="outline" />
  </div>
  <div className="bg-gray-200 p-6">
    <OdsText preset="heading4">Activer le certificat SSL</OdsText>
    <OdsSelect className="w-1/3" allowMultiple />
    <OdsButton label="Activer SSL Let's Encrypt" />
  </div>
</div>
```

## TabsPanel

**Props** :
```typescript
type TabItemProps = {
  name: string;
  trackingName: string;
  title: ReactNode;
  pathMatchers?: RegExp[];
  to: string;
  hidden?: boolean;
  isDisabled?: boolean;
};
```

## BadgeStatus

**Mapping couleurs** :
| Statut | Couleur |
|--------|---------|
| CREATED, READY, ACTIVE, CONFIGURED | success |
| CREATING, DELETING, DEPLOYING, INITIALERROR, EXTERNAL | warning |
| DISABLED, ERROR, SUSPENDED, NONE | critical |
| NOT_CONFIGURED | neutral |

## Datagrid

Utilise @ovh-ux/manager-react-components avec pagination Iceberg.

---

# 5. APIs & DONNEES

## API v6 (apiv6)

| Methode | Endpoint | Fonction | Fichier |
|---------|----------|----------|---------|
| GET | /hosting/web/{serviceName} | getHostingService | dashboard.ts |
| GET | /hosting/web/{serviceName}/serviceInfos | getServiceInfos | dashboard.ts |
| PUT | /hosting/web/{serviceName} | updateHostingService | dashboard.ts |
| POST | /hosting/web/{serviceName}/attachedDomain | createAttachedDomainService | dashboard.ts |
| GET | /hosting/web/{serviceName}/attachedDomain/{domain}/digStatus | getWebHostingAttachedDomainDigStatus | AttachedDomainDigStatus.ts |
| GET | /domain/zone | getDomainZone | dashboard.ts |
| GET | /domain/{serviceName} | getDomainService | dashboard.ts |

## API v6 - SSL

| Methode | Endpoint | Fonction | Fichier |
|---------|----------|----------|---------|
| POST | /hosting/web/{serviceName}/ssl | createCertificate (import custom) | ssl.ts |
| POST | /hosting/web/{serviceName}/attachedDomain/{domain}/ssl | createDomainCertificate (Let's Encrypt) | ssl.ts |
| DELETE | /hosting/web/{serviceName}/attachedDomain/{domain}/ssl | deleteDomainCertificate | ssl.ts |

## API v6 - Local SEO

| Methode | Endpoint | Fonction | Fichier |
|---------|----------|----------|---------|
| GET | /hosting/web/{serviceName}/localSeo/account/{id} | getHostingLocalSeoAccount | local-seo.ts |
| POST | /hosting/web/{serviceName}/localSeo/account/{accountId}/login | hostingLocalSeoLogin | local-seo.ts |
| POST | /hosting/web/{serviceName}/localSeo/location/{locationId}/terminate | hostingDeleteLocation | local-seo.ts |

## API v6 Iceberg (useResourcesIcebergV6)

| Methode | Endpoint | Usage | Fichier |
|---------|----------|-------|---------|
| GET | /hosting/web/{serviceName}/tasks | Liste taches | Task.page.tsx |
| GET | /hosting/web/{serviceName}/localSeo/location | Liste SEO locations | LocalSeo.page.tsx |

## API 2API (AAPI/SWS)

| Methode | Endpoint | Fonction | Fichier |
|---------|----------|----------|---------|
| GET | /sws/hosting/web/{serviceName}/add-domain-existing?tokenNeeded={path} | getAddDomainExisting | dashboard.ts |

## API v2 - Managed CMS

| Methode | Endpoint | Fonction | Fichier |
|---------|----------|----------|---------|
| GET | /managedCMS/reference/supportedPHPVersions?cms=WORDPRESS | getManagedCmsSupportedPHPVersions | managedWordpress.ts |
| GET | /managedCMS/reference/availableLanguages?cms=WORDPRESS | getManagedCmsReferenceAvailableLanguages | managedWordpress.ts |
| GET | /managedCMS/resource | getManagedCmsResource | managedWordpress.ts |
| GET | /managedCMS/resource/{serviceName} | getManagedCmsResourceDetails | managedWordpress.ts |
| GET | /managedCMS/resource/{serviceName}/website/{websiteId} | getManagedCmsResourceWebsiteDetails | managedWordpress.ts |
| POST | /managedCMS/resource/{serviceName}/website | postManagedCmsResourceWebsite | managedWordpress.ts |
| DELETE | /managedCMS/resource/{serviceName}/website/{websiteId} | deleteManagedCmsResourceWebsite | managedWordpress.ts |
| GET | /managedCMS/resource/{serviceName}/task | getManagedCmsResourceWebsiteTasks | managedWordpress.ts |
| PUT | /managedCMS/resource/{serviceName}/task/{taskId} | putManagedCmsResourceWebsiteTasks | managedWordpress.ts |

## API v2 Iceberg (useResourcesIcebergV2 / fetchIcebergV2)

| Methode | Endpoint | Usage | Fichier |
|---------|----------|-------|---------|
| GET | /webhosting/attachedDomain | Liste domaines (global) | AttachedDomain.ts |
| GET | /webhosting/resource/{serviceName}/attachedDomain | Liste domaines (service) | TopBar.component.tsx |
| GET | /webhosting/resource/{serviceName}/certificate | Liste certificats SSL | Ssl.page.tsx |
| GET | /managedCMS/resource/{serviceName}/website | Liste sites WordPress | managedWordpress.ts |

---

# 6. TYPES TYPESCRIPT

## Statuts

```typescript
enum ResourceStatus {
  CREATING = 'CREATING',
  DELETING = 'DELETING',
  ERROR = 'ERROR',
  READY = 'READY',
  UPDATING = 'UPDATING',
  SUSPENDED = 'SUSPENDED',
  DONE = 'DONE',
}

enum ServiceStatus {
  ACTIVE = 'ACTIVE',
  NONE = 'NONE',
}

enum GitStatus {
  CREATED = 'CREATED',
  CREATING = 'CREATING',
  DELETING = 'DELETING',
  DEPLOYING = 'DEPLOYING',
  DISABLED = 'DISABLED',
  ERROR = 'ERROR',
  INITIALERROR = 'INITIAL_ERROR',
}

enum DnsStatus {
  CONFIGURED = 'DNS_CONFIGURED',
  EXTERNAL = 'DNS_EXTERNAL',
  NOT_CONFIGURED = 'DNS_NOT_CONFIGURED',
}

enum TaskStatus {
  ERROR = 'ERROR',
  PENDING = 'PENDING',
  RUNNING = 'RUNNING',
  SCHEDULED = 'SCHEDULED',
}

enum OngoingTaskStatus {
  CANCELLED = 'cancelled',
  DOING = 'doing',
  DONE = 'done',
  INIT = 'init',
  TODO = 'todo',
}
```

## SSL

```typescript
enum CertificateType {
  COMODO = 'COMODO',
  CUSTOM = 'CUSTOM',
  LETSENCRYPT = 'LETSENCRYPT',
  SECTIGO = 'SECTIGO',
}

enum State {
  ACTIVE = 'ACTIVE',
  CREATING = 'CREATING',
  DELETING = 'DELETING',
  EXPIRED = 'EXPIRED',
  IMPORTING = 'IMPORTING',
  REGENERATING = 'REGENERATING',
}

type SslCertificate = {
  checksum: string;
  currentState: {
    additionalDomains: string[];
    certificateType: CertificateType;
    createdAt: string;
    expiredAt: string;
    mainDomain: string;
    state: State;
  };
  currentTasks: Array<{
    id: string;
    link: string;
    status: Status;
    type: string;
  }>;
  id: string;
  resourceStatus: ResourceStatus;
};
```

## Hebergement

```typescript
enum HostingState {
  ACTIVE = 'active',
  BLOQUED = 'bloqued',
  MAINTENANCE = 'maintenance',
}

enum HostingdOffer {
  CLOUDWEB_1 = 'CLOUDWEB_1',
  CLOUDWEB_2 = 'CLOUDWEB_2',
  CLOUDWEB_3 = 'CLOUDWEB_3',
  KS = 'KS',
  PERFORMANCE_1 = 'PERFORMANCE_1',
  PERFORMANCE_2 = 'PERFORMANCE_2',
  PERFORMANCE_3 = 'PERFORMANCE_3',
  PERFORMANCE_4 = 'PERFORMANCE_4',
  PERSO = 'PERSO',
  PRO = 'PRO',
  START = 'START',
}

enum HostingDomainStatus {
  ACTIVE = 'active',
  NONE = 'none',
}

type WebHostingType = {
  availableBoostOffer: Array<{ offer: HostingdOffer; price: {...} }>;
  boostOffer?: string;
  cluster: string;
  clusterIp?: string;
  countriesIp: Array<{ country: HostingCountries; ip?: string; ipv6?: string }>;
  datacenter: string;
  displayName?: string;
  hasCdn?: boolean;
  hasHostedSsl?: boolean;
  home: string;
  hostingIp?: string;
  offer: string;
  phpVersions: Array<{ support: PhpVersionsSupport; version: string }>;
  primaryLogin: string;
  quotaSize: { unit: string; value: number };
  quotaUsed: { unit: string; value: number };
  serviceName: string;
  state: HostingState;
  serviceManagementAccess: {
    ftp: { port: number; url: string };
    http: { port: number; url: string };
    ssh: { port: number; url: string };
  };
};
```

## Domaine attache

```typescript
type TCreateAttachedDomain = {
  serviceName?: string;
  domain?: string;
  cdn?: HostingDomainStatus;
  firewall?: HostingDomainStatus;
  ownLog?: string;
  path?: string;
  runtimeId?: number;
  ssl?: boolean;
  bypassDNSConfiguration?: boolean;
  ipLocation?: HostingCountries;
  wwwNeeded?: boolean;
};

type WebsiteType = {
  id: string;
  currentState?: {
    isDefault?: boolean;
    resourceStatus: ResourceStatus;
    fqdn?: string;
    path?: string;
    cdn?: { status?: ServiceStatus };
    firewall?: { status?: ServiceStatus };
    git?: { status?: GitStatus; vcsBranch?: string; vcsUrl?: string };
    ssl?: { status: ServiceStatus };
    hosting?: { serviceName?: string; displayName?: string; offer?: string };
    ownLog?: string;
  };
  currentTasks?: Array<{ id?: string; status?: TaskStatus; type?: TaskType }>;
};
```

## WordPress

```typescript
enum CmsType {
  WORDPRESS = 'WORDPRESS',
}

type PostCreatePayload = {
  targetSpec: {
    creation: {
      adminLogin: string;
      adminPassword: string;
      cms: CmsType.WORDPRESS;
      cmsSpecific?: {
        wordpress?: { language?: string; url?: string };
      };
      phpVersion?: string;
    };
  };
};

type PostImportPayload = {
  targetSpec: {
    import: {
      adminLogin: string;
      adminPassword: string;
      adminURL?: string;
      cms: CmsType.WORDPRESS;
    };
  };
};
```

---

# 7. TRADUCTIONS (FR)

## dashboard

```json
{
  "hosting_tab_GENERAL_INFORMATIONS": "Informations generales",
  "hosting_tab_MULTISITE": "Multisite",
  "hosting_tab_SSL": "Certificats SSL",
  "hosting_tab_MODULE": "Modules en 1 clic",
  "hosting_tab_USER_LOGS": "Statistiques et logs",
  "hosting_tab_FTP": "FTP - SSH",
  "hosting_tab_DATABASE": "Bases de donnees",
  "hosting_tab_TASK": "Taches en cours",
  "hosting_tab_AUTOMATED_EMAILS": "Scripts e-mail",
  "hosting_tab_CRON": "Cron",
  "hosting_tab_LOCAL_SEO": "Visibilite Pro",
  "hosting_tab_BOOST": "Booster mon offre",
  "hosting_add_title": "Ajouter un domaine ou un sous-domaine",
  "hosting_add_step1_ovh": "Ajouter un domaine enregistre chez OVHcloud",
  "hosting_add_step1_external": "Ajouter un domaine externe",
  "hosting_multisite_domain_configuration_home": "Dossier racine",
  "hosting_multisite_domain_configuration_cdn": "CDN",
  "hosting_multisite_domain_configuration_ssl": "SSL",
  "hosting_multisite_domain_configuration_firewall": "Activer le firewall",
  "hosting_multisite_domain_configuration_ownlog": "Logs separes",
  "expiration_renew_date": "Renouvellement automatique prevu le <strong>{{expirationDate}}</strong>",
  "expiration_resiliation_date": "Resiliation prevue le <strong>{{expirationDate}}</strong>"
}
```

## ssl

```json
{
  "order_ssl_certificate": "Commander un certificat SSL Sectigo",
  "import_ssl_certificate": "Import de votre propre certificat SSL",
  "enable_ssl_certificate": "Activer le certificat SSL",
  "enable_ssl_encrypt": "Activer SSL Let's Encrypt",
  "cell_main_domain": "Domaine principal",
  "cell_additional_domain": "Domaine supplementaire (SAN)",
  "cell_certificate_type": "Type de certificat",
  "cell_state": "Etat",
  "cell_creation_date": "Date de creation",
  "cell_expiration_date": "Date d'expiration",
  "disable_ssl": "Desactiver SSL",
  "delete_ssl": "Suppression SSL",
  "regenerate_ssl": "Regenerer SSL",
  "LETSENCRYPT": "Let's Encrypt",
  "SECTIGO": "Sectigo",
  "CUSTOM": "Custom",
  "ACTIVE": "Actif",
  "CREATING": "En creation",
  "EXPIRED": "Expire",
  "hosting_dashboard_ssl_activation_success": "Votre demande d'activation d'un certificat SSL a bien ete prise en compte.",
  "hosting_dashboard_ssl_activation_error": "Une erreur est survenue lors de la demande d'activation d'un certificat SSL. ({{error}})"
}
```

## task

```json
{
  "hosting_tab_TASKS_table_function": "Tache",
  "hosting_tab_TASKS_table_state": "Statut",
  "hosting_tab_TASKS_table_start_date": "Date de creation",
  "hosting_tab_TASKS_function_hosting_install": "Installation de l'hebergement",
  "hosting_tab_TASKS_function_web_attachDomain": "Ajout d'un domaine sur l'hebergement",
  "hosting_tab_TASKS_function_database_create": "Creation de base de donnees",
  "hosting_tab_TASKS_function_ssl_create": "Creation d'un certificat SSL",
  "hosting_tab_TASKS_function_ssl_renew": "Renouvellement d'un certificat SSL",
  "hosting_tab_TASKS_function_ssl_delete": "Suppression d'un certificat SSL",
  "hosting_tab_TASKS_function_cdn_flush": "Raffraichissement du CDN",
  "hosting_tab_TASKS_function_module_install": "Installation d'un module",
  "hosting_tab_TASKS_status_doing": "En cours",
  "hosting_tab_TASKS_status_done": "Terminee",
  "hosting_tab_TASKS_status_error": "En erreur",
  "hosting_tab_TASKS_status_todo": "Planifiee"
}
```

## local-seo

```json
{
  "hosting_tab_LOCAL_SEO": "Visibilite Pro",
  "hosting_tab_LOCAL_SEO_description": "Soyez presents la ou vos clients vous cherchent...",
  "hosting_dashboard_local_seo_visibility_check": "Verifiez votre referencement local",
  "hosting_tab_LOCAL_SEO_access_interface": "Acceder a l'interface",
  "hosting_tab_LOCAL_SEO_delete": "Supprimer l'abonnement"
}
```

## managedWordpress

```json
{
  "web_hosting_managed_wordpress_import_select_element": "Selectionner les elements a importer",
  "web_hosting_managed_wordpress_import_select_plugins_all": "Tous les plugins",
  "web_hosting_managed_wordpress_import_select_themes_all": "Tous les themes",
  "web_hosting_managed_wordpress_create_webiste_language_admin": "Langue de l'admin WordPress",
  "web_hosting_managed_wordpress_create_webiste_php_version": "Version PHP",
  "web_hosting_managed_wordpress_quota_used": "{{used}} / {{total}} sites",
  "web_hosting_managed_wordpress_delete_website_success_message": "Votre demande de suppression de votre site {{website}} a bien ete prise en compte."
}
```

---

# 8. REGLES METIER

## Validation domaine
- Pas de majuscules
- Pas de caracteres speciaux
- Si SSL : max 64 caracteres
- Unicite (pas deja attache)

## SSL Let's Encrypt
- Filtrage : ssl.status !== ACTIVE && !isDefault
- Selection multiple possible
- Activation asynchrone

## Gestion expiration
- Si EXPIRED : rien affiche
- Si autorenew + deleteAtExpiration : date resiliation
- Si autorenew + !deleteAtExpiration : date renouvellement

## WordPress import
- Selection plugins/themes/medias/BDD
- Mode maintenance recommande
- Tache asynchrone avec suivi progression

---

# 9. SEQUENCES D'APPELS API

## Chargement page SSL
1. GET /webhosting/resource/{serviceName}/certificate (Iceberg)
2. GET /webhosting/resource/{serviceName}/attachedDomain (pour TopBar)

## Activation Let's Encrypt
1. POST /hosting/web/{serviceName}/attachedDomain/{domain}/ssl (par domaine)
2. Invalidation cache ['hosting', 'web', serviceName, 'attachedDomain']

## Import certificat custom
1. POST /hosting/web/{serviceName}/ssl { certificate, key, chain }

## Ajout domaine
1. GET /sws/hosting/web/{serviceName}/add-domain-existing (2API)
2. GET /domain/zone
3. POST /hosting/web/{serviceName}/attachedDomain
4. (Si wwwNeeded) POST /hosting/web/{serviceName}/attachedDomain (www.domain)

## Creation site WordPress
1. POST /managedCMS/resource/{serviceName}/website { targetSpec.creation }
2. GET /managedCMS/resource/{serviceName}/task (polling)

---

*Genere automatiquement depuis l'analyse du code source*
*331 fichiers analyses - 29 endpoints API documentes*
