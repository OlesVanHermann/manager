# CAHIER DES CHARGES - DOMAINS (Web Cloud)
# Source: old_manager_web-cloud_domains.tar
# Généré le: 2024-12-21
# Frameworks sources: AngularJS 1.x + React/TypeScript

================================================================================
## 1. RESUME EXECUTIF
================================================================================

### Périmètre
Gestion complète des noms de domaine OVHcloud incluant:
- Dashboard principal du domaine avec informations générales
- Gestion des serveurs DNS (hébergés OVH ou externes)
- Zone DNS (records, import/export, reset)
- Redirections web
- DynHost (DNS dynamique)
- Glue records (pour domaines servant de DNS)
- DNSSEC (délégation sécurisée)
- Tâches et opérations en cours
- Gestion des contacts

### Objectif fonctionnel
Permettre aux utilisateurs de configurer et administrer leurs domaines:
- Visualiser l'état du domaine (actif, expiré, suspendu)
- Modifier les serveurs DNS
- Gérer les enregistrements DNS
- Activer/désactiver la protection transfert
- Configurer DNSSEC
- Suivre les opérations en cours

### Utilisateurs cibles
- Administrateur du domaine (contactAdmin)
- Contact technique (contactTech)
- Contact facturation (contactBilling)
- Propriétaire (whoisOwner)

### Applications sources
| Application | Framework | Chemin |
|-------------|-----------|--------|
| web | AngularJS 1.x | packages/manager/apps/web/client/app/domain/ |
| web-ongoing-operations | React/TS | packages/manager/apps/web-ongoing-operations/ |

================================================================================
## 2. ARCHITECTURE
================================================================================

### Arborescence fichiers source
```
packages/manager/apps/web/client/app/domain/
├── dashboard/
│   ├── domain.controller.js          # Controller principal
│   ├── domain.html                    # Template dashboard
│   ├── domain.routing.js              # Routes states
│   ├── domain.service.js              # Service API (1634 lignes)
│   └── translations/
├── general-informations/
│   ├── domain-general-informations.controller.js
│   ├── domain-general-informations.html
│   ├── domain-general-informations.state.js
│   ├── activateZone/
│   └── webhosting-enable/
├── dns/
│   ├── domain-dns.controller.js
│   ├── domain-dns.html
│   └── translations/
├── dns-modify/
├── zone/
│   ├── zone.controller.js
│   ├── zone.html
│   ├── activate/
│   └── translations/
├── redirection/
│   ├── domain-redirection.service.js
│   ├── REDIRECTION.html
│   ├── delete/
│   └── edit/
├── dynhost/
├── glue/
├── dnssec/
├── tasks/
├── contact/
├── anycast/
├── authinfo/
├── uk-transfert-tag/
├── optin/
└── onboarding/

packages/manager/apps/web-ongoing-operations/src/
├── pages/
│   ├── dashboard/
│   │   ├── Dashboard.tsx
│   │   ├── domain/Domain.tsx
│   │   ├── dns/Dns.tsx
│   │   └── allDom/AllDom.tsx
│   ├── tracking/Tracking.tsx
│   └── update/Update.tsx
├── components/
│   ├── OngoingOperationDatagrid/
│   ├── Tracking/
│   └── Update/
├── data/api/
│   ├── web-ongoing-operations.ts
│   ├── tracking.ts
│   ├── document.ts
│   └── iam.ts
├── enum/
│   ├── status.enum.ts
│   ├── actionName.enum.ts
│   └── parent.enum.ts
└── routes/
    ├── routes.tsx
    └── routes.constant.ts
```

### Patterns architecturaux

**AngularJS (web):**
- Services injectés: OvhHttp, $http, OvhApiDomain, Poll, Poller
- Cache: UNIVERS_WEB_DOMAIN, UNIVERS_WEB_DOMAIN_REDIRECTION
- Events broadcast: domain.dashboard.refresh, domain.tabs.zonedns.refresh
- Polling pour tâches asynchrones

**React (web-ongoing-operations):**
- React Query pour data fetching
- v6 client (@ovh-ux/manager-core-api)
- Composants ODS React
- React Router pour navigation

### Dépendances clés
- @ovh-ux/manager-core-api (v6, v2)
- @ovhcloud/ods-react (composants ODS)
- @ovh-ux/manager-react-components
- lodash (utilitaires)
- punycode (conversion IDN)

================================================================================
## 3. PAGES & NAVIGATION
================================================================================

### Routes AngularJS

| State | URL | Template | Controller |
|-------|-----|----------|------------|
| app.domain.index | /domain?filter | managerListDomainLayout | - |
| app.domain.product | /domain/:productId | domain.html | DomainCtrl |
| app.domain.product.information | .../information | domain-general-informations.html | DomainGeneralInformationsCtrl |
| app.domain.product.zone | .../zone | zone.html | ZoneCtrl |
| app.domain.product.dns | .../dns | domain-dns.html | DomainDnsCtrl |
| app.domain.product.dns_modify | .../dns-modify | dns-modify.html | DnsModifyCtrl |
| app.domain.product.redirection | .../redirection | REDIRECTION.html | RedirectionCtrl |
| app.domain.product.dynhost | .../dynhost | dynhost.html | DynHostCtrl |
| app.domain.product.glue | .../glue | glue.html | GlueCtrl |
| app.domain.product.dnssec | .../dnssec | dnssec.html | DnssecCtrl |
| app.domain.product.tasks | .../tasks | tasks.html | TasksCtrl |
| app.domain.product.contact | .../contact | contact.html | ContactCtrl |
| app.domain.product.anycast | .../anycast | anycast.html | AnycastCtrl |
| app.domain.product.webhosting.order | .../webhosting/order | order.html | OrderCtrl |
| app.alldom.domain | /alldom/:allDom/:productId | domain.html | DomainCtrl |

### Routes React (web-ongoing-operations)

| Path | Component | Description |
|------|-----------|-------------|
| / | DashboardPage | Liste opérations |
| /domain | DashboardDomainPage | Opérations domaine |
| /dns | DashboardDnsPage | Opérations DNS |
| /alldom | AllDom | Opérations AllDom |
| /tracking/:id | TrackPage | Suivi transfert |
| /:product/update/:id | ActionPage | Mise à jour opération |

### Onglets Dashboard Domain

| Onglet | State suffix | Condition affichage | Tracking |
|--------|--------------|---------------------|----------|
| Informations générales | .information | Toujours | web::domain::general-informations |
| Zone DNS | .zone | Toujours | web::domain::zone-dns |
| Serveurs DNS | .dns | Toujours | web::domain::dns |
| Redirections | .redirection | Toujours | web::domain::redirection |
| DynHost | .dynhost | hasZoneDns && zoneCapabilities.dynHost | web::domain::dynhost |
| Glue | .glue | domainInfos.hostSupported | web::domain::glue |
| DNSSEC | .dnssec | !domain.managedByOvh | web::domain::dnssec |
| Tâches | .tasks | Toujours | web::domain::tasks |
| Contacts | .contact | Toujours | web::domain::contact |

### Breadcrumb
```
Noms de domaine > {domainName} > [Onglet actif]
```
Pour AllDom:
```
AllDom > {allDomName} > {domainName} > [Onglet actif]
```

### Flux de navigation

**Onboarding (si aucun domaine):**
```
app.domain.index → (resources.length === 0) → app.domain.onboarding
```

**Accès domaine:**
```
Liste domaines → Clic domaine → app.domain.product → redirect → app.domain.product.information
```

**Actions modales:**
```
Dashboard → Bouton action → setAction('path/modal', data) → Modal overlay → Fermeture → Broadcast refresh
```

================================================================================
## 4. COMPOSANTS UI
================================================================================

### Composants ODS/OuiKit utilisés

| Composant | Usage | Props principales |
|-----------|-------|-------------------|
| oui-spinner | Loading states | size="l" / size="s" |
| oui-tile | Cartes d'information | heading, loading |
| oui-tile-definition | Ligne dans tile | term, term-popover, description |
| oui-tile-description | Contenu définition | - |
| oui-badge | Status badges | class: oui-badge_success/error/warning/info |
| oui-switch | Toggle on/off | model, disabled, on-change |
| oui-action-menu | Menu actions | compact, placement="end" |
| oui-action-menu-item | Item menu | href, on-click |
| oui-header-tabs | Navigation onglets | - |
| oui-header-tabs-item | Onglet | state, state-params |
| oui-message | Alertes/warnings | type="warning/error", dismissable |
| oui-button | Boutons | class: oui-button_primary/secondary/dropdown |

### Composants WUC (Web Universe Components)

| Composant | Props | Description |
|-----------|-------|-------------|
| wuc-service-expiration-date | service-name, service-type, service-infos, domain-state | Affiche date expiration avec statut |
| wuc-service-status-action | service-name, service-type, service-infos, domain-state | Actions renouvellement |
| wuc-autorenew-invite | product-type, service-infos, guide-url, autorenew-url | Banner invitation auto-renew |
| wuc-guides | wuc-guides-list, wuc-guides-title | Section guides |

### Composants métier

**Header Domain:**
```html
<div class="oui-header">
  <h1 class="oui-header__title">{{ domain.displayName }}</h1>
  <wuc-service-expiration-date .../>
  <changelog-button links="..." chapters="..."/>
  <div uib-dropdown><!-- Menu actions --></div>
</div>
<oui-header-tabs>
  <oui-header-tabs-item state="...information">Informations</oui-header-tabs-item>
  <!-- autres onglets -->
</oui-header-tabs>
```

**Tile Informations générales:**
```html
<oui-tile heading="Informations générales" loading="...">
  <oui-tile-definition term="Statut">
    <oui-tile-description>
      <span class="oui-badge oui-badge_success">{{ status }}</span>
    </oui-tile-description>
  </oui-tile-definition>
  <oui-tile-definition term="Serveurs DNS" term-popover="tooltip">
    <oui-tile-description>...</oui-tile-description>
    <oui-action-menu compact placement="end">
      <oui-action-menu-item on-click="...">Informations</oui-action-menu-item>
    </oui-action-menu>
  </oui-tile-definition>
</oui-tile>
```

**Protection Toggle:**
```html
<oui-switch
  disabled="vm.protection.isUnavailable"
  model="vm.protection.enabled"
  on-change="switchTheStateOfProtection()">
</oui-switch>
<span class="oui-badge" ng-class="{
  'oui-badge_success': vm.protection.enabled,
  'oui-badge_warning': vm.protection.isUnavailable,
  'oui-badge_error': !vm.protection.enabled
}">{{ 'domain_dashboard_protection_' + domain.protection | translate }}</span>
```

### États visuels

**Loading:**
```html
<div ng-if="loading">
  <oui-spinner size="l"></oui-spinner>
</div>
```

**Empty state (onboarding):**
- Redirection vers app.domain.onboarding si aucun domaine

**Error state:**
```html
<oui-message type="error">
  {{ errorMessage }}
</oui-message>
```

**Warning banners:**
```html
<div class="alert alert-warning" ng-if="isDomainServiceStateExpired()">
  <span translate="domain_configuration_renew" translate-values="{t0: domain.displayName}"></span>
  <a href="{{ getRenewUrl() }}">Renouveler</a>
</div>
```

### Mapping ODS React (pour migration)

| OuiKit (Angular) | ODS React | Notes |
|------------------|-----------|-------|
| oui-spinner | OdsSpinner | size prop identique |
| oui-tile | OdsTile | Structure différente |
| oui-badge | OdsBadge | color au lieu de class |
| oui-switch | OdsSwitch | checked au lieu de model |
| oui-button | OdsButton | variant au lieu de class |
| oui-message | OdsMessage | type identique |
| oui-action-menu | OdsPopover + OdsButton | Composition manuelle |

================================================================================
## 5. APIs & DONNEES
================================================================================

### Endpoints par catégorie

#### Domain (apiv6)

| Méthode | Endpoint | Description | Params |
|---------|----------|-------------|--------|
| GET | /domain | Liste tous les domaines | whoisOwner? |
| GET | /domain.json | Schema API domain | - |
| GET | /domain/{serviceName} | Détails domaine | - |
| PUT | /domain/{serviceName} | Modifier domaine | nameServerType?, transferLockStatus? |
| GET | /domain/{serviceName}/serviceInfos | Infos service | - |
| GET | /domain/{serviceName}/task | Liste tâches | status?, function? |
| GET | /domain/{serviceName}/task/{id} | Détail tâche | - |
| GET | /domain/{serviceName}/authInfo | Code AUTH/INFO | - |
| GET | /domain/{serviceName}/nameServer | Liste serveurs DNS | - |
| GET | /domain/{serviceName}/nameServer/{id} | Détail serveur DNS | - |
| GET | /domain/{serviceName}/nameServer/{id}/status | Statut serveur | - |
| POST | /domain/{serviceName}/nameServer | Ajouter serveur DNS | nameServer[] |
| DELETE | /domain/{serviceName}/nameServer/{id} | Supprimer serveur | - |
| POST | /domain/{serviceName}/nameServers/update | Maj liste serveurs | nameServers[] |
| GET | /domain/{serviceName}/dsRecord | Liste DNSSEC | - |
| GET | /domain/{serviceName}/dsRecord/{id} | Détail DNSSEC | - |
| POST | /domain/{serviceName}/dsRecord | Sauver DNSSEC | keys[] |
| GET | /domain/{serviceName}/glueRecord | Liste glue records | - |
| GET | /domain/{serviceName}/glueRecord/{host} | Détail glue | - |
| POST | /domain/{serviceName}/glueRecord | Ajouter glue | host, ips[] |
| DELETE | /domain/{serviceName}/glueRecord/{host} | Supprimer glue | - |
| POST | /domain/{serviceName}/glueRecord/{host}/update | Modifier glue | ips[] |
| POST | /domain/{serviceName}/ukOutgoingTransfer | Tag transfert UK | tag |

#### Zone DNS (apiv6)

| Méthode | Endpoint | Description | Params |
|---------|----------|-------------|--------|
| GET | /domain/zone | Liste toutes les zones | - |
| GET | /domain/zone/{zoneName} | Détails zone | - |
| GET | /domain/zone/{zoneName}/serviceInfos | Infos service zone | - |
| GET | /domain/zone/{zoneName}/status | Statut zone | - |
| GET | /domain/zone/{zoneName}/dnssec | Statut DNSSEC zone | - |
| GET | /domain/zone/{zoneName}/soa | Record SOA | - |
| PUT | /domain/zone/{zoneName}/soa | Modifier SOA | ... |
| GET | /domain/zone/{zoneName}/task | Tâches zone | - |
| GET | /domain/zone/{zoneName}/task/{id} | Détail tâche | - |
| GET | /domain/zone/{zoneName}/export | Export zone texte | - |
| POST | /domain/zone/{zoneName}/import | Import zone texte | zoneFile |
| POST | /domain/zone/{zoneName}/refresh | Rafraîchir zone | - |
| POST | /domain/zone/{zoneName}/reset | Réinitialiser zone | minimized?, DnsRecords? |
| POST | /domain/zone/{zoneName}/terminate | Supprimer zone | - |
| GET | /domain/zone/{zoneName}/record | Liste records (IDs) | fieldType?, subDomain? |
| GET | /domain/zone/{zoneName}/record/{id} | Détail record | - |
| POST | /domain/zone/{zoneName}/record | Ajouter record | fieldType, target, subDomain?, ttl? |
| PUT | /domain/zone/{zoneName}/record/{id} | Modifier record | subDomain?, target?, ttl? |
| DELETE | /domain/zone/{zoneName}/record/{id} | Supprimer record | - |
| PUT | /domain/zone/{zoneName}/redirection/{id} | Modifier redirection | ... |
| GET | /domain/zone/{zoneName}/dynHost/record | Liste DynHost | subDomain? |
| GET | /domain/zone/{zoneName}/dynHost/record/{id} | Détail DynHost | - |
| POST | /domain/zone/{zoneName}/dynHost/record | Ajouter DynHost | subDomain, ip |
| PUT | /domain/zone/{zoneName}/dynHost/record/{id} | Modifier DynHost | ip?, subDomain? |
| DELETE | /domain/zone/{zoneName}/dynHost/record/{id} | Supprimer DynHost | - |
| GET | /domain/zone/{zoneName}/dynHost/login | Liste logins DynHost | login? |
| GET | /domain/zone/{zoneName}/dynHost/login/{id} | Détail login | - |
| POST | /domain/zone/{zoneName}/dynHost/login | Ajouter login | loginSuffix, password, subDomain |
| PUT | /domain/zone/{zoneName}/dynHost/login/{id} | Modifier login | password?, subDomain? |
| DELETE | /domain/zone/{zoneName}/dynHost/login/{id} | Supprimer login | - |
| POST | /domain/zone/{zoneName}/dynHost/login/{id}/changePassword | Changer password | password |
| GET | /domain/zone/{zoneName}/history | Historique zone | - |
| GET | /domain/zone/{zoneName}/history/{creationDate} | Zone à date | - |

#### 2API (SWS)

| Méthode | Endpoint | Description | Params |
|---------|----------|-------------|--------|
| GET | /sws/domain/{serviceName} | Détails enrichis domaine | - |
| GET | /sws/domain/{serviceName}/zone/records | Records paginés | recordsCount, offset, search?, searchedType? |
| GET | /sws/domain/{serviceName}/redirections | Liste redirections | count, offset, search? |
| POST | /sws/domain/{serviceName}/redirections/false/{considerWww} | Ajouter redirection | ... |
| POST | /sws/domain/{serviceName}/redirections/true/{considerWww} | Vérifier redirection | ... |
| DELETE | /sws/domain/zone/{zoneName}/records | Supprimer records | records[] |
| GET | /sws/domain/{serviceName}/options/{option} | Détails option | - |
| GET | /sws/domains | Liste domaines enrichie | - |
| PUT | /sws/domains/dnssec | Modifier DNSSEC batch | ... |

#### AllDom (apiv6)

| Méthode | Endpoint | Description | Params |
|---------|----------|-------------|--------|
| GET | /allDom | Liste AllDom | - |
| GET | /allDom/{serviceName} | Détails AllDom | - |
| GET | /allDom/{serviceName}/serviceInfos | Infos service AllDom | - |
| PUT | /allDom/{serviceName}/serviceInfos | Modifier service | renew? |
| GET | /allDom/{serviceName}/domain | Liste domaines AllDom | - |
| GET | /allDom/{serviceName}/domain/{domain} | Détail domaine AllDom | - |

#### Me (Compte)

| Méthode | Endpoint | Description | Params |
|---------|----------|-------------|--------|
| GET | /me/task/domain | Opérations domaine | domain?, status?, function? |
| GET | /me/task/domain/{id} | Détail opération | - |
| GET | /me/task/domain/{id}/argument | Args opération | - |
| GET | /me/task/domain/{id}/argument/{key} | Valeur argument | - |
| PUT | /me/task/domain/{id}/argument/{key} | Modifier argument | value |
| POST | /me/task/domain/{id}/accelerate | Accélérer opération | - |
| POST | /me/task/domain/{id}/cancel | Annuler opération | - |
| POST | /me/task/domain/{id}/relaunch | Relancer opération | - |
| GET | /me/task/domain/{id}/progressbar | Progression | - |
| GET | /me/task/dns | Opérations DNS | domain?, status?, function? |
| GET | /me/task/dns/{id} | Détail opération DNS | - |
| GET | /me/contact/{contactId} | Infos contact | - |
| GET | /me/contact/{contactId}/fields | Champs contact | - |
| GET | /me/document | Liste documents | - |
| POST | /me/document | Créer document | name, size |
| GET | /me/document/{id} | Détail document | - |
| POST | /me/document/cors | URL upload CORS | - |

### Séquencement des appels

**Chargement dashboard domaine:**
```
1. GET /sws/domain/{serviceName}           → domain (2API enrichi)
2. GET /domain/zone/{serviceName}          → zone (peut échouer si pas de zone)
3. GET /email/domain/{serviceName}         → hasEmailDomain (true/false)
4. [Parallèle] GET attachedDomains         → associatedHostings
```

**Chargement informations générales:**
```
1. GET /domain/{serviceName}/serviceInfos  → domainInfos
2. GET /domain/zone/{serviceName}/dnssec   → dnssecStatus
3. GET /domain/{serviceName}/nameServer    → nameServers[]
   └─ Pour chaque: GET /domain/{serviceName}/nameServer/{id}
4. [Si AllDom] GET /allDom/{allDom}/serviceInfos
5. [Si AllDom] GET /allDom/{allDom}/domain → allDomDomains[]
```

**Modification protection transfert:**
```
1. PUT /domain/{serviceName} { transferLockStatus: 'locked'|'unlocked' }
2. Poll GET /domain/{serviceName} jusqu'à { transferLockStatus: newStatus }
3. Broadcast 'domain.dashboard.refresh'
```

**Modification DNSSEC:**
```
1. [Si zone OVH] PUT /domain/zone/{serviceName}/dnssec { activate: true|false }
2. Poll GET /domain/zone/{serviceName}/dnssec jusqu'à { status: 'enabled'|'disabled' }
3. Broadcast 'dnssec.get.done'
```

**Ajout record DNS:**
```
1. POST /domain/zone/{zoneName}/record { fieldType, target, subDomain, ttl }
2. POST /domain/zone/{zoneName}/refresh
3. Broadcast 'domain.tabs.zonedns.refresh'
```

### Types TypeScript
```typescript
// Domain principal
interface Domain {
  name: string;
  displayName: string;
  creation: string;
  expiration: string;
  nameServerType: 'hosted' | 'external';
  transferLockStatus: 'locked' | 'unlocked' | 'locking' | 'unlocking';
  dnssecStatus: 'ENABLED' | 'DISABLED' | 'ENABLE_IN_PROGRESS' | 'DISABLE_IN_PROGRESS';
  protection: 'locked' | 'unlocked' | 'locking' | 'unlocking' | 'unavailable';
  hasDnsAnycast: boolean | null;
  hostSupported: boolean;
  managedByOvh: boolean;
  owoSupported: boolean;
  whoisOwner: string | number;
  isExpired: boolean;
}

// Service infos
interface ServiceInfo {
  domain: string;
  serviceId: number;
  creation: string;
  expiration: string;
  status: 'ok' | 'expired' | 'restorable' | 'deleted';
  renew: {
    automatic: boolean;
    deleteAtExpiration: boolean;
    forced: boolean;
    manualPayment: boolean;
    period: number;
  };
  contactAdmin: string;
  contactTech: string;
  contactBilling: string;
}

// Zone DNS
interface Zone {
  name: string;
  hasDnsAnycast: boolean;
  dnssecSupported: boolean;
  lastUpdate: string;
  nameServers: string[];
}

// Record DNS
interface DnsRecord {
  id: number;
  fieldType: string;  // A, AAAA, CNAME, MX, TXT, NS, SRV, etc.
  subDomain: string;
  target: string;
  ttl: number;
  zone: string;
}

// Tâche
interface Task {
  id: number;
  function: string;
  status: 'todo' | 'doing' | 'done' | 'error' | 'cancelled';
  creationDate: string;
  doneDate?: string;
  lastUpdate: string;
  todoDate: string;
  comment?: string;
}

// Opération en cours
interface OngoingOperation {
  id: number;
  domain: string;
  function: string;
  status: 'todo' | 'doing' | 'problem' | 'error' | 'done' | 'cancelled';
  creationDate: string;
  lastUpdate: string;
  todoDate: string;
  canAccelerate: boolean;
  canCancel: boolean;
  canRelaunch: boolean;
}

// Serveur DNS
interface NameServer {
  id: number;
  host: string;
  ip?: string;
  isUsed: boolean;
  toDelete: boolean;
}

// Glue Record
interface GlueRecord {
  host: string;
  ips: string[];
}

// DynHost
interface DynHostRecord {
  id: number;
  ip: string;
  subDomain: string;
  zone: string;
}

interface DynHostLogin {
  login: string;
  subDomain: string;
  zone: string;
}

// DNSSEC DS Record
interface DsRecord {
  id: number;
  algorithm: number;
  flags: number;
  publicKey: string;
  tag: number;
}

// Redirection
interface Redirection {
  id: number;
  subDomain: string;
  type: 'visible' | 'invisible' | 'visiblePermanent';
  target: string;
  title?: string;
  description?: string;
  keywords?: string;
}

// AllDom
interface AllDom {
  name: string;
  type: 'french' | 'international' | 'french-international';
  domains: string[];
}

// Enums
enum DomainState {
  OK = 'ok',
  EXPIRED = 'expired',
  RESTORABLE = 'restorable',
  DELETED = 'deleted',
  SUSPENDED = 'suspended'
}

enum DnsFieldType {
  A = 'A',
  AAAA = 'AAAA',
  CAA = 'CAA',
  CNAME = 'CNAME',
  DKIM = 'DKIM',
  DMARC = 'DMARC',
  DNAME = 'DNAME',
  LOC = 'LOC',
  MX = 'MX',
  NAPTR = 'NAPTR',
  NS = 'NS',
  PTR = 'PTR',
  SPF = 'SPF',
  SRV = 'SRV',
  SSHFP = 'SSHFP',
  TLSA = 'TLSA',
  TXT = 'TXT'
}

enum TaskStatus {
  TODO = 'todo',
  DOING = 'doing',
  DONE = 'done',
  ERROR = 'error',
  CANCELLED = 'cancelled',
  PROBLEM = 'problem'
}
```

### Gestion du cache
```javascript
// Clés de cache AngularJS
const CACHE_KEYS = {
  UNIVERS_WEB_DOMAIN: 'domainCache',
  UNIVERS_WEB_DOMAIN_REDIRECTION: 'domainRedirectionCache',
  UNIVERS_WEB_DOMAIN_AUTHINFO: 'authInfo'
};

// Invalidation
OvhHttp.get('/sws/domain/{serviceName}', {
  cache: CACHE_KEYS.UNIVERS_WEB_DOMAIN,
  clearAllCache: forceRefresh  // true pour invalider
});
```

### Pagination Iceberg (2API)
```javascript
// Headers de pagination
const headers = {
  'X-Pagination-Mode': 'CachedObjectList-Pages'
};

// Params pagination
const params = {
  recordsCount: 25,  // Nombre par page
  offset: 0          // Position de départ
};

// Réponse paginée
interface PaginatedResponse<T> {
  data: T[];
  count: number;
  offset: number;
  pageCount: number;
  pageNumber: number;
}
```

================================================================================
## 6. TRADUCTIONS
================================================================================

### Clés principales (FR)
```json
{
  "domain_tab_GENERAL_INFORMATIONS": "Informations générales",
  "domain_tab_ZONE": "Zone DNS",
  "domain_tab_DNS": "Serveurs DNS",
  "domain_tab_REDIRECTION": "Redirections",
  "domain_tab_DYNHOST": "DynHost",
  "domain_tab_GLUE": "Glue records",
  "domain_tab_DNSSEC": "DNSSEC",
  "domain_tab_TASKS": "Tâches en cours",
  "domain_tab_emails": "E-mails et mailing-lists",
  "domain_tab_contact": "Gérer les contacts",
  
  "domains_title": "Noms de domaine",
  "domains_order": "Commander",
  "domains_status": "Statut",
  "domains_status_ok": "Actif",
  "domains_status_expired": "Expiré",
  "domains_status_restorable": "Restaurable",
  "domains_status_deleted": "Supprimé",
  "domains_status_suspended": "Suspendu",
  
  "domain_dashboard_general_informations": "Informations générales",
  "domain_dashboard_security": "Sécurité",
  "domain_dashboard_options": "Résumé des options",
  
  "domain_dashboard_dns_management": "Serveurs DNS",
  "domain_dashboard_dns_management_dnsHostedOK": "Actifs",
  "domain_dashboard_dns_management_dnsExternalOK": "Personnalisés",
  "domain_dashboard_dns_management_dnsKO": "Inactifs",
  "domain_dashboard_dns_management_dns_details": "Informations",
  "domain_dashboard_dns_refresh": "Mise à jour en cours",
  
  "domain_dashboard_dns_anycast": "Option DNS Anycast",
  "domain_dashboard_dns_management_anycast_true": "DNS Anycast",
  "domain_dashboard_dns_management_anycast_false": "DNS classique",
  "domain_dashboard_dns_management_anycast_null": "DNS Anycast non disponible",
  
  "domain_dashboard_protection_transfert": "Protection contre le transfert",
  "domain_dashboard_protection_locked": "Activée",
  "domain_dashboard_protection_unlocked": "Désactivée",
  "domain_dashboard_protection_locking": "Activation en cours",
  "domain_dashboard_protection_unlocking": "Désactivation en cours",
  "domain_dashboard_protection_unavailable": "Non disponible",
  
  "domain_dashboard_dnssec": "Délégation Sécurisée - DNSSEC",
  "domain_configuration_dnssec_ENABLED": "Activé",
  "domain_configuration_dnssec_DISABLED": "Désactivé",
  "domain_configuration_dnssec_ENABLE_IN_PROGRESS": "Activation en cours",
  "domain_configuration_dnssec_DISABLE_IN_PROGRESS": "Désactivation en cours",
  
  "domain_dashboard_show_authinfo": "AUTH/INFO",
  "domain_dashboard_show_authinfo_title": "Afficher le code AUTH/INFO",
  "domain_dashboard_show_authinfo_description": "Le code AUTH/INFO est une clé, nécessaire afin que le registry valide le transfert de votre nom de domaine {{t0}}.",
  
  "domain_dashboard_add_uk_tags": "Tag de transfert sortant",
  "domain_dashboard_add_uk_tags_title": "Veuillez saisir le tag de transfert sortant pour le domaine <strong>{{t0}}</strong>",
  
  "domain_dashboard_whois": "Affichage du WHOIS",
  "domain_dashboard_whois_button": "Configurer l'affichage du WHOIS",
  
  "domain_dashboard_obfuscated_email": "Adresses Anti-spam",
  "domain_dashboard_obfuscated_email_regenerate_button": "Gérer les adresses Anti-spam",
  
  "domain_dashboard_enable_web_hosting": "Hébergement Web et e-mail gratuit",
  "domain_dashboard_web_hosting_ordered": "Hébergements commandés",
  "domain_dashboard_web_hosting_ordered_none": "Aucun hébergement commandé",
  "domain_dashboard_web_hosting_associated": "Hébergements associés",
  "domain_dashboard_web_hosting_subdomains_and_multisites": "Sous-domaines et multisites",
  "domain_dashboard_web_hosting_subdomains_and_multisites_none": "Aucun sous-domaine ou multisite",
  
  "domain_configuration_renew": "Votre nom de domaine {{t0}} a expiré.",
  "domain_configuration_renew_title_button": "Renouveler",
  "domain_configuration_restorable": "Votre nom de domaine {{t0}} est restaurable.",
  "domain_configuration_restorable_title_button": "Restaurer",
  
  "domain_configuration_enable_web_hosting": "Commander un hébergement web",
  "domain_configuration_add_subdomain": "Ajouter un sous-domaine",
  "domain_configuration_order_web_hosting": "Commander ici",
  "domain_configuration_action_enable": "Activer",
  
  "domain_configuration_dnsanycast_activate_button": "Activer le DNS Anycast",
  "domain_configuration_dnsanycast_how_to_activate_1": "Pour l'activer, veuillez d'abord",
  "domain_configuration_dnsanycast_how_to_activate_2": "créer une zone DNS",
  
  "domain_dashboard_options_dns_anycast": "DNS Anycast",
  "domain_dashboard_options_status_enabled": "Activé",
  "domain_dashboard_options_status_disabled": "Résilié",
  "domain_dashboard_options_unavailable": "Option non disponible",
  "domain_dashboard_options_desactivate_option": "Résilier",
  "domain_dashboard_options_dns_anycast_expiry": "date d'effet : {{date}}",
  
  "common_creation_date": "Date de création",
  "common_plan": "Abonnement",
  "common_activated": "Activé",
  "common_desactivated": "Désactivé",
  "common_actions": "Actions",
  
  "contacts_management": "Gestion des contacts",
  "global_admin": "Administrateur",
  "global_technical": "Technique",
  "global_billing": "Facturation",
  "domain_contact_owner": "Propriétaire",
  
  "domain_dashboard_tooltip_dns": "Service permettant de traduire votre nom de domaine en adresse IP (indiquant par exemple l'emplacement des données de votre site).",
  "domain_dashboard_tooltip_dns_updating": "Un délai de propagation de 48h est nécessaire suite à votre dernière modification.",
  "domain_dashboard_tooltip_protection": "Bloquer les demandes de transfert pour vous protéger du vol de domaine.",
  "domain_dashboard_tooltip_dnssec": "Protégez votre domaine contre le Cache Poisoning.",
  
  "domain_dashboard_general_information_domain_delete_at_expiration": "Résiliation demandée",
  "domain_dashboard_general_information_domain_expired": "Résilié",
  "domain_dashboard_general_information_domain_manualPayment": "Renouvellement manuel",
  "domain_dashboard_general_information_domain_automatic": "Renouvellement automatique",
  
  "domain_dashboard_general_information_suspended_by_procedure_message": "Votre nom de domaine est suspendu dans le cadre d'une procédure de vérification des données de contacts.",
  "domain_dashboard_general_information_being_suspended_by_procedure_message": "Votre nom de domaine fait l'objet d'une procédure de vérification des données de contacts.",
  "domain_dashboard_general_information_see_operations": "Voir les opérations en cours",
  
  "domain_dashboard_type_alldom_french-international": "Pack FR + international",
  "domain_dashboard_type_alldom_french": "Pack FR",
  "domain_dashboard_type_alldom_international": "Pack international",
  
  "status_action_renew_management": "Gestion du renouvellement"
}
```

### Clés DNS/Zone
```json
{
  "domain_tab_dns_management_step1_title": "Informations sur vos serveurs DNS",
  "domain_tab_dns_management_step1_hostedNameServersOk": "Vous utilisez actuellement les serveurs DNS OVH recommandés pour votre domaine :",
  "domain_tab_dns_management_step1_externalNameServersOk": "Vous n'utilisez actuellement pas les serveurs DNS recommandés par OVH :",
  "domain_tab_dns_management_step1_nameServersKo": "Votre domaine dispose de serveurs DNS mais ces derniers ne répondent pas :",
  "domain_tab_dns_management_step1_nameServersKo_no_nameServer": "Votre domaine ne dispose pas de serveurs DNS actuellement.",
  "domain_tab_dns_management_step1_noZone_p1": "Il n'existe actuellement aucune zone DNS chez OVH pour ce domaine.",
  "domain_tab_dns_management_step1_noZone_p2": "Si vous souhaitez utiliser les serveurs DNS OVH, il vous faut activer dans un premier temps une zone DNS.",
  
  "domain_dashboard_dns_reset_your_zone": "Réinitialiser les serveurs DNS",
  "domain_dashboard_dns_activate_zone": "Activer la zone DNS",
  
  "web_domain_zone_activation_success": "Votre activation a été faite avec succès. Votre produit sera activé dans quelques instants.",
  "web_domain_zone_activation_order_success": "Votre <a href=\"{{t0}}\" target=\"_blank\">bon de commande</a> a été généré avec succès."
}
```

### Clés Erreurs
```json
{
  "domain_dashboard_loading_error": "Une erreur s'est produite lors du chargement des informations. Cela peut se produire lorsqu'un bloqueur de publicités est activé.",
  "domain_dashboard_show_authinfo_error": "Une erreur est survenue lors de la récupération du code AUTH/INFO",
  "domain_dashboard_whois_error": "Une erreur est survenue lors du chargement des informations du WHOIS. Veuillez réessayer ultérieurement.",
  "domain_dashboard_options_fail": "Une erreur est survenue lors de la récupération des options de domaine",
  "domain_configuration_dnssec_error_true": "Une erreur est survenue lors de la demande d'activation de DNSSEC.",
  "domain_configuration_dnssec_error_false": "Une erreur est survenue lors de la demande de désactivation de DNSSEC.",
  "domain_tab_options_delete_error": "Une erreur est survenue lors de la résiliation de l'option."
}
```

================================================================================
## 7. REGLES METIER
================================================================================

### Validations

**Serveur DNS:**
- Host: format FQDN valide
- IP: optionnelle, format IPv4 ou IPv6 valide
- Maximum: dépend du registre (généralement 5-13)

**Record DNS:**
- SubDomain: alphanumérique + tirets, pas de point final
- Target: selon fieldType (IP pour A/AAAA, FQDN pour CNAME/MX, texte pour TXT)
- TTL: entier positif, minimum 60 secondes

**Glue Record:**
- Host: sous-domaine du domaine principal
- IPs: au moins une IP (IPv4 ou IPv6)

**DynHost:**
- SubDomain: format valide
- IP: IPv4 valide
- Login suffix: alphanumérique

**Tag UK:**
- Format: lettres, chiffres, tirets uniquement
- Longueur max: 50 caractères

### Conditions d'affichage

| Élément | Condition |
|---------|-----------|
| Onglet DynHost | `hasZoneDns && zoneCapabilities.dynHost` |
| Onglet Glue | `domainInfos.hostSupported` |
| Onglet DNSSEC | `!domain.managedByOvh` |
| Bouton AUTH/INFO | `domain.protection === 'unlocked'` |
| Tag UK | `extension === 'uk'` |
| Bouton Commander Hosting | `canOrderHosting && isAdminOrBilling && !domain.isExpired` |
| Switch Protection | `!vm.protection.isUnavailable` |
| Switch DNSSEC | `!vm.dnssec.isUnavailable` |
| Whois config | `isWhoisOptinAllowed` |
| Email obfuscation | `domain.owoSupported` |
| DNS Anycast activate | `domain.hasDnsAnycast === false && canDisplayDomainOwner()` |
| DNS Anycast terminate | `options.dnsAnycast.optionActivated && !options.dnsAnycast.isTerminated` |

### États et transitions

**Protection transfert:**
```
unlocked ─────────────► locking ─────────────► locked
    ▲                                              │
    │                                              ▼
    └─────────────── unlocking ◄───────────────────┘
    
unavailable (pas de transition possible)
```

**DNSSEC:**
```
DISABLED ─────────────► ENABLE_IN_PROGRESS ─────────────► ENABLED
    ▲                                                         │
    │                                                         ▼
    └────────────── DISABLE_IN_PROGRESS ◄─────────────────────┘
```

**Zone DNS:**
```
Pas de zone → Activation → Zone active
Zone active → Reset → Zone réinitialisée
Zone active → Terminate → Pas de zone
```

**Tâche/Opération:**
```
todo → doing → done
         │
         ├──► error
         └──► cancelled
         
problem (nécessite action utilisateur)
```

### Permissions par contact

| Action | Admin | Tech | Billing | Owner |
|--------|-------|------|---------|-------|
| Voir infos générales | ✓ | ✓ | ✓ | ✓ |
| Modifier DNS | ✓ | ✓ | - | - |
| Modifier Zone | ✓ | ✓ | - | - |
| Modifier Protection | ✓ | - | - | - |
| Modifier DNSSEC | ✓ | ✓ | - | - |
| Commander hosting | ✓ | - | ✓ | - |
| Voir AUTH/INFO | ✓ | - | - | - |
| Gérer contacts | ✓ | - | - | - |
| Renouveler | ✓ | - | ✓ | - |

### Règles spécifiques par extension

**Extensions nécessitant changement propriétaire payant:**
- .fr, .be, .eu, .it, .lu, .pro, .lt, .de, .ch

**Extensions UK (.uk, .co.uk, etc.):**
- Tag de transfert sortant obligatoire pour transfert
- Pas de code AUTH/INFO classique

**Domaines managés par OVH:**
- DNSSEC géré automatiquement
- Onglet DNSSEC masqué

### Polling et délais

| Opération | Méthode | Délai estimé |
|-----------|---------|--------------|
| Changement protection | Poll /domain/{serviceName} | ~quelques minutes |
| Activation DNSSEC | Poll /domain/zone/{serviceName}/dnssec | ~24h |
| Ajout DNS record | POST + refresh | ~immédiat |
| Propagation DNS | - | ~48h |
| Création glue record | Poll task | ~quelques minutes |
| Transfert domaine | Poll /me/task/domain/{id} | ~jours |

### Messages et notifications

**Events broadcast (AngularJS):**
- `domain.dashboard.refresh` - Rafraîchir dashboard
- `domain.tabs.zonedns.refresh` - Rafraîchir zone DNS
- `hosting.tabs.dynHosts.refresh` - Rafraîchir DynHost
- `hosting.tabs.dynHostsLogin.refresh` - Rafraîchir logins DynHost
- `dnssec.get.done` - DNSSEC modifié
- `transfertLock.get.done` - Protection modifiée
- `domain.{taskFunction}.start` - Tâche démarrée
- `domain.{taskFunction}.done` - Tâche terminée
- `domain.{taskFunction}.error` - Tâche en erreur

### Tracking AtInternet

| Action | Track name |
|--------|------------|
| Commander hosting | `web::domain::order-pack-hosting` |
| Ajouter sous-domaine | `web::domain::add-subdomain` |
| Annuler résiliation AllDom | `web::all_dom::domain::cancel-resiliation-banner` |
| Voir listing domaines | `web::domain::list::manage_domains` |
| Commander domaine | page button go to order |

================================================================================
## ANNEXES
================================================================================

### A. Checklist migration React

- [ ] Créer structure pages React (Dashboard, Information, Zone, DNS, etc.)
- [ ] Implémenter hooks useQuery pour chaque endpoint API
- [ ] Mapper composants OuiKit vers ODS React
- [ ] Gérer états loading/error/success
- [ ] Implémenter polling pour opérations async
- [ ] Migrer système de cache
- [ ] Adapter système de traductions (i18next)
- [ ] Implémenter tracking

### B. Endpoints prioritaires pour MVP

1. GET /sws/domain/{serviceName} - Dashboard principal
2. GET /domain/{serviceName}/serviceInfos - Infos service
3. GET /domain/{serviceName}/nameServer - Serveurs DNS
4. PUT /domain/{serviceName} - Protection/DNS type
5. GET /domain/zone/{serviceName}/dnssec - Statut DNSSEC
6. GET /sws/domain/{serviceName}/zone/records - Records DNS

### C. Composants à développer en priorité

1. DomainHeader - Header avec nom, expiration, actions
2. DomainTabs - Navigation onglets
3. DomainInfoTile - Carte informations générales
4. DomainSecurityTile - Carte sécurité (protection, DNSSEC)
5. DomainPlanTile - Carte abonnement/contacts
6. ProtectionSwitch - Toggle protection avec polling
7. DnssecSwitch - Toggle DNSSEC avec polling

