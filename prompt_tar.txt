# Objectif
Limiter le contexte du chat en uploadant uniquement les fichiers nécessaires au travail du jour.

# Entrées
- Liste de fichiers `new_manager` (fichier joint)
- Liste de fichiers `old_manager` (fichier joint)

# Chemins réels
- `new_manager` = `/home/ubuntu/aiapp/frontend` (React/Vite)
- `old_manager` = `/home/ubuntu/manager/` (Angular monorepo avec packages/)

# Tâches

## 1. Analyse de structure
- Identifier les domaines NAV1 (ex: public-cloud, home, network...)
- Identifier les sous-domaines NAV2 (ex: home.billing, public-cloud.kubernetes...)
- Compter les fichiers par niveau (pages + services + locales)
- Classifier par taille : XS (<15), S (15-35), M (35-70), L (70-120), XL (>120)

## 2. Stratégie de division
Proposer 3 niveaux de tars :
- `{prefix}_core.tar` : config + composants partagés + design-system + lib (obligatoire)
- `{prefix}_{NAV1}.{NAV2}.tar` : sous-domaine granulaire (PRIORITAIRE)
- `{prefix}_all.tar` : tous les fichiers (travail transversal / refactoring global)

Où `{prefix}` = `new_manager` ou `old_manager`

**NOTE** : Les tars NAV1 seuls (ex: `home.tar`) sont OPTIONNELS. Privilégier les tars NAV2 granulaires.

## 2.5 Validation des patterns (AVANT script)
Pour chaque tar proposé, lister explicitement :
- Les fichiers/dossiers qui EXISTENT réellement (via la liste fournie)
- Signaler les patterns qui ne matchent RIEN

Ne PAS inclure de wildcards dans le script final.
Lister tous les fichiers explicitement.

## 2.6 Correspondance new/old (CRITIQUE)
**Règle : old_manager suit EXACTEMENT la structure NAV2 de new_manager**

1. Lister tous les NAV2 présents dans new_manager
2. Créer un tar old_manager pour CHAQUE NAV2 de new_manager
3. Les tars NAV1 seuls (ex: home.tar) sont OPTIONNELS

Objectif : uploader uniquement `new_manager_home.billing.tar` + `old_manager_home.billing.tar` pour migrer billing avec un contexte minimal.

Exemple de paires attendues :
- `new_manager_core.tar` ↔ `old_manager_core.tar`
- `new_manager_home.billing.tar` ↔ `old_manager_home.billing.tar`
- `new_manager_home.account.tar` ↔ `old_manager_home.account.tar`
- `new_manager_public-cloud.kubernetes.tar` ↔ `old_manager_public-cloud.kubernetes.tar`
- `new_manager_all.tar` ↔ `old_manager_all.tar`

Si un NAV2 existe dans new mais pas dans old :
- Signaler dans l'analyse
- Créer quand même le tar (vide ou avec ce qui existe)

## 3. Tableau récapitulatif
Pour chaque tar, indiquer :
- Nom du tar
- Nombre de fichiers
- Taille (XS/S/M/L/XL)
- Patterns de fichiers inclus (chemins réels uniquement)
- Correspondance avec l'autre manager (oui/non/partiel)

## 4. Scripts de génération (2 scripts séparés)

### Script 1 : `/home/ubuntu/new_generate_manager_tars.sh`
- Supprime UNIQUEMENT `/home/ubuntu/new_manager_*.tar` (jamais old_manager)
- Génère uniquement les tars `new_manager_*.tar`
- Travaille dans `/home/ubuntu/aiapp/frontend`

### Script 2 : `/home/ubuntu/old_generate_manager_tars.sh`
- Supprime UNIQUEMENT `/home/ubuntu/old_manager_*.tar` (jamais new_manager)
- Génère uniquement les tars `old_manager_*.tar`
- Travaille dans `/home/ubuntu/manager`
- DOIT créer un tar pour CHAQUE NAV2 présent dans new_manager

Chaque script DOIT :
1. Supprimer UNIQUEMENT ses propres tars (pas ceux de l'autre manager)
2. Créer tous les tars avec les bons chemins
3. Afficher la progression avec des echo
4. Vérifier que chaque tar n'est pas vide

**CRITIQUE - Isolation des rm :**
- `new_generate_manager_tars.sh` : `rm -f /home/ubuntu/new_manager_*.tar`
- `old_generate_manager_tars.sh` : `rm -f /home/ubuntu/old_manager_*.tar`
- INTERDIT de faire `rm -f /home/ubuntu/*_manager_*.tar` ou similaire

**CRITIQUE - Exclusions OBLIGATOIRES pour old_manager (monorepo lourd) :**
Chaque commande tar dans `old_generate_manager_tars.sh` DOIT inclure ces exclusions :
```
--exclude='node_modules' \
--exclude='.git' \
--exclude='dist' \
--exclude='coverage' \
--exclude='*.lock' \
--exclude='yarn.lock' \
--exclude='package-lock.json' \
--exclude='*.map' \
--exclude='.cache' \
```

**Interdit :**
- Wildcards `*.ts` dans tar (non interprétés)
- `2>/dev/null` qui masque les erreurs
- Chemins `~/new_manager` ou `~/old_manager` (n'existent pas)
- Utiliser `~` au lieu de `/home/ubuntu`
- Un script qui supprime les tars de l'autre manager
- Oublier les exclusions dans old_manager
- Créer des tars NAV2 dans old qui n'existent pas dans new

# Contraintes
- Tars new_manager commencent par `new_manager_`
- Tars old_manager commencent par `old_manager_`
- Inclure obligatoirement `new_manager_all.tar` et `old_manager_all.tar`
- old_manager DOIT avoir un tar pour CHAQUE NAV2 de new_manager
- Ne générer AUCUN code sans mon autorisation explicite

# Sortie attendue
1. Tableau d'analyse NAV2 de new_manager (référence)
2. Tableau de mapping NAV2 new → old (correspondances trouvées)
3. Tableau récapitulatif des tars proposés (new ET old côte à côte)
4. Proposition de stratégie
5. **Attendre mon GO** avant de générer les scripts

# Format de génération des scripts
Quand je dis "GO", générer les 2 scripts avec cp+tee, chacun dans un markdown séparé, facile à copier coller.

Pattern OBLIGATOIRE pour script 1 :
```
cp /home/ubuntu/new_generate_manager_tars.sh /home/ubuntu/new_generate_manager_tars.sh.$(date +%Y%m%d%H%M%S) 2>/dev/null || true
tee /home/ubuntu/new_generate_manager_tars.sh <<'FS'
#!/bin/bash
[contenu]
FS
chmod +x /home/ubuntu/new_generate_manager_tars.sh
```

Pattern OBLIGATOIRE pour script 2 :
```
cp /home/ubuntu/old_generate_manager_tars.sh /home/ubuntu/old_generate_manager_tars.sh.$(date +%Y%m%d%H%M%S) 2>/dev/null || true
tee /home/ubuntu/old_generate_manager_tars.sh <<'FS'
#!/bin/bash
[contenu]
FS
chmod +x /home/ubuntu/old_generate_manager_tars.sh
```

**Rappels anti-casse cp+tee :**
- `FS` final en début de ligne, sans espace
- Pas de guillemets "intelligents" - garder `'FS'` avec apostrophes simples
- Pas d'indentation avant `tee ... <<'FS'` ni avant `FS`
- Toujours `/home/ubuntu`, jamais `~`
