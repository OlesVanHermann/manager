# CAHIER DES CHARGES - old_manager.telecom.telephony.repayments
# Page des reversements SVA (numeros surtaxes)

## 1. RESUME EXECUTIF

### Perimetre
Gestion des reversements pour numeros a valeur ajoutee (SVA/numeros surtaxes).

### Objectif fonctionnel
Visualiser les reversements disponibles, en attente, et l'historique des paiements.

### Users cibles
- Proprietaires de numeros SVA
- Gestionnaires financiers telecom

---

## 2. ARCHITECTURE

### Arborescence fichiers source
```
telecom/telephony/repayments/
├── repayments.module.js
├── repayments.routing.js
├── repayments.controller.js
├── repayments.constants.js
├── repayments.utils.js
├── repayments.html
├── list/
└── translations/Messages_fr_FR.json
```

---

## 3. PAGES & NAVIGATION

### Route
- State: `telecom.telephony.repayments.index`
- URL: `/telephony/repayments`

### Breadcrumb
VoIP > Reversements

### Sous-sections
- Reversements disponibles
- Reversements en attente
- Couts a verser

---

## 4. COMPOSANTS UI

### Banniere Information
- Montant prochain reversement (si > seuil)
- Message si sous le seuil minimum
- Lien vers coordonnees bancaires

### Datagrid Reversements
| Colonne | Cle traduction | Propriete |
|---------|----------------|-----------|
| Date | telephony_repayments_grid_startDate | startDate |
| Numero special | telephony_repayments_grid_calledNumber | calledNumber |
| Numero entrant | telephony_repayments_grid_callingNumber | callingNumber |
| Duree (sec.) | telephony_repayments_grid_duration | duration |
| Reversement | telephony_repayments_grid_buyAmount.value | buyAmount.value |
| Statut | telephony_repayments_grid_status | status |

### Statuts reversement
| Valeur | Label FR | Couleur |
|--------|----------|---------|
| CREATED | En cours de reversement | Bleu |
| PAID | Reverse | Vert |
| ERROR | Erreur sur le reversement | Rouge |
| NONE | Aucun reversement | Gris |

---

## 5. APIs & DONNEES

### Endpoints

#### Liste reversements historique
```
GET /telephony/{billingAccount}/historyRepaymentConsumption
Response: Array<string> (dates YYYY-MM)
```

#### Detail reversements par date
```
GET /telephony/{billingAccount}/historyRepaymentConsumption/{date}
Response: {
  date: string,
  price: { value: number, text: string },
  status: string
}
```

#### Consommation repayment service
```
GET /telephony/{billingAccount}/service/{serviceName}/repaymentConsumption
Response: Array<RepaymentConsumption>
```

---

## 6. TRADUCTIONS

### Cles i18n (FR)
| Cle | Valeur FR |
|-----|-----------|
| telephony_repayments_repayments | Reversements |
| telephony_repayments_available_title | Reversements disponibles |
| telephony_repayments_pending_title | Reversements en attente |
| telephony_repayments_costs_title | Couts a verser |
| telephony_repayments_grid_startDate | Date |
| telephony_repayments_grid_calledNumber | Numero special |
| telephony_repayments_grid_callingNumber | Numero entrant |
| telephony_repayments_grid_duration | Duree (sec.) |
| telephony_repayments_grid_buyAmount.value | Reversement |
| telephony_repayments_grid_status | Statut |
| telephony_repayments_grid_status_CREATED | En cours de reversement |
| telephony_repayments_grid_status_PAID | Reverse |
| telephony_repayments_grid_status_ERROR | Erreur sur le reversement |
| telephony_repayments_grid_status_NONE | Aucun reversement |
| telephony_repayments_iban_link | Modifier mes coordonnees bancaires |
| telephony_repayments_message_above_threshold | Votre prochain reversement sera de {{ amount }} |
| telephony_repayments_message_under_threshold | Le montant minimum de {{ amount }} n'est pas encore atteint. Aucun reversement n'est prevu a ce jour |

---

## 7. REGLES METIER

### Seuil minimum
- Reversement effectue uniquement si montant > seuil minimum
- Seuil defini par OVH (generalement 10 EUR)

### Frequence reversements
- Mensuel
- Virement vers IBAN enregistre
